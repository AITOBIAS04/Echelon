<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Echelon — Unified Terminal</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=JetBrains+Mono:wght@400;500;600;700&display=swap" rel="stylesheet">
  <style>
    :root {
      --slate-950:#0B0C0E;
      --slate-900:#121417;
      --slate-850:#151719;
      --slate-800:#1A1D21;
      --slate-750:#26292E;
      --slate-700:#363A40;

      --bg-app: var(--slate-950);
      --bg-panel: var(--slate-850);
      --bg-card: var(--slate-900);
      --bg-card-hover: var(--slate-800);
      --border-outer: var(--slate-750);
      --border-inner: rgba(54,58,64,.5);

      --text-primary:#F1F5F9;
      --text-secondary:#94A3B8;
      --text-muted:#64748B;

      --status-success:#4ADE80;
      --status-success-bg: rgba(74,222,128,.1);
      --status-warning:#FACC15;
      --status-warning-bg: rgba(250,204,21,.1);
      --status-danger:#FB7185;
      --status-danger-bg: rgba(251,113,133,.1);
      --status-info:#3B82F6;
      --status-info-bg: rgba(59,130,246,.1);
      --status-paradox:#8B5CF6;
      --status-paradox-bg: rgba(139,92,246,.1);

      --font-sans:'Inter',system-ui,sans-serif;
      --font-mono:'JetBrains Mono',ui-monospace,Menlo,Monaco,Consolas,monospace;

      --sidebar-w: 240px;
      --topbar-h: 56px;
      --radius: 10px;
    }

    * { box-sizing: border-box; }
    body {
      margin:0;
      font-family: var(--font-sans);
      background: var(--bg-app);
      color: var(--text-primary);
      height: 100vh;
      overflow: hidden;
      -webkit-font-smoothing: antialiased;
    }

    /* Scrollbar */
    ::-webkit-scrollbar { width:6px; height:6px; }
    ::-webkit-scrollbar-track { background: var(--bg-app); }
    ::-webkit-scrollbar-thumb { background: var(--border-outer); border-radius: 3px; }
    ::-webkit-scrollbar-thumb:hover { background: var(--slate-700); }

    .app {
      display:flex;
      height:100vh;
      width:100vw;
    }

    /* Left menu */
    .side {
      width: var(--sidebar-w);
      background: var(--bg-panel);
      border-right: 1px solid var(--border-outer);
      display:flex;
      flex-direction: column;
      padding: 14px 12px;
      gap: 12px;
    }
    .brand {
      display:flex;
      align-items: center;
      justify-content: space-between;
      padding: 8px 10px;
      border: 1px solid var(--border-outer);
      border-radius: var(--radius);
      background: rgba(18,20,23,.55);
    }
    .brand .logo {
      font-weight: 800;
      letter-spacing: .14em;
      font-size: 14px;
    }
    .brand .badge {
      font-size: 10px;
      font-family: var(--font-mono);
      color: var(--text-muted);
      border: 1px solid var(--border-outer);
      padding: 2px 6px;
      border-radius: 6px;
      background: var(--bg-app);
    }

    .nav-group {
      display:flex;
      flex-direction: column;
      gap: 6px;
    }
    .nav-title {
      font-size: 10px;
      letter-spacing: .08em;
      text-transform: uppercase;
      color: var(--text-muted);
      padding: 0 8px;
      margin-top: 6px;
    }
    .nav-item {
      display:flex;
      align-items: center;
      gap: 10px;
      padding: 9px 10px;
      border-radius: 10px;
      border: 1px solid transparent;
      color: var(--text-secondary);
      cursor:pointer;
      user-select:none;
      transition: .15s ease;
      font-size: 12px;
      font-weight: 600;
    }
    .nav-item:hover {
      background: var(--bg-card);
      border-color: var(--border-outer);
      color: var(--text-primary);
    }
    .nav-item.active {
      background: rgba(26,29,33,.9);
      border-color: var(--border-outer);
      color: var(--text-primary);
    }
    .nav-dot {
      width: 7px;
      height: 7px;
      border-radius: 50%;
      background: var(--text-muted);
    }
    .nav-item.active .nav-dot { background: var(--status-info); box-shadow: 0 0 10px rgba(59,130,246,.25); }

    .subnav {
      margin-top: -4px;
      padding-left: 22px;
      display:none;
      flex-direction: column;
      gap: 4px;
    }
    .subnav.show { display:flex; }
    .sub-item {
      padding: 8px 10px;
      border-radius: 10px;
      border: 1px solid transparent;
      color: var(--text-secondary);
      cursor:pointer;
      font-size: 11px;
      font-weight: 600;
      transition: .15s ease;
    }
    .sub-item:hover {
      background: var(--bg-card);
      border-color: var(--border-outer);
      color: var(--text-primary);
    }

    /* Main */
    .main {
      flex:1;
      display:flex;
      flex-direction: column;
      min-width:0;
      height:100vh;
    }

    /* Top submenu bar */
    .top {
      height: var(--topbar-h);
      display:flex;
      align-items: center;
      justify-content: space-between;
      padding: 0 16px;
      border-bottom: 1px solid var(--border-outer);
      background: rgba(18,20,23,.65);
      backdrop-filter: blur(6px);
    }
    .crumb {
      display:flex;
      align-items: center;
      gap: 10px;
      min-width: 0;
    }
    .page-name {
      font-size: 12px;
      font-weight: 800;
      letter-spacing: .06em;
      text-transform: uppercase;
      color: var(--text-primary);
      white-space: nowrap;
    }
    .btns {
      display:flex;
      align-items: center;
      gap: 8px;
      flex-wrap: wrap;
    }
    .tbtn {
      display:flex;
      align-items: center;
      gap: 8px;
      padding: 7px 10px;
      border-radius: 10px;
      border: 1px solid var(--border-outer);
      background: var(--bg-card);
      color: var(--text-secondary);
      cursor:pointer;
      font-size: 11px;
      font-weight: 650;
      transition: .15s ease;
      white-space: nowrap;
    }
    .tbtn:hover {
      color: var(--text-primary);
      border-color: var(--text-muted);
      background: var(--bg-card-hover);
      transform: translateY(-1px);
    }
    .tbtn.primary {
      border-color: rgba(59,130,246,.35);
      background: var(--status-info-bg);
      color: var(--status-info);
    }
    .tbtn.warn {
      border-color: rgba(250,204,21,.35);
      background: var(--status-warning-bg);
      color: var(--status-warning);
    }
    .pill {
      font-family: var(--font-mono);
      font-size: 11px;
      padding: 6px 10px;
      border-radius: 999px;
      border: 1px solid var(--border-outer);
      background: var(--bg-card);
      color: var(--text-secondary);
      white-space: nowrap;
    }
    .pill.vrf { color: var(--status-paradox); border-color: rgba(139,92,246,.35); background: rgba(139,92,246,.08); }

    .viewport {
      flex:1;
      min-height:0;
      position: relative;
      background: var(--bg-app);
    }

    .frame {
      position:absolute;
      inset: 0;
      width: 100%;
      height: 100%;
      border: 0;
      display:none;
      background: var(--bg-app);
    }
    .frame.active { display:block; }

    /* Overlay modals (shell-level) */
    .overlay {
      position: absolute;
      inset: 0;
      display:none;
      align-items: center;
      justify-content: center;
      background: rgba(0,0,0,.65);
      backdrop-filter: blur(4px);
      z-index: 50;
      padding: 18px;
    }
    .overlay.show { display:flex; }
    .modal {
      width: min(860px, 96vw);
      max-height: 86vh;
      overflow: auto;
      background: var(--bg-panel);
      border: 1px solid var(--border-outer);
      border-radius: 14px;
      box-shadow: 0 20px 60px rgba(0,0,0,.55);
    }
    .modal-h {
      display:flex;
      align-items: center;
      justify-content: space-between;
      padding: 14px 16px;
      border-bottom: 1px solid var(--border-outer);
      background: rgba(18,20,23,.6);
    }
    .modal-title {
      font-size: 12px;
      font-weight: 800;
      letter-spacing: .06em;
      text-transform: uppercase;
      color: var(--text-primary);
    }
    .modal-x {
      border: 1px solid var(--border-outer);
      background: var(--bg-card);
      color: var(--text-secondary);
      border-radius: 10px;
      padding: 7px 10px;
      cursor:pointer;
      font-size: 11px;
      font-weight: 700;
    }
    .modal-x:hover { color: var(--text-primary); border-color: var(--text-muted); }
    .modal-b {
      padding: 14px 16px;
      color: var(--text-secondary);
      font-size: 12px;
      line-height: 1.55;
    }
    .kvs {
      display:grid;
      grid-template-columns: 180px 1fr;
      gap: 10px 14px;
      margin-top: 10px;
    }
    .kvk { color: var(--text-muted); font-family: var(--font-mono); font-size: 11px; }
    .kvv { color: var(--text-secondary); }
    .input {
      width:100%;
      padding: 10px 12px;
      border-radius: 10px;
      border: 1px solid var(--border-outer);
      background: var(--bg-card);
      color: var(--text-primary);
      outline:none;
      font-size: 12px;
      font-family: var(--font-sans);
    }
    .input:focus { border-color: rgba(59,130,246,.6); }
    .row {
      display:flex;
      gap: 10px;
      flex-wrap: wrap;
      margin-top: 12px;
    }
  </style>
</head>
<body>
  <div class="app">
    <aside class="side">
      <div class="brand">
        <div class="logo">ECHELON</div>
        <div class="badge">UNIFIED</div>
      </div>

      <div class="nav-group">
        <div class="nav-title">Console</div>

        <div class="nav-item active" data-page="marketplace">
          <span class="nav-dot"></span>
          Marketplace
        </div>
        <div class="nav-item" data-page="blackbox">
          <span class="nav-dot"></span>
          Analytics
        </div>
        <div class="nav-item" data-page="portfolio">
          <span class="nav-dot"></span>
          Portfolio
        </div>
        <div class="nav-item" data-page="rlmf">
          <span class="nav-dot"></span>
          RLMF
        </div>
        <div class="nav-item" data-page="vrf">
          <span class="nav-dot"></span>
          VRF
        </div>
        <div class="nav-item" data-page="agents" id="agentsNav">
          <span class="nav-dot"></span>
          Agents
        </div>

        <div class="subnav" id="agentsSubnav">
          <div class="nav-title" style="padding-left:0; margin-top: 10px;">Agents</div>
          <div class="sub-item" data-action="breachConsole">Breach Console</div>
          <div class="sub-item" data-action="exportConsole">Export Console</div>
        </div>
      </div>

      <div class="nav-group" style="margin-top:auto;">
        <div class="nav-title">Notes</div>
        <div style="padding: 0 8px; color: var(--text-muted); font-size: 11px; line-height: 1.5;">
          Single-file build that embeds the existing pages intact, with a unified left menu and page-specific top actions.
        </div>
      </div>
    </aside>

    <section class="main">
      <div class="top">
        <div class="crumb">
          <div class="page-name" id="pageName">Marketplace</div>
        </div>
        <div class="btns" id="topButtons"></div>
      </div>

      <div class="viewport">
        <iframe class="frame active" id="frame-marketplace" title="Marketplace"></iframe>
        <iframe class="frame" id="frame-blackbox" title="Analytics"></iframe>
        <iframe class="frame" id="frame-portfolio" title="Portfolio"></iframe>
        <iframe class="frame" id="frame-rlmf" title="RLMF"></iframe>
        <iframe class="frame" id="frame-vrf" title="VRF"></iframe>
        <iframe class="frame" id="frame-agents" title="Agents"></iframe>

        <!-- Shell modals -->
        <div class="overlay" id="overlay">
          <div class="modal">
            <div class="modal-h">
              <div class="modal-title" id="modalTitle">Modal</div>
              <button class="modal-x" id="modalClose">Close</button>
            </div>
            <div class="modal-b" id="modalBody"></div>
          </div>
        </div>
      </div>
    </section>
  </div>

  <script>
    // Embedded pages (srcdoc) — generated 2026-01-27 23:54:45 UTC
    const PAGES = {
      marketplace: `<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Markets - Echelon Protocol</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=JetBrains+Mono:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        :root {
            /* Core Slate Palette */
            --slate-950: #0B0C0E;
            --slate-900: #121417;
            --slate-850: #151719;
            --slate-800: #1A1D21;
            --slate-750: #26292E;
            --slate-700: #363A40;

            /* Semantic Mappings */
            --bg-app: var(--slate-950);
            --bg-panel: var(--slate-850);
            --bg-card: var(--slate-900);
            --bg-card-hover: var(--slate-800);
            --border-outer: var(--slate-750);
            --border-inner: rgba(54, 58, 64, 0.5);
            
            /* Typography */
            --text-primary: #F1F5F9;
            --text-secondary: #94A3B8;
            --text-muted: #64748B;
            --font-sans: 'Inter', system-ui, sans-serif;
            --font-mono: 'JetBrains Mono', monospace;

            /* Status Colors */
            --status-success: #4ADE80;
            --status-success-bg: rgba(74, 222, 128, 0.1);
            --status-success-border: rgba(74, 222, 128, 0.2);
            --status-warning: #FACC15;
            --status-warning-bg: rgba(250, 204, 21, 0.1);
            --status-danger: #FB7185;
            --status-danger-bg: rgba(251, 113, 133, 0.1);
            --status-info: #3B82F6;
            --status-info-bg: rgba(59, 130, 246, 0.1);
            --status-paradox: #8B5CF6;
            --status-paradox-bg: rgba(139, 92, 246, 0.1);
            --status-paradox-border: rgba(139, 92, 246, 0.2);

            /* Spacing */
            --radius-sm: 4px;
            --radius-md: 8px;
            --radius-lg: 12px;
        }

        * { margin: 0; padding: 0; box-sizing: border-box; }

        body {
            font-family: var(--font-sans);
            background-color: var(--bg-app);
            color: var(--text-primary);
            -webkit-font-smoothing: antialiased;
            min-height: 100vh;
            font-size: 13px;
        }

        /* Scrollbar */
        ::-webkit-scrollbar { width: 6px; height: 6px; }
        ::-webkit-scrollbar-track { background: var(--bg-app); }
        ::-webkit-scrollbar-thumb { background: var(--border-outer); border-radius: 3px; }
        ::-webkit-scrollbar-thumb:hover { background: var(--slate-700); }

        /* --- NAVIGATION --- */
        .top-nav {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 0 24px;
            height: 60px;
            background: var(--bg-panel);
            border-bottom: 1px solid var(--border-outer);
            position: sticky;
            top: 0;
            z-index: 100;
        }

        .logo {
            font-size: 18px;
            font-weight: 700;
            letter-spacing: 0.1em;
            color: var(--text-primary);
            display: flex;
            align-items: center;
            gap: 12px;
        }
        .logo::after {
            content: "MARKETS";
            font-size: 10px;
            background: var(--bg-card);
            border: 1px solid var(--border-outer);
            padding: 2px 6px;
            border-radius: 4px;
            color: var(--text-muted);
            font-weight: 500;
        }

        .nav-links { display: flex; align-items: center; gap: 4px; background: var(--bg-app); padding: 4px; border-radius: 20px; border: 1px solid var(--border-outer); }
        .nav-links a {
            font-size: 12px;
            color: var(--text-secondary);
            text-decoration: none;
            padding: 6px 16px;
            border-radius: 16px;
            transition: all 0.2s;
            font-weight: 500;
            cursor: pointer;
        }
        .nav-links a:hover { color: var(--text-primary); }
        .nav-links a.active {
            color: var(--text-primary);
            background: var(--bg-panel);
            box-shadow: 0 1px 2px rgba(0,0,0,0.2);
            font-weight: 600;
        }

        .nav-controls { display: flex; align-items: center; gap: 16px; }
        
        .balance-container {
            display: flex;
            flex-direction: column;
            align-items: flex-end;
            line-height: 1.1;
        }
        .balance-label { font-size: 9px; color: var(--text-muted); text-transform: uppercase; letter-spacing: 0.05em; }
        .balance { font-family: var(--font-mono); font-weight: 600; color: var(--status-success); }

        .create-timeline {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 8px 16px;
            font-size: 12px;
            font-weight: 600;
            background: var(--status-info-bg);
            border: 1px solid rgba(59, 130, 246, 0.3);
            border-radius: var(--radius-md);
            color: var(--status-info);
            cursor: pointer;
            transition: all 0.2s;
        }
        .create-timeline:hover { background: rgba(59, 130, 246, 0.2); transform: translateY(-1px); }

        .connect {
            padding: 8px 16px;
            font-size: 12px;
            font-weight: 500;
            background: var(--bg-card);
            border: 1px solid var(--border-outer);
            border-radius: var(--radius-md);
            color: var(--text-secondary);
            cursor: pointer;
            transition: all 0.2s;
        }
        .connect:hover { border-color: var(--text-muted); color: var(--text-primary); }

        /* --- SUB-HEADER (CONTROLS) --- */
        .market-controls {
            display: flex;
            align-items: center;
            gap: 16px;
            padding: 12px 24px;
            background: var(--bg-app);
            border-bottom: 1px solid var(--border-outer);
        }

        .search-container { display: flex; align-items: center; flex: 1; max-width: 320px; position: relative; }
        .search-input {
            width: 100%;
            padding: 8px 12px 8px 32px;
            font-size: 12px;
            background: var(--bg-panel);
            border: 1px solid var(--border-outer);
            border-radius: var(--radius-md);
            color: var(--text-primary);
            outline: none;
            transition: border-color 0.2s;
            font-family: var(--font-sans);
        }
        .search-input:focus { border-color: var(--status-info); }
        .search-icon { position: absolute; left: 10px; color: var(--text-muted); pointer-events: none; width: 14px; height: 14px; }

        .sort-select {
            padding: 8px 24px 8px 12px;
            font-size: 12px;
            background: var(--bg-panel);
            border: 1px solid var(--border-outer);
            border-radius: var(--radius-md);
            color: var(--text-primary);
            cursor: pointer;
            outline: none;
            appearance: none;
            background-image: url("data:image/svg+xml,%3Csvg width='10' height='10' viewBox='0 0 24 24' fill='none' stroke='%2394A3B8' stroke-width='2'%3E%3Cpath d='M6 9l6 6 6-6'/%3E%3C/svg%3E");
background-repeat: no-repeat;
            background-position: right 8px center;
        }

        .stats-bar { display: flex; gap: 24px; margin-left: auto; }
        .stat-item { display: flex; flex-direction: column; align-items: flex-end; }
        .stat-label { font-size: 9px; color: var(--text-muted); text-transform: uppercase; letter-spacing: 0.05em; }
        .stat-value { font-family: var(--font-mono); font-size: 12px; color: var(--text-secondary); }

        /* --- CATEGORY TABS --- */
        .category-nav {
            display: flex;
            gap: 4px;
            padding: 12px 24px;
            background: var(--bg-app);
            border-bottom: 1px solid var(--border-outer);
            overflow-x: auto;
        }
        .category {
            padding: 6px 12px;
            font-size: 11px;
            font-weight: 500;
            background: transparent;
            border: 1px solid transparent;
            border-radius: var(--radius-md);
            color: var(--text-secondary);
            cursor: pointer;
            transition: all 0.2s;
            white-space: nowrap;
            display: flex;
            align-items: center;
            gap: 6px;
        }
        .category:hover { color: var(--text-primary); background: var(--bg-card); }
        .category.active { background: var(--bg-panel); border-color: var(--border-outer); color: var(--text-primary); font-weight: 600; }
        .category-icon { opacity: 0.7; font-size: 12px; }

        /* --- MAIN LAYOUT --- */
        .app-container { display: flex; height: calc(100vh - 120px); overflow: hidden; }
        .main-content { flex: 1; min-width: 0; padding: 24px; overflow-y: auto; }

        /* --- RIBBON --- */
        .live-ribbon-container { margin-bottom: 24px; }
        .ribbon-items { display: flex; gap: 10px; overflow-x: auto; padding-bottom: 4px; scrollbar-width: none; }
        .ribbon-items::-webkit-scrollbar { display: none; }
        
        .ribbon-item {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 6px 12px;
            background: var(--bg-panel);
            border: 1px solid var(--border-outer);
            border-radius: 20px;
            cursor: pointer;
            flex-shrink: 0;
            transition: all 0.2s ease;
        }
        .ribbon-item:hover { background: var(--bg-card-hover); border-color: var(--text-muted); transform: translateY(-1px); }

        .event-tag { font-size: 9px; font-weight: 700; text-transform: uppercase; letter-spacing: 0.05em; padding: 2px 6px; border-radius: 4px; }
        .event-tag.fork, .event-tag.flip, .event-tag.settle { background: var(--status-success); color: #000; }
        .event-tag.paradox { background: var(--status-paradox); color: white; }
        .event-tag.sabotage { background: var(--status-danger); color: white; }
        .event-tag.wing { background: var(--status-info); color: white; }

        .ribbon-title { font-size: 11px; color: var(--text-secondary); font-weight: 500; }
        .ribbon-time { font-family: var(--font-mono); font-size: 10px; color: var(--text-muted); border-left: 1px solid var(--border-inner); padding-left: 8px; }

        /* --- MARKET GRID --- */
        .section-header { display: flex; align-items: center; justify-content: space-between; margin-bottom: 16px; }
        .section-title { font-size: 12px; font-weight: 600; color: var(--text-muted); text-transform: uppercase; letter-spacing: 0.05em; }
        .section-count { font-size: 11px; font-family: var(--font-mono); color: var(--text-secondary); background: var(--bg-panel); padding: 2px 8px; border-radius: 4px; border: 1px solid var(--border-outer); }

        .market-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(300px, 1fr)); gap: 16px; }

        /* --- MARKET CARD --- */
        .market-card {
            background: var(--bg-panel);
            border: 1px solid var(--border-outer);
            border-radius: var(--radius-lg);
            padding: 16px;
            cursor: pointer;
            transition: all 0.2s ease-out;
            position: relative;
            overflow: hidden;
        }
        .market-card:hover {
            border-color: var(--text-muted);
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
        }
        
        .card-header { display: flex; align-items: center; justify-content: space-between; margin-bottom: 14px; }
        
        .category-badge {
            display: inline-flex; align-items: center; gap: 6px;
            padding: 4px 8px; font-size: 10px; font-weight: 600;
            text-transform: uppercase; letter-spacing: 0.05em;
            border-radius: 4px;
        }
        .category-badge.robotics { background: rgba(96, 165, 250, 0.1); color: #60a5fa; border: 1px solid rgba(96, 165, 250, 0.2); }
        .category-badge.logistics { background: var(--status-success-bg); color: var(--status-success); border: 1px solid var(--status-success-border); }
        .category-badge.defi { background: var(--status-paradox-bg); color: var(--status-paradox); border: 1px solid var(--status-paradox-border); }
        .category-badge.physics { background: var(--status-warning-bg); color: var(--status-warning); border: 1px solid rgba(250, 204, 21, 0.2); }
        .category-badge.soceng { background: var(--status-info-bg); color: var(--status-info); border: 1px solid rgba(59, 130, 246, 0.2); }

        /* Stability Gauge - Thinner, more technical */
        .stability-wrapper { display: flex; align-items: center; gap: 8px; }
        .stability-label { font-size: 9px; color: var(--text-muted); text-transform: uppercase; letter-spacing: 0.05em; }
        .stability-gauge { width: 40px; height: 4px; background: var(--bg-card); border-radius: 2px; overflow: hidden; }
        .gauge-fill { height: 100%; border-radius: 2px; }
        .gauge-fill.stable { background: var(--status-success); }
        .gauge-fill.warning { background: var(--status-warning); }
        .gauge-fill.critical { background: var(--status-danger); }

        .card-title { font-size: 14px; font-weight: 600; color: var(--text-primary); margin-bottom: 16px; line-height: 1.4; height: 40px; display: -webkit-box; -webkit-line-clamp: 2; -webkit-box-orient: vertical; overflow: hidden; }

        /* Outcomes */
        .outcomes { display: flex; gap: 8px; margin-bottom: 16px; }
        .outcome {
            flex: 1; display: flex; flex-direction: column; justify-content: space-between;
            padding: 8px 12px; background: var(--bg-card);
            border: 1px solid var(--border-outer); border-radius: var(--radius-md);
            transition: all 0.15s; position: relative;
        }
        .outcome:hover { border-color: var(--border-inner); background: var(--bg-card-hover); }
        
        .outcome.positive:hover { border-color: var(--status-success); }
        .outcome.negative:hover { border-color: var(--status-danger); }

        .outcome-top { display: flex; justify-content: space-between; align-items: center; margin-bottom: 4px; }
        .outcome-label { font-size: 10px; font-weight: 700; color: var(--text-muted); }
        .outcome-prob { font-size: 11px; font-family: var(--font-mono); color: var(--text-secondary); }
        
        .outcome-price { font-size: 16px; font-weight: 600; font-family: var(--font-mono); letter-spacing: -0.02em; }
        .outcome-price.positive { color: var(--status-success); }
        .outcome-price.negative { color: var(--status-danger); }

        /* Card Footer */
        .card-footer {
            display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 8px;
            padding-top: 12px; border-top: 1px solid var(--border-outer);
        }
        .card-metric { display: flex; flex-direction: column; gap: 2px; }
        .card-metric-label { font-size: 9px; font-weight: 600; color: var(--text-muted); text-transform: uppercase; letter-spacing: 0.03em; }
        .card-metric-value { font-size: 11px; font-family: var(--font-mono); font-weight: 500; color: var(--text-secondary); }
        .card-metric-value.warning { color: var(--status-warning); }
        .card-metric-value.danger { color: var(--status-danger); }

        /* --- SIDEBAR --- */
        .sidebar { width: 360px; background: var(--bg-panel); border-left: 1px solid var(--border-outer); display: flex; flex-direction: column; overflow: hidden; }
        .sidebar-section { display: flex; flex-direction: column; border-bottom: 1px solid var(--border-outer); }
        .sidebar-section:last-child { border-bottom: none; flex: 1; min-height: 0; }

        .sidebar-header {
            display: flex; align-items: center; justify-content: space-between;
            padding: 12px 16px; background: rgba(26, 29, 33, 0.5);
            border-bottom: 1px solid var(--border-outer);
        }
        .sidebar-title { display: flex; align-items: center; gap: 8px; font-size: 11px; font-weight: 600; text-transform: uppercase; letter-spacing: 0.05em; color: var(--text-muted); }
        .live-badge { 
            font-size: 9px; font-weight: 700; color: var(--status-danger); 
            background: var(--status-danger-bg); padding: 1px 6px; border-radius: 4px;
            display: flex; align-items: center; gap: 4px;
        }
        .live-badge::before { content: ''; width: 4px; height: 4px; border-radius: 50%; background: currentColor; animation: pulse 2s infinite; }
        @keyframes pulse { 0%, 100% { opacity: 1; } 50% { opacity: 0.5; } }

        .view-all-link { font-size: 10px; color: var(--status-info); cursor: pointer; text-decoration: none; opacity: 0.8; }
        .view-all-link:hover { opacity: 1; text-decoration: underline; }

        /* Feed Items */
        .intercepts-list { flex: 1; min-height: 0; overflow-y: auto; }
        .intercept-card {
            padding: 12px 16px; border-bottom: 1px solid var(--border-outer);
            transition: background 0.15s; cursor: pointer;
        }
        .intercept-card:hover { background: var(--bg-card-hover); }
        
        .intercept-header { display: flex; align-items: center; gap: 8px; margin-bottom: 6px; }
        .agent-pill { 
            display: flex; align-items: center; gap: 4px; font-size: 10px; 
            background: var(--bg-card); border: 1px solid var(--border-outer);
            padding: 2px 6px; border-radius: 4px;
        }
        .agent-name { font-weight: 600; font-family: var(--font-mono); color: var(--text-primary); }
        .intercept-timestamp { font-size: 10px; font-family: var(--font-mono); color: var(--text-muted); margin-left: auto; }

        .intercept-content { font-size: 11px; color: var(--text-secondary); line-height: 1.4; margin-bottom: 8px; }
        .intercept-content strong { color: var(--status-paradox); font-weight: 500; font-family: var(--font-mono); }

        .intercept-actions { display: flex; gap: 6px; }
        .mini-btn {
            font-size: 9px; padding: 2px 8px; background: transparent;
            border: 1px solid var(--border-outer); color: var(--text-muted);
            border-radius: 3px; cursor: pointer; text-transform: uppercase;
        }
        .mini-btn:hover { border-color: var(--text-secondary); color: var(--text-primary); }

        .intercept-source { padding: 8px 16px; font-size: 9px; color: var(--text-muted); background: var(--bg-card); font-family: var(--font-mono); text-align: center; border-top: 1px solid var(--border-outer); }

        /* Breaches */
        .breach-item {
            display: flex; flex-direction: column; padding: 10px 16px;
            border-bottom: 1px solid var(--border-outer); cursor: pointer;
            transition: background 0.15s;
        }
        .breach-item:hover { background: var(--bg-card-hover); }
        
        .breach-top { display: flex; align-items: center; gap: 8px; margin-bottom: 4px; }
        .severity-dot { width: 6px; height: 6px; border-radius: 50%; }
        .severity-dot.critical { background: var(--status-danger); box-shadow: 0 0 6px rgba(251, 113, 133, 0.4); }
        .severity-dot.high { background: #f97316; }
        .severity-dot.medium { background: var(--status-warning); }
        .severity-dot.low { background: var(--status-success); }
        
        .breach-category { font-size: 9px; font-weight: 700; font-family: var(--font-mono); color: var(--text-muted); letter-spacing: 0.05em; }
        .breach-time { font-size: 10px; font-family: var(--font-mono); color: var(--text-muted); margin-left: auto; }
        .breach-title { font-size: 11px; color: var(--text-secondary); }

        /* Responsiveness */
        @media (max-width: 1280px) {
            .sidebar { width: 300px; }
            .market-grid { grid-template-columns: repeat(auto-fill, minmax(260px, 1fr)); }
        }
        @media (max-width: 1024px) {
            .sidebar { display: none; }
            .app-container { height: auto; min-height: calc(100vh - 120px); }
        }
        @media (max-width: 768px) {
            .top-nav { padding: 0 16px; }
            .nav-links { display: none; }
            .market-controls { flex-wrap: wrap; padding: 12px 16px; height: auto; }
            .search-container { max-width: 100%; order: 1; margin-bottom: 12px; }
            .stats-bar { width: 100%; justify-content: space-between; margin-top: 12px; }
            .main-content { padding: 16px; }
        }

        /* ============================================
           INTEGRATED ALERT SYSTEM
           ============================================ */

        /* Alert Badge in Nav */
        .alert-badge-btn {
            display: flex;
            align-items: center;
            gap: 6px;
            background: var(--bg-panel);
            border: 1px solid var(--border-outer);
            color: var(--text-secondary);
            padding: 6px 12px;
            border-radius: var(--radius-md);
            cursor: pointer;
            font-size: 12px;
            font-weight: 500;
            transition: all 0.2s;
            position: relative;
        }
        .alert-badge-btn:hover {
            border-color: var(--status-warning);
            color: var(--status-warning);
        }
        .alert-badge-btn.has-unread {
            color: var(--status-warning);
            border-color: var(--status-warning);
            background: var(--status-warning-bg);
        }
        .alert-badge-btn .badge-count {
            background: var(--status-danger);
            color: white;
            font-size: 10px;
            font-weight: 700;
            padding: 1px 5px;
            border-radius: 10px;
            min-width: 18px;
            text-align: center;
        }

        /* Notification Panel (Dropdown) */
        .alert-panel {
            position: fixed;
            top: 60px;
            right: 24px;
            width: 380px;
            max-height: calc(100vh - 80px);
            background: var(--bg-panel);
            border: 1px solid var(--border-outer);
            border-radius: var(--radius-lg);
            box-shadow: 0 10px 40px rgba(0,0,0,0.4);
            z-index: 1000;
            display: none;
            flex-direction: column;
            overflow: hidden;
        }
        .alert-panel.active { display: flex; }
        .alert-panel-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 12px 16px;
            border-bottom: 1px solid var(--border-outer);
            background: var(--bg-card);
        }
        .alert-panel-title {
            font-size: 12px;
            font-weight: 600;
            color: var(--text-primary);
            display: flex;
            align-items: center;
            gap: 8px;
        }
        .alert-panel-actions {
            display: flex;
            gap: 8px;
        }
        .alert-panel-btn {
            background: transparent;
            border: none;
            color: var(--status-info);
            font-size: 11px;
            cursor: pointer;
            padding: 4px 8px;
            border-radius: 4px;
            transition: background 0.2s;
        }
        .alert-panel-btn:hover { background: var(--bg-card-hover); }
        .alert-list {
            flex: 1;
            overflow-y: auto;
            padding: 8px;
        }
        .alert-notification-item {
            display: flex;
            gap: 10px;
            padding: 10px 12px;
            border-radius: var(--radius-md);
            cursor: pointer;
            transition: all 0.2s;
            margin-bottom: 4px;
            border-left: 3px solid transparent;
        }
        .alert-notification-item:hover { background: var(--bg-card-hover); }
        .alert-notification-item.unread { background: rgba(59, 130, 246, 0.05); }
        .alert-notification-item.critical {
            border-left-color: var(--status-danger);
            background: rgba(251, 113, 133, 0.08);
        }
        .alert-notification-item.warning {
            border-left-color: var(--status-warning);
            background: rgba(250, 204, 21, 0.08);
        }
        .alert-notification-item.info {
            border-left-color: var(--status-info);
            background: rgba(59, 130, 246, 0.08);
        }
        .alert-notification-item.success {
            border-left-color: var(--status-success);
            background: rgba(74, 222, 128, 0.08);
        }
        .alert-notification-icon {
            width: 32px;
            height: 32px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 14px;
            flex-shrink: 0;
        }
        .alert-notification-icon.price { background: var(--status-info-bg); }
        .alert-notification-icon.stability { background: var(--status-warning-bg); }
        .alert-notification-icon.gap { background: var(--status-danger-bg); }
        .alert-notification-icon.volume { background: var(--status-success-bg); }
        .alert-notification-icon.paradox { background: var(--status-paradox-bg); }
        .alert-notification-content {
            flex: 1;
            min-width: 0;
        }
        .alert-notification-title {
            font-size: 12px;
            font-weight: 600;
            color: var(--text-primary);
            margin-bottom: 2px;
        }
        .alert-notification-desc {
            font-size: 11px;
            color: var(--text-secondary);
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }
        .alert-notification-meta {
            display: flex;
            gap: 8px;
            font-size: 10px;
            color: var(--text-muted);
            margin-top: 4px;
        }
        .alert-notification-condition {
            font-family: var(--font-mono);
            font-size: 10px;
            padding: 2px 6px;
            background: var(--bg-card);
            border-radius: 4px;
            color: var(--text-secondary);
        }
        .alert-notification-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 2px;
        }
        .alert-notification-title {
            font-size: 12px;
            font-weight: 600;
            color: var(--text-primary);
        }
        .alert-severity {
            font-size: 9px;
            padding: 1px 5px;
            border-radius: 3px;
            font-weight: 600;
            text-transform: uppercase;
        }
        .alert-severity.critical {
            background: var(--status-danger-bg);
            color: var(--status-danger);
        }
        .alert-severity.warning {
            background: var(--status-warning-bg);
            color: #854d0e;
        }
        .alert-severity.info {
            background: var(--status-info-bg);
            color: var(--status-info);
        }
        .alert-severity.success {
            background: var(--status-success-bg);
            color: var(--status-success);
        }
        .alert-actions-row {
            display: flex;
            gap: 6px;
            margin-top: 8px;
        }
        .alert-action-btn {
            padding: 4px 8px;
            font-size: 10px;
            background: var(--bg-panel);
            border: 1px solid var(--border-outer);
            border-radius: 4px;
            color: var(--text-secondary);
            cursor: pointer;
            transition: all 0.2s;
        }
        .alert-action-btn:hover {
            border-color: var(--status-info);
            color: var(--status-info);
        }

        /* Alert Management Modal */
        .alert-modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0,0,0,0.7);
            backdrop-filter: blur(4px);
            z-index: 2000;
            display: none;
            align-items: center;
            justify-content: center;
        }
        .alert-modal-overlay.active { display: flex; }
        .alert-modal {
            background: var(--bg-panel);
            border: 1px solid var(--border-outer);
            border-radius: var(--radius-lg);
            width: 600px;
            max-width: 90vw;
            max-height: 85vh;
            display: flex;
            flex-direction: column;
            box-shadow: 0 20px 60px rgba(0,0,0,0.5);
        }
        .alert-modal-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 16px 20px;
            border-bottom: 1px solid var(--border-outer);
        }
        .alert-modal-title {
            font-size: 14px;
            font-weight: 600;
            color: var(--text-primary);
        }
        .alert-modal-close {
            background: transparent;
            border: none;
            color: var(--text-muted);
            cursor: pointer;
            padding: 4px;
            border-radius: 4px;
            transition: all 0.2s;
        }
        .alert-modal-close:hover { color: var(--text-primary); background: var(--bg-card); }
        .alert-modal-body {
            flex: 1;
            overflow-y: auto;
            padding: 20px;
        }
        .alert-modal-footer {
            display: flex;
            justify-content: flex-end;
            gap: 12px;
            padding: 16px 20px;
            border-top: 1px solid var(--border-outer);
        }

        /* Create Alert Form */
        .create-alert-form {
            display: flex;
            flex-direction: column;
            gap: 16px;
        }
        .form-row {
            display: flex;
            gap: 12px;
        }
        .form-group {
            flex: 1;
            display: flex;
            flex-direction: column;
            gap: 6px;
        }
        .form-label {
            font-size: 11px;
            font-weight: 600;
            color: var(--text-muted);
            text-transform: uppercase;
            letter-spacing: 0.05em;
        }
        .form-input, .form-select {
            padding: 10px 12px;
            background: var(--bg-card);
            border: 1px solid var(--border-outer);
            border-radius: var(--radius-md);
            color: var(--text-primary);
            font-size: 12px;
            outline: none;
            transition: border-color 0.2s;
        }
        .form-input:focus, .form-select:focus { border-color: var(--status-info); }
        .condition-builder {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 10px 12px;
            background: var(--bg-card);
            border: 1px solid var(--border-outer);
            border-radius: var(--radius-md);
        }
        .condition-builder select {
            background: transparent;
            border: none;
            color: var(--text-primary);
            font-size: 12px;
            outline: none;
            cursor: pointer;
        }
        .condition-operator {
            font-family: var(--font-mono);
            color: var(--status-info);
            font-weight: 600;
        }
        .condition-builder input {
            flex: 1;
            background: transparent;
            border: none;
            color: var(--text-primary);
            font-size: 12px;
            font-family: var(--font-mono);
            outline: none;
        }
        .btn-primary {
            padding: 10px 20px;
            background: var(--status-info);
            border: none;
            border-radius: var(--radius-md);
            color: white;
            font-size: 12px;
            font-weight: 600;
            cursor: pointer;
            transition: background 0.2s;
        }
        .btn-primary:hover { background: #2563eb; }
        .btn-secondary {
            padding: 10px 20px;
            background: var(--bg-card);
            border: 1px solid var(--border-outer);
            border-radius: var(--radius-md);
            color: var(--text-secondary);
            font-size: 12px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s;
        }
        .btn-secondary:hover { border-color: var(--text-muted); color: var(--text-primary); }

        /* Alert Items */
        .alert-item {
            display: flex;
            gap: 12px;
            padding: 12px;
            background: var(--bg-card);
            border: 1px solid var(--border-outer);
            border-radius: var(--radius-md);
            margin-bottom: 8px;
            transition: all 0.2s;
        }
        .alert-item:hover { border-color: var(--border-inner); }
        .alert-item.unread { border-color: var(--status-info); background: rgba(59, 130, 246, 0.05); }
        .alert-item.paused { opacity: 0.6; }
        .alert-item.triggered .alert-condition { background: var(--status-danger-bg); color: var(--status-danger); }
        .alert-item.resolved .alert-condition { background: var(--status-success-bg); color: var(--status-success); }
        .alert-icon {
            width: 36px;
            height: 36px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 16px;
            flex-shrink: 0;
        }
        .alert-icon.price { background: var(--status-info-bg); }
        .alert-icon.stability { background: var(--status-warning-bg); }
        .alert-icon.gap { background: var(--status-danger-bg); }
        .alert-icon.volume { background: var(--status-success-bg); }
        .alert-icon.paradox { background: var(--status-paradox-bg); }
        .alert-content { flex: 1; min-width: 0; }
        .alert-title { font-size: 12px; font-weight: 600; color: var(--text-primary); margin-bottom: 2px; }
        .alert-description { font-size: 11px; color: var(--text-secondary); margin-bottom: 6px; }
        .alert-meta { display: flex; gap: 12px; font-size: 10px; color: var(--text-muted); }
        .alert-condition {
            font-family: var(--font-mono);
            font-size: 10px;
            padding: 4px 8px;
            background: var(--bg-panel);
            border-radius: 4px;
            color: var(--text-secondary);
            white-space: nowrap;
        }
        .alert-actions { display: flex; flex-direction: column; gap: 4px; }
        .action-btn {
            background: transparent;
            border: 1px solid var(--border-outer);
            color: var(--text-secondary);
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 10px;
            cursor: pointer;
            transition: all 0.2s;
        }
        .action-btn:hover { border-color: var(--text-muted); color: var(--text-primary); }
        .action-btn.danger:hover { border-color: var(--status-danger); color: var(--status-danger); }
        .filter-tab {
            background: transparent;
            border: 1px solid var(--border-outer);
            color: var(--text-secondary);
            padding: 6px 12px;
            border-radius: var(--radius-md);
            font-size: 11px;
            cursor: pointer;
            transition: all 0.2s;
        }
        .filter-tab:hover { border-color: var(--text-muted); color: var(--text-primary); }
        .filter-tab.active { background: var(--status-info); border-color: var(--status-info); color: white; }

        /* Compare Mode Sidebar */
        .compare-sidebar {
            position: fixed;
            top: 0;
            right: -480px;
            width: 480px;
            height: 100vh;
            background: var(--bg-panel);
            border-left: 1px solid var(--border-outer);
            box-shadow: -10px 0 40px rgba(0,0,0,0.3);
            z-index: 1500;
            display: flex;
            flex-direction: column;
            transition: right 0.3s ease;
        }
        .compare-sidebar.active { right: 0; }
        .compare-sidebar-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 16px 20px;
            border-bottom: 1px solid var(--border-outer);
            background: var(--bg-card);
        }
        .compare-sidebar-title {
            font-size: 13px;
            font-weight: 600;
            color: var(--text-primary);
            display: flex;
            align-items: center;
            gap: 8px;
        }
        .compare-sidebar-close {
            background: transparent;
            border: none;
            color: var(--text-muted);
            cursor: pointer;
            padding: 4px;
            border-radius: 4px;
            transition: all 0.2s;
        }
        .compare-sidebar-close:hover { color: var(--text-primary); background: var(--bg-card-hover); }
        .compare-grid {
            flex: 1;
            display: grid;
            grid-template-columns: 1fr 1fr;
            grid-template-rows: 1fr 1fr;
            gap: 1px;
            background: var(--border-outer);
            overflow: hidden;
        }
        .compare-slot {
            background: var(--bg-panel);
            padding: 16px;
            display: flex;
            flex-direction: column;
            gap: 12px;
            position: relative;
            overflow-y: auto;
        }
        .compare-slot.empty {
            align-items: center;
            justify-content: center;
            color: var(--text-muted);
            font-size: 11px;
        }
        .compare-slot-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
        }
        .compare-slot-name {
            font-family: var(--font-mono);
            font-size: 11px;
            font-weight: 600;
            color: var(--text-primary);
        }
        .compare-slot-remove {
            background: transparent;
            border: none;
            color: var(--text-muted);
            cursor: pointer;
            padding: 2px;
            font-size: 14px;
            opacity: 0;
            transition: opacity 0.2s;
        }
        .compare-slot:hover .compare-slot-remove { opacity: 1; }
        .compare-metrics {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }
        .compare-metric {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        .compare-metric-label {
            font-size: 10px;
            color: var(--text-muted);
            text-transform: uppercase;
        }
        .compare-metric-value {
            font-family: var(--font-mono);
            font-size: 12px;
            font-weight: 600;
            color: var(--text-secondary);
        }
        .compare-metric-value.positive { color: var(--status-success); }
        .compare-metric-value.negative { color: var(--status-danger); }
        .mini-chart {
            height: 60px;
            background: var(--bg-card);
            border-radius: var(--radius-sm);
            display: flex;
            align-items: flex-end;
            gap: 2px;
            padding: 4px;
        }
        .mini-bar {
            flex: 1;
            background: var(--status-info);
            border-radius: 2px 2px 0 0;
            opacity: 0.7;
        }
        .compare-sidebar-footer {
            padding: 16px 20px;
            border-top: 1px solid var(--border-outer);
            background: var(--bg-card);
        }
        .compare-actions {
            display: flex;
            gap: 8px;
        }
        
        /* Comparison Charts */
        .compare-charts {
            padding: 16px;
            border-top: 1px solid var(--border-outer);
            background: var(--bg-card);
        }
        .comparison-section {
            margin-bottom: 16px;
        }
        .comparison-section:last-child {
            margin-bottom: 0;
        }
        .comparison-label {
            font-size: 10px;
            font-weight: 600;
            color: var(--text-muted);
            text-transform: uppercase;
            letter-spacing: 0.05em;
            margin-bottom: 8px;
        }
        .comparison-bar-row {
            display: flex;
            align-items: center;
            gap: 8px;
            margin-bottom: 6px;
        }
        .comparison-name {
            font-family: var(--font-mono);
            font-size: 10px;
            color: var(--text-secondary);
            width: 90px;
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
        }
        .comparison-bar-container {
            flex: 1;
            height: 16px;
            background: var(--bg-panel);
            border-radius: 3px;
            overflow: hidden;
        }
        .comparison-bar {
            height: 100%;
            border-radius: 3px;
            transition: width 0.3s ease;
        }
        .comparison-bar.positive { background: var(--status-success); }
        .comparison-bar.warning { background: var(--status-warning); }
        .comparison-bar.danger { background: var(--status-danger); }
        .comparison-value {
            font-family: var(--font-mono);
            font-size: 11px;
            font-weight: 600;
            color: var(--text-primary);
            width: 40px;
            text-align: right;
        }
        
        .btn-compare {
            flex: 1;
            padding: 10px 16px;
            background: var(--bg-card);
            border: 1px solid var(--border-outer);
            border-radius: var(--radius-md);
            color: var(--text-secondary);
            font-size: 11px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
        }
        .btn-compare:hover { border-color: var(--status-info); color: var(--status-info); }
    </style>
<style id="__shell_hide__">
.top-nav{display:none!important;}
.connection-status,.system-clock,.clock,#clock,.live-indicator,.network-badge{display:none!important;}
html,body{height:100%;} body{overflow:auto;}

/* __table_fix__ */
.leaderboard-table{width:100%!important;border-collapse:collapse!important;table-layout:fixed!important;}
.leaderboard-table thead th{padding:10px 16px!important;text-align:left!important;font-size:10px!important;letter-spacing:.08em!important;text-transform:uppercase!important;color:var(--text-muted)!important;font-weight:700!important;border-bottom:1px solid var(--border-outer)!important;background:var(--bg-card)!important;position:sticky!important;top:0!important;z-index:2!important;}
.leaderboard-table tbody td{padding:10px 16px!important;border-bottom:1px solid var(--border-inner)!important;vertical-align:middle!important;font-size:11px!important;color:var(--text-secondary)!important;}
.leaderboard-table th.numeric,.leaderboard-table td.numeric{text-align:right!important;}
.leaderboard-table th:first-child,.leaderboard-table td:first-child{width:30px!important;padding-left:16px!important;}

</style>
</head>
<body>
    <nav class="top-nav">
        <div class="logo">ECHELON</div>
        <div class="nav-links">
            <a class="active">Markets</a>
            <a>Portfolio</a>
            <a>Analytics</a>
            <a>Alerts</a>
            <a>Agents</a>
        </div>
<div class="nav-controls">
            <div class="balance-container">
                <span class="balance-label">Available</span>
                <span class="balance">$127,500.00</span>
            </div>
            <button class="create-timeline">
                <svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5">
                    <line x1="12" y1="5" x2="12" y2="19"></line>
                    <line x1="5" y1="12" x2="19" y2="12"></line>
                </svg>
                New Timeline
            </button>
            <!-- Alert Badge -->
            <button class="alert-badge-btn" id="alertBadgeBtn" onclick="toggleAlertPanel()">
              🔔 <span class="badge-count" id="alertCount">3</span>
            </button>
            <button class="btn-compare" onclick="toggleCompareSidebar()" style="padding: 8px 12px; font-size: 11px;">
              ⚖️ Compare
            </button>
            <button class="connect">0x84...9A2</button>
        </div>
    </nav>

    <div class="market-controls">
        <div class="search-container">
            <svg class="search-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <circle cx="11" cy="11" r="8"></circle>
                <path d="M21 21l-4.35-4.35"></path>
            </svg>
            <input type="text" placeholder="Search theatres, agents, events..." class="search-input" id="searchInput">
        </div>

        <div class="sort-controls">
            <select class="sort-select" id="sortSelect">
                <option>Sort: Most Active</option>
                <option>Sort: Highest Volume</option>
                <option>Sort: Newest</option>
                <option>Sort: Highest Instability</option>
            </select>
        </div>

        <div class="stats-bar">
            <div class="stat-item">
                <span class="stat-label">Markets</span>
                <span class="stat-value" id="marketCount">847</span>
            </div>
            <div class="stat-item">
                <span class="stat-label">24h Vol</span>
                <span class="stat-value" id="volume24h">$2.4M</span>
            </div>
            <div class="stat-item">
                <span class="stat-label">Forks</span>
                <span class="stat-value" id="forkCount">12</span>
            </div>
        </div>
    </div>

    <div class="category-nav" id="categoryNav">
        <button class="category active" data-category="all">All Markets</button>
        <button class="category" data-category="robotics">
            <span class="category-icon">🦾</span>Robotics
        </button>
        <button class="category" data-category="logistics">
            <span class="category-icon">🚛</span>Logistics
        </button>
        <button class="category" data-category="defi">
            <span class="category-icon">💸</span>DeFi / Econ
        </button>
        <button class="category" data-category="physics">
            <span class="category-icon">🧪</span>Physics
        </button>
        <button class="category" data-category="soceng">
            <span class="category-icon">🎭</span>SocEng
        </button>
    </div>

    <div class="app-container">
        <div class="main-content">
            <div class="live-ribbon-container">
                <div class="ribbon-items" id="ribbonItems">
                    <!-- Ribbon items populated by JS -->
                </div>
            </div>

            <div class="section-header">
                <span class="section-title">Active Theatres</span>
                <span class="section-count" id="activeCount">847 LIVE</span>
            </div>

            <div class="market-grid" id="marketGrid">
                <!-- Market cards populated by JS -->
            </div>
        </div>

        <div class="sidebar">
            <div class="sidebar-section" style="flex: 1.5;">
                <div class="sidebar-header">
                    <span class="sidebar-title">
                        📡 Signal Intercepts
                        <span class="live-badge">LIVE</span>
                    </span>
                    <a class="view-all-link">Full Feed →</a>
                </div>
                <div class="intercepts-list" id="interceptsList">
                    <!-- Intercepts populated by JS -->
                </div>
                <div class="intercept-source">
                    SRC: OSINT / SENSORS / ON-CHAIN
                </div>
            </div>

            <div class="sidebar-section">
                <div class="sidebar-header">
                    <span class="sidebar-title">⚠️ Active Breaches</span>
                    <span class="view-all-link">9 Active</span>
                </div>
                <div class="breaches-list" id="breachesList">
                    <!-- Breaches populated by JS -->
                </div>
            </div>
        </div>
    </div>

    <script>
        // Market Data
        const marketData = [
            {
                id: 1,
                category: 'robotics',
                categoryIcon: '🦾',
                categoryName: 'Robotics',
                title: 'Orbital Salvage: Will Option B successfully secure debris?',
                stability: 87,
                stabilityStatus: 'Stable',
                stabilityClass: 'stable',
                yesPrice: 3.80,
                yesProb: 62,
                noPrice: 2.40,
                noProb: 38,
                liquidity: 12800,
                forkTime: '04m:32s',
                gap: 12.4,
                gapWarning: false
            },
            {
                id: 2,
                category: 'robotics',
                categoryIcon: '🦾',
                categoryName: 'Robotics',
                title: 'Disaster Response: Will rescue bot reach target within 5 min?',
                stability: 53,
                stabilityStatus: 'Degraded',
                stabilityClass: 'warning',
                yesPrice: 2.15,
                yesProb: 48,
                noPrice: 2.35,
                noProb: 52,
                liquidity: 8400,
                forkTime: '08m:15s',
                gap: 47.0,
                gapWarning: true,
                gapDanger: true
            },
            {
                id: 3,
                category: 'logistics',
                categoryIcon: '🚛',
                categoryName: 'Logistics',
                title: 'Neon Courier: Will delivery route optimize under constraints?',
                stability: 91,
                stabilityStatus: 'Stable',
                stabilityClass: 'stable',
                yesPrice: 4.20,
                yesProb: 78,
                noPrice: 1.40,
                noProb: 22,
                liquidity: 24200,
                forkTime: '15m:00s',
                gap: 6.2,
                gapWarning: false
            },
            {
                id: 4,
                category: 'defi',
                categoryIcon: '💸',
                categoryName: 'DeFi',
                title: 'DeFi Yield: Will strategy sustain 15% APY under stress?',
                stability: 34,
                stabilityStatus: 'Critical',
                stabilityClass: 'critical',
                yesPrice: 1.85,
                yesProb: 42,
                noPrice: 2.60,
                noProb: 58,
                liquidity: 18700,
                forkTime: '22m:00s',
                gap: 52.0,
                gapWarning: false,
                gapDanger: true
            },
            {
                id: 5,
                category: 'physics',
                categoryIcon: '🧪',
                categoryName: 'Physics',
                title: 'Quantum Test: Will entanglement maintain coherence for 10s?',
                stability: 76,
                stabilityStatus: 'Stable',
                stabilityClass: 'stable',
                yesPrice: 2.90,
                yesProb: 55,
                noPrice: 2.45,
                noProb: 45,
                liquidity: 6200,
                forkTime: '45m:00s',
                gap: 18.0,
                gapWarning: true
            },
            {
                id: 6,
                category: 'logistics',
                categoryIcon: '🚛',
                categoryName: 'Logistics',
                title: 'Asteroid Mining: Will extraction yield exceed 500kg?',
                stability: 62,
                stabilityStatus: 'Degraded',
                stabilityClass: 'warning',
                yesPrice: 3.45,
                yesProb: 68,
                noPrice: 1.90,
                noProb: 32,
                liquidity: 31500,
                forkTime: '1h 12m',
                gap: 24.0,
                gapWarning: true
            }
        ];

        // Ribbon Events
        const ribbonEvents = [
            { type: 'fork', title: 'Fork #7 — Option B', time: '4m' },
            { type: 'paradox', title: 'ORB_SALVAGE_F7 Paradox', time: '7m' },
            { type: 'flip', title: 'Consensus Shift Detected', time: '12m' },
            { type: 'sabotage', title: 'Signal Interference Detected', time: '18m' },
            { type: 'settle', title: 'Fork #6 Final Settlement', time: '24m' },
            { type: 'fork', title: 'Fork #5 — Option A', time: '32m' }
        ];

        // Signal Intercepts
        const intercepts = [
            { agent: 'CARDINAL', agentIcon: '🕵️', theatre: 'orbital_salvage_v1', content: 'Detected micro-debris field approaching Station Alpha. Probability of Option B failure: 68%', time: '14:32:05', actions: ['Theatre', 'Trade'] },
            { agent: 'MEGALODON', agentIcon: '🦈', theatre: 'defi_yield_strategy', content: 'Flash loan vulnerability detected in reserve contract. Paradox spawn likely within 15 minutes', time: '14:26:42', actions: ['Shield'] },
            { agent: 'CHAMELEON', agentIcon: '🎭', theatre: 'blacksite_heist_b2', content: 'Target increased security posture. Deception success probability dropped from 72% to 54%', time: '14:18:11', actions: ['Adjust'] },
            { agent: 'VULTURE', agentIcon: '🎯', theatre: 'neon_courier_f3', content: 'Traffic pattern analysis complete. Optimal route deviation detected — may indicate sensor manipulation', time: '14:10:05', actions: ['Verify'] }
        ];

        // Breaches
        const breaches = [
            { severity: 'critical', category: 'PARADOX', title: 'Logical contradiction in Fork #7 scenario', time: '4m' },
            { severity: 'high', category: 'STABILITY', title: 'Stability collapse detected in Option B', time: '12m' },
            { severity: 'medium', category: 'ORACLE', title: 'Oracle price deviation exceeds threshold', time: '28m' },
            { severity: 'low', category: 'SENSOR', title: 'Minor sensor contradiction in data feed', time: '1h' }
        ];

        // Render Functions
        function renderMarketCards(filteredMarkets) {
            const grid = document.getElementById('marketGrid');
            grid.innerHTML = filteredMarkets.map(market => \`
                <div class="market-card" data-id="\${market.id}">
                    <div class="card-header">
                        <span class="category-badge \${market.category}">\${market.categoryIcon} \${market.categoryName}</span>
                        <div class="stability-wrapper">
                            <span class="stability-label">\${market.stabilityStatus}</span>
                            <div class="stability-gauge">
                                <div class="gauge-fill \${market.stabilityClass}" style="width: \${market.stability}%"></div>
                            </div>
                        </div>
                    </div>
                    <div class="card-title">\${market.title}</div>
                    <div class="outcomes">
                        <div class="outcome positive">
                            <div class="outcome-top">
                                <span class="outcome-label">YES</span>
                                <span class="outcome-prob">\${market.yesProb}%</span>
                            </div>
                            <span class="outcome-price positive">$\${market.yesPrice.toFixed(2)}</span>
                        </div>
                        <div class="outcome negative">
                            <div class="outcome-top">
                                <span class="outcome-label">NO</span>
                                <span class="outcome-prob">\${market.noProb}%</span>
                            </div>
                            <span class="outcome-price negative">$\${market.noPrice.toFixed(2)}</span>
                        </div>
                    </div>
                    <div class="card-footer">
                        <div class="card-metric">
                            <span class="card-metric-label">Liquidity</span>
                            <span class="card-metric-value">$\${(market.liquidity / 1000).toFixed(1)}K</span>
                        </div>
                        <div class="card-metric">
                            <span class="card-metric-label">Fork In</span>
                            <span class="card-metric-value">\${market.forkTime}</span>
                        </div>
                        <div class="card-metric">
                            <span class="card-metric-label">Gap</span>
                            <span class="card-metric-value \${market.gapDanger ? 'danger' : market.gapWarning ? 'warning' : ''}">\${market.gap.toFixed(1)}%</span>
                        </div>
                    </div>
                </div>
            \`).join('');

            // Add click handlers
            document.querySelectorAll('.market-card').forEach(card => {
                card.addEventListener('click', () => {
                    const id = card.dataset.id;
                    console.log('Opening market theatre:', id);
                });
            });
        }

        function renderRibbon() {
            const container = document.getElementById('ribbonItems');
            container.innerHTML = ribbonEvents.map(event => \`
                <div class="ribbon-item">
                    <span class="event-tag \${event.type}">\${event.type.toUpperCase()}</span>
                    <span class="ribbon-title">\${event.title}</span>
                    <span class="ribbon-time">\${event.time}</span>
                </div>
            \`).join('');
        }

        function renderIntercepts() {
            const container = document.getElementById('interceptsList');
            container.innerHTML = intercepts.map(intercept => \`
                <div class="intercept-card">
                    <div class="intercept-header">
                        <div class="agent-pill">
                            <span>\${intercept.agentIcon}</span>
                            <span class="agent-name">\${intercept.agent}</span>
                        </div>
                        <span class="intercept-timestamp">\${intercept.time}</span>
                    </div>
                    <div class="intercept-content">
                        <strong>\${intercept.theatre}:</strong> \${intercept.content}
                    </div>
                    <div class="intercept-actions">
                        \${intercept.actions.map(action => \`<button class="mini-btn">\${action}</button>\`).join('')}
                    </div>
                </div>
            \`).join('');
        }

        function renderBreaches() {
            const container = document.getElementById('breachesList');
            container.innerHTML = breaches.map(breach => \`
                <div class="breach-item">
                    <div class="breach-top">
                        <span class="severity-dot \${breach.severity}"></span>
                        <span class="breach-category">\${breach.category}</span>
                        <span class="breach-time">\${breach.time}</span>
                    </div>
                    <div class="breach-title">\${breach.title}</div>
                </div>
            \`).join('');
        }

        // Category Filter
        function setupCategoryFilter() {
            document.querySelectorAll('.category').forEach(btn => {
                btn.addEventListener('click', function() {
                    document.querySelectorAll('.category').forEach(b => b.classList.remove('active'));
                    this.classList.add('active');
                    
                    const category = this.dataset.category;
                    if (category === 'all') {
                        renderMarketCards(marketData);
                        document.getElementById('activeCount').textContent = marketData.length + ' LIVE';
                    } else {
                        const filtered = marketData.filter(m => m.category === category);
                        renderMarketCards(filtered);
                        document.getElementById('activeCount').textContent = filtered.length + ' LIVE';
                    }
                });
            });
        }

        // Search
        function setupSearch() {
            const input = document.getElementById('searchInput');
            input.addEventListener('keypress', function(e) {
                if (e.key === 'Enter') {
                    const query = this.value.toLowerCase();
                    if (query) {
                        const filtered = marketData.filter(m => 
                            m.title.toLowerCase().includes(query) ||
                            m.categoryName.toLowerCase().includes(query)
                        );
                        renderMarketCards(filtered);
                        document.getElementById('activeCount').textContent = filtered.length + ' LIVE';
                    } else {
                        renderMarketCards(marketData);
                        document.getElementById('activeCount').textContent = marketData.length + ' LIVE';
                    }
                }
            });
        }

        // Sort
        function setupSort() {
            const select = document.getElementById('sortSelect');
            select.addEventListener('change', function() {
                const value = this.value;
                let sorted = [...marketData];
                
                if (value.includes('Most Active')) {
                    sorted.sort((a, b) => b.liquidity - a.liquidity);
                } else if (value.includes('Highest Volume')) {
                    sorted.sort((a, b) => b.liquidity - a.liquidity);
                } else if (value.includes('Newest')) {
                    sorted.sort((a, b) => b.id - a.id);
                } else if (value.includes('Instability')) {
                    sorted.sort((a, b) => b.gap - a.gap);
                }
                
                renderMarketCards(sorted);
            });
        }

        // Initialize
        function init() {
            renderMarketCards(marketData);
            renderRibbon();
            renderIntercepts();
            renderBreaches();
            setupCategoryFilter();
            setupSearch();
            setupSort();
        }

        init();

        /* ============================================
           INTEGRATED ALERT SYSTEM JS
           ============================================ */

        // Alert Data
        const alertsData = [
            { id: 1, type: 'price', icon: '💰', title: 'Price Target Hit', description: 'ORB_SALVAGE_F7 crossed $4.00', theatre: 'ORB_SALVAGE_F7', condition: 'Price ≥ $4.00', status: 'triggered', unread: true, time: '14:32:00' },
            { id: 2, type: 'stability', icon: '📊', title: 'Stability Threshold', description: 'Stability dropped below 50%', theatre: 'VEN_OIL_TANKER', condition: 'Stability < 50%', status: 'active', unread: true, time: '14:28:15' },
            { id: 3, type: 'gap', icon: '📐', title: 'Logic Gap Alert', description: 'Gap exceeded 20% margin', theatre: 'FED_RATE_DECISION', condition: 'Gap > 20%', status: 'active', unread: true, time: '14:15:30' },
            { id: 4, type: 'volume', icon: '📈', title: 'Volume Spike', description: 'Trading volume increased 3x', theatre: 'TAIWAN_STRAIT', condition: 'Volume > 200% avg', status: 'resolved', unread: false, time: '13:45:00' },
            { id: 5, type: 'paradox', icon: '🔮', title: 'Paradox Detected', description: 'Contradictory agent signals', theatre: 'PUTIN_HEALTH_RUMORS', condition: 'Paradox score > 80', status: 'active', unread: false, time: '12:20:00' },
            { id: 6, type: 'price', icon: '💰', title: 'Price Target Hit', description: 'SPACEX_LAUNCH crossed $3.00', theatre: 'SPACEX_LAUNCH', condition: 'Price ≥ $3.00', status: 'resolved', unread: false, time: '11:20:00' }
        ];

        const compareTheatres = [
            { id: 'orb_salvage_f7', name: 'ORB_SALVAGE_F7', price: 3.82, change: '+12.4%', stability: 72, gap: 12, volume: '$2.4M', probability: 68, forkIn: '45s' },
            { id: 'ven_oil_tanker', name: 'VEN_OIL_TANKER', price: 2.15, change: '-3.2%', stability: 45, gap: 28, volume: '$890K', probability: 52, forkIn: '2m' },
            { id: 'fed_rate', name: 'FED_RATE_DECISION', price: 3.45, change: '+8.7%', stability: 58, gap: 18, volume: '$1.2M', probability: 61, forkIn: '30s' },
            { id: 'taiwan_strait', name: 'TAIWAN_STRAIT', price: 4.20, change: '-1.5%', stability: 33, gap: 42, volume: '$3.1M', probability: 74, forkIn: '15s' },
            { id: 'putin_health', name: 'PUTIN_HEALTH_RUMORS', price: 1.85, change: '+22.1%', stability: 28, gap: 55, volume: '$567K', probability: 41, forkIn: '5m' },
            { id: 'spacex_launch', name: 'SPACEX_LAUNCH', price: 2.90, change: '+5.3%', stability: 81, gap: 8, volume: '$1.8M', probability: 55, forkIn: '1h' }
        ];

        let compareSlots = { 1: null, 2: null, 3: null, 4: null };

        // Toggle Alert Panel
        window.toggleAlertPanel = function() {
            const panel = document.getElementById('alertPanel');
            panel.classList.toggle('active');
            if (panel.classList.contains('active')) {
                renderAlertNotifications();
            }
        };

        // Toggle Compare Sidebar
        window.toggleCompareSidebar = function() {
            const sidebar = document.getElementById('compareSidebar');
            sidebar.classList.toggle('active');
        };

        // Render Alert Notifications
        function renderAlertNotifications() {
            const container = document.getElementById('alertList');
            const unreadCount = alertsData.filter(a => a.unread).length;
            document.getElementById('alertCount').textContent = unreadCount;
            document.getElementById('alertBadgeBtn').classList.toggle('has-unread', unreadCount > 0);
            
            container.innerHTML = alertsData.map(alert => {
                let severity = 'info';
                let severityLabel = 'Alert';
                if (alert.type === 'gap' || alert.type === 'paradox') {
                    severity = alert.status === 'triggered' ? 'critical' : 'warning';
                    severityLabel = alert.type === 'gap' ? 'GAP' : 'PARADOX';
                } else if (alert.type === 'stability') {
                    severity = 'warning';
                } else if (alert.type === 'price') {
                    severity = 'info';
                } else if (alert.type === 'volume') {
                    severity = 'success';
                }
                if (alert.status === 'triggered') {
                    severity = 'critical';
                    severityLabel = 'TRIGGERED';
                } else if (alert.status === 'resolved') {
                    severity = 'success';
                    severityLabel = 'RESOLVED';
                }
                
                return \`
                    <div class="alert-notification-item \${alert.unread ? 'unread' : ''} \${severity}" onclick="handleAlertClick(\${alert.id})">
                        <div class="alert-notification-icon \${alert.type}">\${alert.icon}</div>
                        <div class="alert-notification-content">
                            <div class="alert-notification-header">
                                <span class="alert-notification-title">\${alert.title}</span>
                                <span class="alert-severity \${severity}">\${severityLabel}</span>
                            </div>
                            <div class="alert-notification-desc">\${alert.description}</div>
                            <div class="alert-notification-meta">
                                <span>\${alert.theatre}</span>
                                <span>\${alert.time}</span>
                            </div>
                            <div class="alert-actions-row">
                                <span class="alert-notification-condition">\${alert.condition}</span>
                                <button class="alert-action-btn" onclick="event.stopPropagation(); viewTheatre('\${alert.theatre}')">View Theatre</button>
                            </div>
                        </div>
                    </div>
                \`;
            }).join('');
        }

        // Handle Alert Click
        window.handleAlertClick = function(id) {
            const alert = alertsData.find(a => a.id === id);
            if (alert && alert.unread) {
                alert.unread = false;
                renderAlertNotifications();
            }
            openAlertModal();
        };

        // Open Alert Modal
        window.openAlertModal = function() {
            document.getElementById('alertModal').classList.add('active');
            renderAlertsList();
        };

        // Close Alert Modal
        window.closeAlertModal = function() {
            document.getElementById('alertModal').classList.remove('active');
        };

        // Render Alerts List in Modal
        function renderAlertsList() {
            const container = document.getElementById('alertsList');
            container.innerHTML = alertsData.map(alert => \`
                <div class="alert-item \${alert.status} \${alert.unread ? 'unread' : ''}" data-id="\${alert.id}">
                    <div class="alert-icon \${alert.type}">\${alert.icon}</div>
                    <div class="alert-content">
                        <div class="alert-title">\${alert.title}</div>
                        <div class="alert-description">\${alert.description}</div>
                        <div class="alert-meta">
                            <span>\${alert.theatre}</span>
                            <span>\${alert.time}</span>
                        </div>
                    </div>
                    <div class="alert-condition \${alert.status === 'triggered' ? 'triggered' : alert.status === 'resolved' ? 'fulfilled' : ''}">
                        \${alert.condition}
                    </div>
                    <div class="alert-actions">
                        <button class="action-btn" onclick="toggleAlert(\${alert.id})">
                            \${alert.status === 'active' ? 'Pause' : 'Enable'}
                        </button>
                        <button class="action-btn danger" onclick="deleteAlert(\${alert.id})">Delete</button>
                    </div>
                </div>
            \`).join('');
        }

        // Toggle Alert Status
        window.toggleAlert = function(id) {
            const alert = alertsData.find(a => a.id === id);
            if (alert) {
                alert.status = alert.status === 'active' ? 'paused' : 'active';
                renderAlertsList();
                renderAlertNotifications();
            }
        };

        // Delete Alert
        window.deleteAlert = function(id) {
            const index = alertsData.findIndex(a => a.id === id);
            if (index > -1) {
                alertsData.splice(index, 1);
                renderAlertsList();
                renderAlertNotifications();
            }
        };

        // Create New Alert
        window.createNewAlert = function() {
            const theatre = document.getElementById('alertTheatre').value;
            const type = document.getElementById('alertType').value;
            const field = document.getElementById('conditionField').value;
            const value = document.getElementById('conditionValue').value;

            if (!theatre || !value) return;

            const newAlert = {
                id: Date.now(),
                type: type,
                icon: type === 'price' ? '💰' : type === 'stability' ? '📊' : type === 'gap' ? '📐' : type === 'volume' ? '📈' : '🔮',
                title: type.charAt(0).toUpperCase() + type.slice(1) + ' Alert',
                description: \`\${theatre} \${field} condition triggered\`,
                theatre: theatre,
                condition: \`\${field} \${value}\`,
                status: 'active',
                unread: true,
                time: new Date().toLocaleTimeString('en-GB').slice(0, 8)
            };

            alertsData.unshift(newAlert);
            renderAlertsList();
            renderAlertNotifications();
            closeAlertModal();

            document.getElementById('alertTheatre').value = '';
            document.getElementById('conditionValue').value = '';
        };

        // Filter alerts in modal
        window.filterAlerts = function(btn) {
            document.querySelectorAll('.filter-tab').forEach(t => t.classList.remove('active'));
            btn.classList.add('active');
            const filter = btn.dataset.filter;
            renderAlertsListFiltered(filter);
        };

        function renderAlertsListFiltered(filter) {
            const container = document.getElementById('alertsList');
            let filtered = alertsData;
            if (filter === 'active') filtered = alertsData.filter(a => a.status === 'active');
            else if (filter === 'triggered') filtered = alertsData.filter(a => a.status === 'triggered');
            else if (filter === 'resolved') filtered = alertsData.filter(a => a.status === 'resolved');

            container.innerHTML = filtered.map(alert => \`
                <div class="alert-item \${alert.status} \${alert.unread ? 'unread' : ''}" data-id="\${alert.id}">
                    <div class="alert-icon \${alert.type}">\${alert.icon}</div>
                    <div class="alert-content">
                        <div class="alert-title">\${alert.title}</div>
                        <div class="alert-description">\${alert.description}</div>
                        <div class="alert-meta">
                            <span>\${alert.theatre}</span>
                            <span>\${alert.time}</span>
                        </div>
                    </div>
                    <div class="alert-condition \${alert.status === 'triggered' ? 'triggered' : alert.status === 'resolved' ? 'fulfilled' : ''}">
                        \${alert.condition}
                    </div>
                    <div class="alert-actions">
                        <button class="action-btn" onclick="toggleAlert(\${alert.id})">
                            \${alert.status === 'active' ? 'Pause' : 'Enable'}
                        </button>
                        <button class="action-btn danger" onclick="deleteAlert(\${alert.id})">Delete</button>
                    </div>
                </div>
            \`).join('');
        }

        // Mark all alerts as read
        window.markAllRead = function() {
            alertsData.forEach(a => a.unread = false);
            renderAlertNotifications();
        };

        // Compare Slots
        function renderCompareSlots() {
            for (let i = 1; i <= 4; i++) {
                const slot = document.getElementById(\`compareSlot\${i}\`);
                const theatre = compareSlots[i];

                if (!theatre) {
                    slot.innerHTML = \`
                        <div class="compare-slot empty" style="padding: 20px;">
                            <div style="text-align: center; width: 100%;">
                                <span style="font-size: 24px; margin-bottom: 12px; display: block;">+</span>
                                <select class="form-select" onchange="addTheatreToSlot(this.value, \${i})" style="width: 100%; margin-bottom: 8px; cursor: pointer;">
                                    <option value="">Select Theatre...</option>
                                    <option value="orb_salvage_f7">ORB_SALVAGE_F7</option>
                                    <option value="ven_oil_tanker">VEN_OIL_TANKER</option>
                                    <option value="fed_rate">FED_RATE_DECISION</option>
                                    <option value="taiwan_strait">TAIWAN_STRAIT</option>
                                    <option value="putin_health">PUTIN_HEALTH_RUMORS</option>
                                    <option value="spacex_launch">SPACEX_LAUNCH</option>
                                </select>
                                <span style="font-size: 11px; color: var(--text-muted);">Click to add</span>
                            </div>
                        </div>
                    \`;
                    slot.classList.add('empty');
                } else {
                    slot.classList.remove('empty');
                    const isPositive = theatre.change.includes('+');
                    slot.innerHTML = \`
                        <div class="compare-slot-header">
                            <span class="compare-slot-name">\${theatre.name}</span>
                            <button class="compare-slot-remove" onclick="removeFromSlot(\${i})">×</button>
                        </div>
                        <div class="mini-chart">
                            \${generateMiniBars()}
                        </div>
                        <div class="compare-metrics">
                            <div class="compare-metric">
                                <span class="compare-metric-label">Price</span>
                                <span class="compare-metric-value">$\${theatre.price.toFixed(2)}</span>
                            </div>
                            <div class="compare-metric">
                                <span class="compare-metric-label">24h</span>
                                <span class="compare-metric-value \${isPositive ? 'positive' : 'negative'}">\${theatre.change}</span>
                            </div>
                            <div class="compare-metric">
                                <span class="compare-metric-label">Stability</span>
                                <span class="compare-metric-value" style="color: \${theatre.stability > 60 ? 'var(--status-success)' : theatre.stability > 40 ? 'var(--status-warning)' : 'var(--status-danger)'}">\${theatre.stability}%</span>
                            </div>
                            <div class="compare-metric">
                                <span class="compare-metric-label">Logic Gap</span>
                                <span class="compare-metric-value" style="color: \${theatre.gap > 40 ? 'var(--status-danger)' : theatre.gap > 25 ? 'var(--status-warning)' : 'var(--status-success)'}">\${theatre.gap}%</span>
                            </div>
                            <div class="compare-metric">
                                <span class="compare-metric-label">Prob.</span>
                                <span class="compare-metric-value">\${theatre.probability}%</span>
                            </div>
                            <div class="compare-metric">
                                <span class="compare-metric-label">Volume</span>
                                <span class="compare-metric-value">\${theatre.volume}</span>
                            </div>
                            <div class="compare-metric">
                                <span class="compare-metric-label">Fork In</span>
                                <span class="compare-metric-value">\${theatre.forkIn}</span>
                            </div>
                        </div>
                    \`;
                }
            }
            renderCompareCharts();
            updateCompareButton();
        }

        function generateMiniBars() {
            let bars = '';
            for (let i = 0; i < 10; i++) {
                const height = 20 + Math.random() * 60;
                bars += \`<div class="mini-bar" style="height: \${height}%"></div>\`;
            }
            return bars;
        }

        // Visual comparison charts for selected theatres
        function renderCompareCharts() {
            const container = document.getElementById('compareCharts');
            const selected = Object.values(compareSlots).filter(t => t);
            
            if (selected.length < 2) {
                container.innerHTML = '<div style="padding: 20px; text-align: center; color: var(--text-muted); font-size: 11px;">Add 2+ theatres to see comparison</div>';
                container.style.display = 'none';
                return;
            }
            
            container.style.display = 'block';
            const maxStability = Math.max(...selected.map(t => t.stability));
            const maxGap = Math.max(...selected.map(t => t.gap));
            
            container.innerHTML = \`
                <div class="comparison-section">
                    <div class="comparison-label">Stability Comparison</div>
                    \${selected.map(t => \`
                        <div class="comparison-bar-row">
                            <span class="comparison-name">\${t.name.replace('_', ' ')}</span>
                            <div class="comparison-bar-container">
                                <div class="comparison-bar \${t.stability > 60 ? 'positive' : t.stability > 40 ? 'warning' : 'negative'}" style="width: \${(t.stability / maxStability) * 100}%"></div>
                            </div>
                            <span class="comparison-value">\${t.stability}%</span>
                        </div>
                    \`).join('')}
                </div>
                <div class="comparison-section">
                    <div class="comparison-label">Logic Gap Comparison</div>
                    \${selected.map(t => \`
                        <div class="comparison-bar-row">
                            <span class="comparison-name">\${t.name.replace('_', ' ')}</span>
                            <div class="comparison-bar-container">
                                <div class="comparison-bar \${t.gap > 40 ? 'danger' : t.gap > 25 ? 'warning' : 'positive'}" style="width: \${(t.gap / maxGap) * 100}%"></div>
                            </div>
                            <span class="comparison-value">\${t.gap}%</span>
                        </div>
                    \`).join('')}
                </div>
            \`;
        }

        window.addTheatreToSlot = function(theatreId, slotId) {
            if (!theatreId) return;
            const theatre = compareTheatres.find(t => t.id === theatreId);
            if (theatre) {
                compareSlots[slotId] = theatre;
                renderCompareSlots();
            }
        };

        window.removeFromSlot = function(slotId) {
            compareSlots[slotId] = null;
            renderCompareSlots();
        };

        function updateCompareButton() {
            const count = Object.values(compareSlots).filter(t => t).length;
            const btn = document.querySelector('.btn-compare');
            if (btn) {
                btn.style.background = count > 0 ? 'var(--status-info-bg)' : '';
                btn.style.borderColor = count > 0 ? 'var(--status-info)' : '';
            }
        }

        window.clearAllSlots = function() {
            compareSlots = { 1: null, 2: null, 3: null, 4: null };
            renderCompareSlots();
        };

        window.exportComparison = function() {
            const activeTheatres = Object.values(compareSlots).filter(t => t);
            if (activeTheatres.length === 0) return;
            const data = activeTheatres.map(t => \`\${t.name}: $\${t.price.toFixed(2)} (\${t.change})\`).join('\\n');
            alert('Comparison exported:\\n\\n' + data);
        };

        // Close panels when clicking outside
        document.addEventListener('click', function(e) {
            const panel = document.getElementById('alertPanel');
            const badge = document.getElementById('alertBadgeBtn');
            if (panel && badge && !panel.contains(e.target) && !badge.contains(e.target)) {
                panel.classList.remove('active');
            }
        });

    <\/script>

    <!-- Alert Notification Panel -->
    <div class="alert-panel" id="alertPanel">
        <div class="alert-panel-header">
            <div class="alert-panel-title">
                <span>🔔</span> Notifications
                <span class="badge-count" id="panelAlertCount">3</span>
            </div>
            <div class="alert-panel-actions">
                <button class="alert-panel-btn" onclick="openAlertModal()">Manage All</button>
                <button class="alert-panel-btn" onclick="markAllRead()">Mark Read</button>
            </div>
        </div>
        <div class="alert-list" id="alertList">
            <!-- Rendered by JS -->
        </div>
    </div>

    <!-- Alert Management Modal -->
    <div class="alert-modal-overlay" id="alertModal">
        <div class="alert-modal">
            <div class="alert-modal-header">
                <div class="alert-modal-title">Alert Management</div>
                <button class="alert-modal-close" onclick="closeAlertModal()">✕</button>
            </div>
            <div class="alert-modal-body">
                <div class="create-alert-form">
                    <div class="form-row">
                        <div class="form-group">
                            <label class="form-label">Theatre</label>
                            <select class="form-select" id="alertTheatre">
                                <option value="">Select Theatre...</option>
                                <option value="ORB_SALVAGE_F7">ORB_SALVAGE_F7</option>
                                <option value="VEN_OIL_TANKER">VEN_OIL_TANKER</option>
                                <option value="FED_RATE_DECISION">FED_RATE_DECISION</option>
                                <option value="TAIWAN_STRAIT">TAIWAN_STRAIT</option>
                                <option value="PUTIN_HEALTH_RUMORS">PUTIN_HEALTH_RUMORS</option>
                                <option value="SPACEX_LAUNCH">SPACEX_LAUNCH</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label class="form-label">Alert Type</label>
                            <select class="form-select" id="alertType">
                                <option value="price">Price Target</option>
                                <option value="stability">Stability</option>
                                <option value="gap">Logic Gap</option>
                                <option value="volume">Volume</option>
                                <option value="paradox">Paradox</option>
                            </select>
                        </div>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Condition</label>
                        <div class="condition-builder">
                            <select id="conditionField">
                                <option value="Price">Price</option>
                                <option value="Probability">Probability</option>
                                <option value="Stability">Stability</option>
                                <option value="Volume">Volume</option>
                            </select>
                            <span class="condition-operator">≥</span>
                            <input type="text" id="conditionValue" placeholder="Value (e.g., 4.00 or 50%)">
                        </div>
                    </div>
                    <button class="btn-primary" onclick="createNewAlert()">Create Alert</button>
                </div>

                <hr style="border: none; border-top: 1px solid var(--border-outer); margin: 20px 0;">

                <div style="display: flex; gap: 8px; margin-bottom: 16px;">
                    <button class="filter-tab active" data-filter="all" onclick="filterAlerts(this)">All</button>
                    <button class="filter-tab" data-filter="active" onclick="filterAlerts(this)">Active</button>
                    <button class="filter-tab" data-filter="triggered" onclick="filterAlerts(this)">Triggered</button>
                    <button class="filter-tab" data-filter="resolved" onclick="filterAlerts(this)">Resolved</button>
                </div>
                <div id="alertsList">
                    <!-- Rendered by JS -->
                </div>
            </div>
            <div class="alert-modal-footer">
                <button class="btn-secondary" onclick="closeAlertModal()">Close</button>
            </div>
        </div>
    </div>

    <!-- Compare Mode Sidebar -->
    <div class="compare-sidebar" id="compareSidebar">
        <div class="compare-sidebar-header">
            <div class="compare-sidebar-title">
                <span>⚖️</span> Compare Theatres
            </div>
            <button class="compare-sidebar-close" onclick="toggleCompareSidebar()">✕</button>
        </div>
        <div class="compare-grid">
            <div class="compare-slot" id="compareSlot1"></div>
            <div class="compare-slot" id="compareSlot2"></div>
            <div class="compare-slot" id="compareSlot3"></div>
            <div class="compare-slot" id="compareSlot4"></div>
        </div>
        <div class="compare-charts" id="compareCharts" style="display: none;"></div>
        <div class="compare-sidebar-footer">
            <div class="compare-actions">
                <button class="btn-compare" onclick="clearAllSlots()">Clear All</button>
                <button class="btn-compare" onclick="exportComparison()">Export</button>
            </div>
        </div>
    </div>

    <script>
    // Initialize compare slots after DOM is ready
    renderCompareSlots();
    <\/script>


<script>
(function(){
  function safeClick(sel){
    const el=document.querySelector(sel);
    if(el){ el.click(); return true; }
    return false;
  }
  function clickByText(tag, text){
    const els=[...document.querySelectorAll(tag)];
    const el=els.find(e=> (e.textContent||'').trim().toLowerCase().includes(text.toLowerCase()));
    if(el){ el.click(); return true; }
    return false;
  }
  window.addEventListener('message', function(ev){
    const msg = ev.data || {};
    if(!msg || msg.__echelon_shell__ !== true) return;
    const action = msg.action;
    if(!action) return;
    try{
      switch(action){
        case 'openAlert':
          safeClick('#alertBadgeBtn') || safeClick('.alert-badge-btn') || clickByText('button','alerts');
          break;
        case 'openCompare':
          safeClick('.btn-compare') || safeClick('[onclick*="toggleCompare"]') || safeClick('.compare-open') || safeClick('.compare-btn');
          break;
        case 'openSettings':
          clickByText('button','settings') || safeClick('[data-open="settings"]');
          break;
        case 'newPosition':
          clickByText('button','new position') || safeClick('.header-btn');
          break;
        case 'refresh':
          if(typeof window.refreshDashboard === 'function'){ window.refreshDashboard(); }
          clickByText('button','refresh');
          break;
        case 'marketView':
          clickByText('button','market view') || clickByText('a','market view');
          break;
        case 'roboticsView':
          clickByText('button','robotics view') || clickByText('a','robotics view');
          break;
        case 'agentRoster':
          clickByText('button','agent roster') || clickByText('a','agent roster');
          break;
        case 'globalIntel':
          clickByText('button','global intelligence') || clickByText('a','global intelligence');
          break;
        case 'deployAgent':
          clickByText('button','deploy agent') || clickByText('button','+ deploy');
          break;
        case 'breachConsole':
          clickByText('button','breach console') || clickByText('a','breach console');
          break;
        case 'exportConsole':
          clickByText('button','export console') || clickByText('a','export console');
          break;
        default:
          break;
      }
    }catch(e){ /* ignore */ }
  });
})();
<\/script>

</body>
</html>
`,
      blackbox: `<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Echelon Blackbox — Signal Intelligence Terminal v2</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=JetBrains+Mono:wght@400;500;600;700&display=swap" rel="stylesheet">
  <style>
    :root {
      /* Core Slate Palette */
      --slate-950: #0B0C0E;
      --slate-900: #121417;
      --slate-850: #151719;
      --slate-800: #1A1D21;
      --slate-750: #26292E;
      --slate-700: #363A40;

      /* Terminal Semantic Mappings */
      --bg-app: var(--slate-950);
      --bg-panel: var(--slate-850);
      --bg-card: var(--slate-900);
      --bg-card-hover: var(--slate-800);
      --border-outer: var(--slate-750);
      --border-inner: rgba(54, 58, 64, 0.5);
      
      /* Typography */
      --text-primary: #F1F5F9;
      --text-secondary: #94A3B8;
      --text-muted: #64748B;
      --font-sans: 'Inter', system-ui, sans-serif;
      --font-mono: 'JetBrains Mono', monospace;

      /* Status Colors (Marketplace Standard) */
      --status-success: #4ADE80;
      --status-success-bg: rgba(74, 222, 128, 0.1);
      --status-success-border: rgba(74, 222, 128, 0.2);
      
      --status-warning: #FACC15;
      --status-warning-bg: rgba(250, 204, 21, 0.1);
      
      --status-danger: #FB7185;
      --status-danger-bg: rgba(251, 113, 133, 0.1);
      
      --status-info: #3B82F6;
      --status-info-bg: rgba(59, 130, 246, 0.1);
      
      --status-paradox: #8B5CF6;
      --status-paradox-bg: rgba(139, 92, 246, 0.1);

      /* Layout Spacing */
      --space-xs: 4px;
      --space-sm: 8px;
      --space-md: 12px;
      --space-lg: 16px;
      --space-xl: 24px;
      --radius-sm: 6px;
      --radius-md: 8px;
      --radius-lg: 12px;
    }

    * { margin: 0; padding: 0; box-sizing: border-box; }

    body {
      font-family: var(--font-sans);
      background: var(--bg-app);
      color: var(--text-primary);
      font-size: 13px;
      line-height: 1.4;
      min-height: 100vh;
      overflow: hidden;
      -webkit-font-smoothing: antialiased;
    }

    /* Scrollbar styling to match Marketplace */
    ::-webkit-scrollbar { width: 6px; height: 6px; }
    ::-webkit-scrollbar-track { background: var(--bg-app); }
    ::-webkit-scrollbar-thumb { background: var(--border-outer); border-radius: 3px; }
    ::-webkit-scrollbar-thumb:hover { background: var(--slate-700); }

    .container { height: 100vh; display: flex; flex-direction: column; background: var(--bg-app); }
    
    /* Utility */
    .mono { font-family: var(--font-mono); font-variant-numeric: tabular-nums; }
    .numeric { font-family: var(--font-mono); text-align: right; }
    .positive { color: var(--status-success); }
    .negative { color: var(--status-danger); }
    .neutral { color: var(--text-secondary); }
    .warning { color: var(--status-warning); }
    .info { color: var(--status-info); }
    .flex-center { display: flex; align-items: center; }

    /* --- TOP NAVIGATION (Matching Marketplace) --- */
    .top-nav {
      flex-shrink: 0;
      height: 56px;
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 0 var(--space-xl);
      background: var(--bg-panel);
      border-bottom: 1px solid var(--border-outer);
    }

    .nav-brand {
      display: flex;
      align-items: center;
      gap: var(--space-md);
    }

    .brand-logo {
      font-size: 16px;
      font-weight: 700;
      letter-spacing: 0.1em;
      color: var(--text-primary);
    }
    
    .brand-version {
      font-size: 10px;
      color: var(--text-muted);
      background: var(--bg-app);
      padding: 2px 6px;
      border-radius: 4px;
      border: 1px solid var(--border-outer);
    }

    .nav-status {
      display: flex;
      align-items: center;
      gap: var(--space-xl);
    }

    .connection-status {
      display: flex;
      align-items: center;
      gap: 6px;
      font-size: 11px;
      font-weight: 600;
      color: var(--status-success);
      background: var(--status-success-bg);
      padding: 4px 10px;
      border-radius: 20px;
      border: 1px solid var(--status-success-border);
    }

    .live-dot {
      width: 6px;
      height: 6px;
      border-radius: 50%;
      background: var(--status-success);
      animation: pulse 2s infinite;
    }
    
    @keyframes pulse {
      0% { opacity: 1; }
      50% { opacity: 0.5; }
      100% { opacity: 1; }
    }

    .system-clock {
      font-family: var(--font-mono);
      font-size: 12px;
      color: var(--text-secondary);
    }

    .nav-controls {
      display: flex;
      gap: var(--space-md);
    }

    .nav-btn {
      display: flex;
      align-items: center;
      gap: 6px;
      padding: 6px 12px;
      background: var(--bg-card);
      border: 1px solid var(--border-outer);
      border-radius: var(--radius-md);
      color: var(--text-secondary);
      font-size: 11px;
      font-weight: 500;
      cursor: pointer;
      transition: all 0.2s;
    }
    .nav-btn:hover {
      border-color: var(--text-muted);
      color: var(--text-primary);
    }

    .clock {
        font-family: var(--font-mono);
        font-size: 12px;
        color: var(--text-secondary);
    }

    .ribbon-section {
        flex-shrink: 0;
        padding: var(--space-sm) var(--space-xl);
        background: var(--bg-app);
        border-bottom: 1px solid var(--border-outer);
        display: flex;
        align-items: center;
        gap: var(--space-md);
    }
    
    .ribbon-title {
        font-size: 10px;
        font-weight: 600;
        color: var(--status-danger);
        text-transform: uppercase;
        letter-spacing: 0.05em;
    }
    
    .ribbon-content { 
        display: flex; 
        gap: var(--space-md); 
        overflow-x: auto; 
        padding-bottom: 4px;
    }
    .ribbon-content::-webkit-scrollbar { display: none; }

    .ribbon-event {
      display: flex;
      align-items: center;
      gap: 10px;
      padding: 6px 12px;
      background: var(--bg-panel);
      border: 1px solid var(--border-outer);
      border-radius: 20px;
      cursor: pointer;
      flex-shrink: 0;
      transition: all 0.2s ease;
    }
    .ribbon-event:hover { 
        background: var(--bg-card-hover); 
        border-color: var(--text-muted); 
        transform: translateY(-1px);
    }

    .ribbon-tag {
        font-size: 9px;
        font-weight: 700;
        text-transform: uppercase;
        letter-spacing: 0.05em;
        padding: 2px 6px;
        border-radius: 4px;
        color: #000;
    }
    .ribbon-tag.market { background: var(--status-info); color: white; }
    .ribbon-tag.sabotage { background: var(--status-danger); color: white; }
    .ribbon-tag.shield { background: var(--status-success); color: #000; }
    .ribbon-tag.fork { background: var(--status-paradox); color: white; }

    .ribbon-text { font-size: 11px; color: var(--text-secondary); white-space: nowrap; }
    .ribbon-text b { color: var(--text-primary); }
    .ribbon-delta { font-family: var(--font-mono); font-size: 11px; margin-left: auto; }
    .ribbon-time { font-family: var(--font-mono); font-size: 10px; color: var(--text-muted); border-left: 1px solid var(--border-inner); padding-left: 8px; margin-left: 4px; }

    /* --- TAB NAVIGATION --- */
    .tab-nav {
      flex-shrink: 0;
      display: flex;
      gap: var(--space-sm);
      padding: var(--space-md) var(--space-xl);
      background: var(--bg-app);
      border-bottom: 1px solid var(--border-outer);
    }

    .tab-btn {
      display: flex;
      align-items: center;
      gap: 6px;
      padding: 8px 16px;
      background: transparent;
      border: 1px solid transparent;
      border-radius: 20px;
      color: var(--text-secondary);
      font-size: 12px;
      font-weight: 500;
      cursor: pointer;
      transition: all 0.2s ease;
    }
    .tab-btn:hover { 
        color: var(--text-primary); 
        background: var(--bg-card); 
    }
    .tab-btn.active { 
        color: var(--text-primary); 
        background: var(--bg-panel); 
        border-color: var(--border-outer);
        font-weight: 600;
    }

    /* --- MAIN LAYOUT --- */
    .tab-content { 
        flex: 1; 
        min-height: 0; 
        overflow-y: hidden;
        background: var(--bg-app);
        display: none; 
    }
    .tab-content.active { display: flex; flex-direction: column; }

    .grid-layout {
        display: grid;
        grid-template-columns: 1fr 340px;
        gap: var(--space-lg);
        height: 100%;
        padding: var(--space-lg);
        overflow: hidden;
    }

    /* Panels & Cards */
    .panel {
        background: var(--bg-panel);
        border: 1px solid var(--border-outer);
        border-radius: var(--radius-lg);
        display: flex;
        flex-direction: column;
        overflow: hidden;
        box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
    }
    .panel-header {
        flex-shrink: 0;
        padding: var(--space-md) var(--space-lg);
        border-bottom: 1px solid var(--border-outer);
        display: flex;
        justify-content: space-between;
        align-items: center;
        background: rgba(18, 20, 23, 0.5);
    }
    .panel-title {
        font-size: 12px;
        font-weight: 600;
        text-transform: uppercase;
        letter-spacing: 0.05em;
        color: var(--text-primary);
        display: flex;
        align-items: center;
        gap: 8px;
    }
    .panel-controls { display: flex; gap: var(--space-sm); align-items: center; }

    /* --- CHART SECTION --- */
    .chart-section { display: flex; flex-direction: column; gap: var(--space-lg); min-width: 0; overflow: hidden; height: 100%; }
    
    .chart-container { flex: 0 0 45%; min-height: 250px; }
    .chart-main { position: relative; flex: 1; background: var(--bg-panel); padding: var(--space-sm) 0; }
    
    .timeframe-btn {
        background: transparent;
        border: none;
        color: var(--text-muted);
        font-size: 11px;
        font-weight: 500;
        cursor: pointer;
        padding: 2px 6px;
        border-radius: 4px;
    }
    .timeframe-btn:hover { color: var(--text-secondary); }
    .timeframe-btn.active { background: var(--bg-card); color: var(--text-primary); }

    /* Chart SVG elements */
    .chart-grid line { stroke: var(--border-inner); stroke-dasharray: 2 4; }
    .candle { transition: transform 0.1s; }
    .candle.up .candle-body, .candle.up .candle-wick { background: var(--status-success); }
    .candle.down .candle-body, .candle.down .candle-wick { background: var(--status-danger); }
    
    .current-price-line { border-top: 1px dashed var(--status-info); opacity: 0.8; }
    .current-price-label { background: var(--status-info); color: white; padding: 2px 6px; border-radius: 2px; font-size: 10px; }

    .volume-bars { height: 40px; border-top: 1px solid var(--border-inner); display: flex; align-items: flex-end; padding-top: 4px; gap: 1px; }
    .volume-bar { flex: 1; opacity: 0.3; }
    .volume-bar.up { background: var(--status-success); }
    .volume-bar.down { background: var(--status-danger); }

    .chart-indicators {
        border-top: 1px solid var(--border-outer);
        padding: var(--space-xs) var(--space-lg);
        display: flex;
        justify-content: space-between;
        font-size: 10px;
        background: var(--bg-card);
    }
    .indicator-item { display: flex; gap: 6px; align-items: center; }
    .indicator-label { color: var(--text-muted); font-weight: 600; }
    .indicator-val { font-family: var(--font-mono); color: var(--text-secondary); }

    /* --- BOTTOM SPLIT --- */
    .bottom-split {
        flex: 1;
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: var(--space-lg);
        min-height: 0;
    }
    
    .leaderboard-container {
        background: var(--bg-panel);
        border: 1px solid var(--border-outer);
        border-radius: var(--radius-lg);
        display: flex;
        flex-direction: column;
        overflow: hidden;
    }

    /* --- TIME & SALES --- */
    .data-list {
        flex: 1;
        overflow-y: auto;
        padding: 4px 0;
    }
    
    .data-row {
        display: flex;
        align-items: center;
        padding: 4px var(--space-lg);
        font-family: var(--font-mono);
        font-size: 11px;
        cursor: pointer;
    }
    .data-row:hover { background: var(--bg-card-hover); }
    .data-row.header {
        font-size: 10px;
        color: var(--text-muted);
        font-weight: 600;
        padding: 6px var(--space-lg);
        border-bottom: 1px solid var(--border-outer);
        background: var(--bg-card);
    }
    
    .col-time { width: 60px; color: var(--text-muted); }
    .col-price { width: 70px; text-align: right; font-weight: 600; }
    .col-size { width: 60px; text-align: right; color: var(--text-secondary); }
    .col-side { width: 50px; text-align: center; }
    .col-agent { flex: 1; }
    
    .side-badge {
        display: inline-block;
        padding: 1px 6px;
        border-radius: 3px;
        font-size: 9px;
        font-weight: 700;
    }
    .side-badge.buy { background: var(--status-success-bg); color: var(--status-success); }
    .side-badge.sell { background: var(--status-danger-bg); color: var(--status-danger); }

    /* --- LEADERBOARD --- */
    .leaderboard-list {
        flex: 1;
        overflow-y: auto;
    }
    
    .leaderboard-row {
        display: flex;
        align-items: center;
        padding: 6px var(--space-lg);
        font-size: 11px;
        border-bottom: 1px solid var(--border-inner);
        cursor: pointer;
    }
    .leaderboard-row:hover { background: var(--bg-card-hover); }
    .leaderboard-row.header {
        font-size: 10px;
        color: var(--text-muted);
        font-weight: 600;
        padding: 8px var(--space-lg);
        background: var(--bg-card);
        border-bottom: 1px solid var(--border-outer);
        position: sticky;
        top: 0;
    }
    
    .rank-col { width: 30px; }
    .agent-col { flex: 1; display: flex; align-items: center; gap: 8px; }
    .metric-col { width: 70px; text-align: right; font-family: var(--font-mono); }

    .agent-avatar {
        width: 24px;
        height: 24px;
        border-radius: 4px;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 11px;
        font-weight: 700;
        color: #fff;
    }

    /* Leaderboard agent cell (match data + naming convention) */
    .agent-cell {
        display: flex;
        flex-direction: column;
        gap: 6px;
        align-items: flex-start;
        line-height: 1.1;
    }
    .agent-name {
        font-size: 12px;
        font-weight: 700;
        letter-spacing: 0.02em;
        color: var(--text-primary);
        text-transform: uppercase;
    }

    /* --- RIGHT SIDEBAR --- */
    .sidebar-section {
        display: flex;
        flex-direction: column;
        gap: var(--space-lg);
        min-width: 0;
        overflow: hidden;
    }
    
    .order-book-container {
        flex: 1;
        min-height: 0;
    }

    .book-sides {
        flex: 1;
        display: flex;
        flex-direction: column;
        overflow: hidden;
    }
    
    .book-header-info { display: flex; justify-content: space-between; padding: var(--space-sm) var(--space-lg); font-size: 11px; background: var(--bg-card); border-bottom: 1px solid var(--border-inner); }
    
    .book-row {
        display: flex;
        align-items: center;
        padding: 4px var(--space-lg);
        position: relative;
        font-family: var(--font-mono);
        font-size: 11px;
        cursor: pointer;
    }
    .book-row:hover { background: var(--bg-card-hover); }
    .depth-bar { position: absolute; top: 0; bottom: 0; opacity: 0.15; z-index: 0; }
    .depth-bar.bid { background: var(--status-success); right: 0; }
    .depth-bar.ask { background: var(--status-danger); right: 0; }
    
    .book-price { width: 60px; text-align: right; font-weight: 600; z-index: 1; }
    .book-size { margin-left: auto; color: var(--text-secondary); z-index: 1; }

    .spread-indicator {
        padding: 6px var(--space-lg);
        display: flex;
        justify-content: space-between;
        font-size: 10px;
        color: var(--text-muted);
        background: var(--bg-card);
        border-top: 1px solid var(--border-inner);
        border-bottom: 1px solid var(--border-inner);
    }

    /* --- INTERCEPTS PANEL --- */
    .intercepts-panel {
        flex: 1;
        overflow-y: auto;
        padding: var(--space-sm);
    }
    
    .intercept-item {
        display: flex;
        align-items: flex-start;
        gap: 10px;
        padding: 10px;
        border-radius: var(--radius-md);
        margin-bottom: 4px;
        border-left: 3px solid transparent;
        cursor: pointer;
        transition: all 0.2s;
    }
    .intercept-item:hover { background: var(--bg-card-hover); }
    
    .intercept-icon {
        width: 28px;
        height: 28px;
        border-radius: 6px;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 14px;
        flex-shrink: 0;
    }
    
    .intercept-content { flex: 1; min-width: 0; }
    .intercept-header { display: flex; justify-content: space-between; align-items: baseline; margin-bottom: 2px; }
    .intercept-title { font-size: 11px; font-weight: 600; color: var(--text-primary); }
    .intercept-time { font-size: 10px; color: var(--text-muted); font-family: var(--font-mono); }
    .intercept-details { font-size: 10px; color: var(--text-secondary); margin-top: 2px; }
    .intercept-meta { display: flex; gap: 8px; margin-top: 4px; font-size: 9px; color: var(--text-muted); }
    .intercept-tag { padding: 1px 5px; background: var(--bg-app); border-radius: 3px; }

    /* --- FOOTER --- */
    .app-footer {
        flex-shrink: 0;
        background: var(--bg-panel);
        border-top: 1px solid var(--border-outer);
        padding: 4px var(--space-xl);
        display: flex;
        justify-content: space-between;
        font-size: 10px;
        color: var(--text-muted);
    }

    /* Helper Animations */
    @keyframes flash-green { 0% { background: var(--status-success-bg); } 100% { background: transparent; } }
    .flash-new { animation: flash-green 1s ease-out; }

    /* Form Elements */
    input[type="text"], select {
        background: var(--bg-app);
        border: 1px solid var(--border-outer);
        color: var(--text-primary);
        padding: 4px 8px;
        border-radius: 4px;
        font-family: var(--font-sans);
        font-size: 11px;
        outline: none;
    }
    input[type="text"]:focus, select:focus { border-color: var(--status-info); }
    
    button.action-btn {
        background: var(--bg-card);
        border: 1px solid var(--border-outer);
        color: var(--text-secondary);
        padding: 4px 8px;
        border-radius: 4px;
        font-size: 10px;
        cursor: pointer;
    }
    button.action-btn:hover { border-color: var(--text-muted); color: var(--text-primary); }

  </style>
<style id="__shell_hide__">
.top-nav{display:none!important;}
.connection-status,.system-clock,.clock,#clock,.live-indicator,.network-badge{display:none!important;}
html,body{height:100%;} body{overflow:auto;}

/* __table_fix__ */
.leaderboard-table{width:100%!important;border-collapse:collapse!important;table-layout:fixed!important;}
.leaderboard-table thead th{padding:10px 16px!important;text-align:left!important;font-size:10px!important;letter-spacing:.08em!important;text-transform:uppercase!important;color:var(--text-muted)!important;font-weight:700!important;border-bottom:1px solid var(--border-outer)!important;background:var(--bg-card)!important;position:sticky!important;top:0!important;z-index:2!important;}
.leaderboard-table tbody td{padding:10px 16px!important;border-bottom:1px solid var(--border-inner)!important;vertical-align:middle!important;font-size:11px!important;color:var(--text-secondary)!important;}
.leaderboard-table th.numeric,.leaderboard-table td.numeric{text-align:right!important;}
.leaderboard-table th:first-child,.leaderboard-table td:first-child{width:30px!important;padding-left:16px!important;}

</style>
</head>
<body>
  <div class="container">
    
    <!-- Top Navigation -->
    <nav class="top-nav">
      <div class="nav-brand">
        <div class="brand-logo">ECHELON</div>
        <div class="brand-version">BLACKBOX</div>
      </div>
      <div class="nav-status">
        <div class="connection-status">
          <span class="live-dot"></span>
          CONNECTED
        </div>
        <span class="clock" id="clock">--:--:-- UTC</span>
      </div>
      <div class="nav-controls">
        <button class="nav-btn">
            <span>⚙️</span> Settings
        </button>
        <button class="nav-btn">
            <span>🔔</span> Alerts
        </button>
      </div>
    </nav>

    <!-- Live Intel Ribbon -->
    <div class="ribbon-section">
        <div class="ribbon-title">LIVE INTEL</div>
        <div class="ribbon-content" id="ribbonContent">
            <!-- Populated by JS -->
        </div>
    </div>

    <!-- Tab Navigation -->
    <div class="tab-nav">
      <button class="tab-btn active" data-tab="markets">
        Market Terminal
      </button>
      <button class="tab-btn" data-tab="intercepts">
        Signal Intercepts
      </button>
      <button class="tab-btn" data-tab="timeline">
        Timeline Health
      </button>
      <button class="tab-btn" data-tab="warchest">
        War Chest
      </button>
    </div>

    <!-- Main Tab Content -->
    <main class="tab-content active" id="markets">
        <div class="grid-layout">
            
            <!-- Left Column: Chart + Bottom Split -->
            <div class="chart-section">
                <!-- Chart -->
                <div class="panel chart-container">
                    <div class="panel-header">
                        <span class="panel-title">PRICE ACTION</span>
                        <div class="panel-controls">
                            <button class="timeframe-btn">1m</button>
                            <button class="timeframe-btn">5m</button>
                            <button class="timeframe-btn active">15m</button>
                            <button class="timeframe-btn">1H</button>
                        </div>
                    </div>
                    <div class="chart-main">
                        <svg class="chart-grid" id="chartGrid" style="position: absolute; width:100%; height:100%;" preserveAspectRatio="none"></svg>
                        <div id="candlesContainer" style="position: absolute; width:100%; height:100%;"></div>
                        <div class="current-price-line" id="currentPriceLine" style="position: absolute; left:0; right:0; bottom: 35%; display:flex; align-items:center;">
                             <span class="current-price-label" style="margin-left: auto;">$3.82</span>
                        </div>
                    </div>
                    <div class="volume-bars" id="volumeBars"></div>
                    <div class="chart-indicators">
                        <div class="indicator-item">
                            <span class="indicator-label">RSI</span> <span class="indicator-val">58.3</span>
                        </div>
                        <div class="indicator-item">
                            <span class="indicator-label">MACD</span> <span class="indicator-val positive">+0.12</span>
                        </div>
                        <div class="indicator-item">
                            <span class="indicator-label">VOL</span> <span class="indicator-val">142K</span>
                        </div>
                        <div class="indicator-item">
                            <span class="indicator-label">H</span> <span class="indicator-val">$4.02</span>
                            <span class="indicator-label" style="margin-left:4px;">L</span> <span class="indicator-val">$3.58</span>
                        </div>
                    </div>
                </div>

                <!-- Bottom Split -->
                <div class="bottom-split">
                    <!-- Time & Sales -->
                    <div class="panel">
                        <div class="panel-header">
                            <span class="panel-title">TIME & SALES</span>
                            <span class="mono neutral" style="font-size:10px;">LIVE FEED</span>
                        </div>
                        <div class="data-list">
                            <div class="data-row header">
                                <span class="col-time">TIME</span>
                                <span class="col-price">PRICE</span>
                                <span class="col-size">SIZE</span>
                                <span class="col-side">SIDE</span>
                                <span class="col-agent">AGENT</span>
                            </div>
                            <div id="tsList"></div>
                        </div>
                    </div>

                    <!-- Agent Leaderboard -->
                    <div class="panel">
                        <div class="panel-header">
                            <span class="panel-title">AGENT PERFORMANCE</span>
                            <div class="panel-controls">
                                <input type="text" id="leaderboardSearch" placeholder="Filter agents..." style="width: 100px;">
                            </div>
                        </div>
                        <div class="data-list">
                            <table class="leaderboard-table">
                                <thead>
                                    <tr>
                                        <th style="width:30px">#</th>
                                        <th>AGENT</th>
                                        <th class="numeric">P&L</th>
                                        <th class="numeric">VOL</th>
                                    </tr>
                                </thead>
                                <tbody id="leaderboardBody"></tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Right Sidebar: Order Book + Intercepts -->
            <div class="sidebar-section">
                <!-- Order Book -->
                <div class="panel order-book-container">
                    <div class="panel-header">
                        <span class="panel-title">ORDER BOOK</span>
                        <span class="panel-title neutral mono" style="font-size:11px;">$3.82</span>
                    </div>
                    <div class="book-sides">
                        <div class="book-header-info">
                            <span>ASKS</span>
                            <span>Total: $1.2M</span>
                        </div>
                        <div id="asksContainer" style="display:flex; flex-direction:column-reverse;"></div>
                        
                        <div class="spread-indicator">
                            <span>SPREAD: 0.04</span>
                            <span>0.52%</span>
                        </div>
                        
                        <div id="bidsContainer"></div>
                        <div class="book-header-info" style="border-top:1px solid var(--border-inner); border-bottom:none;">
                            <span>BIDS</span>
                            <span>Total: $1.4M</span>
                        </div>
                    </div>
                </div>

                <!-- Signal Intercepts -->
                <div class="panel" style="flex: 1; min-height: 0;">
                    <div class="panel-header">
                        <span class="panel-title">SIGNAL INTERCEPTS</span>
<span style="font-size: 9px; padding: 2px 6px; background: var(--status-danger-bg); color: var(--status-danger); border-radius: 4px; font-weight: 600;">LIVE</span>
                    </div>
                    <div class="intercepts-panel" id="interceptsList"></div>
                </div>
            </div>
        </div>
    </main>
    
    <main class="tab-content" id="intercepts">
        <div style="padding: var(--space-xl);">
            <div class="panel" style="padding:0;">
                <div class="panel-header">
                    <span class="panel-title">SIGNAL LOGS</span>
                </div>
                <div class="data-list" style="height: 100%;">
                    <table class="leaderboard-table" style="width:100%;">
                         <thead>
                            <tr>
                                <th>TIME</th>
                                <th>TYPE</th>
                                <th>THEATRE</th>
                                <th>AGENT</th>
                                <th>ACTION</th>
                                <th class="numeric">VOLUME</th>
                            </tr>
                        </thead>
                        <tbody id="eventsTableBody"></tbody>
                    </table>
                </div>
            </div>
        </div>
    </main>
    
    <main class="tab-content" id="timeline">
        <div style="padding: var(--space-lg); overflow-y: auto;">
            <div style="display: grid; grid-template-columns: repeat(auto-fill, minmax(280px, 1fr)); gap: var(--space-lg);" id="timelineGrid"></div>
        </div>
    </main>
    
    <main class="tab-content" id="warchest">
        <div style="padding: var(--space-lg); overflow-y: auto;">
            <div style="display: grid; grid-template-columns: repeat(auto-fill, minmax(280px, 1fr)); gap: var(--space-lg);" id="warGrid"></div>
        </div>
    </main>

    <footer class="app-footer">
        <div class="flex-center" style="gap:16px;">
            <span><span class="live-dot"></span> System Optimal</span>
            <span>Latency: 12ms</span>
        </div>
        <div class="flex-center" style="gap:16px;">
            <span>Echelon Protocol Inc.</span>
            <span>Restricted Access</span>
        </div>
    </footer>

  </div>

  <script>
    /* ------------------------------------------------------------------
       DATA & CONFIGURATION
       ------------------------------------------------------------------ */
    const agentsData = [
      { name: 'LEVIATHAN', archetype: 'whale', pnl: '+24,560', winRate: '72.4%', sharpe: '2.34', trades: 87, volume: '$1.2M', status: 'Active' },
      { name: 'TITAN', archetype: 'shark', pnl: '+18,420', winRate: '68.2%', sharpe: '1.92', trades: 124, volume: '$890K', status: 'Active' },
      { name: 'AMBASSADOR', archetype: 'diplomat', pnl: '+15,870', winRate: '74.8%', sharpe: '2.15', trades: 62, volume: '$650K', status: 'Active' },
      { name: 'CARDINAL', archetype: 'spy', pnl: '+12,340', winRate: '81.2%', sharpe: '2.48', trades: 45, volume: '$420K', status: 'Active' },
      { name: 'DEPTH', archetype: 'whale', pnl: '+9,850', winRate: '65.4%', sharpe: '1.67', trades: 73, volume: '$380K', status: 'Active' },
      { name: 'STRIKER', archetype: 'shark', pnl: '+7,230', winRate: '58.9%', sharpe: '1.34', trades: 156, volume: '$920K', status: 'Active' },
      { name: 'HARBOR', archetype: 'diplomat', pnl: '+5,120', winRate: '69.7%', sharpe: '1.78', trades: 51, volume: '$280K', status: 'Active' },
      { name: 'CHAOS', archetype: 'saboteur', pnl: '-3,450', winRate: '42.1%', sharpe: '0.85', trades: 89, volume: '$540K', status: 'Active' },
    ];

    const archetypeColors = {
      whale: { text: 'var(--status-success)', icon: '🐋' },
      shark: { text: 'var(--status-info)', icon: '🦈' },
      diplomat: { text: 'var(--status-paradox)', icon: '🎭' },
      spy: { text: 'var(--status-warning)', icon: '🕵️' },
      saboteur: { text: 'var(--status-danger)', icon: '💣' },
    };

    const timelineData = [
      { id: 'TL-2847', title: 'ORBITAL SALVAGE F7', prob: 0.72, time: '48h', status: 'active', forks: 7, type: 'fork' },
      { id: 'TL-2846', title: 'FED RATE DECISION', prob: 0.58, time: '5d', status: 'active', forks: 3, type: 'market' },
      { id: 'TL-2845', title: 'VENUS OIL TANKER', prob: 0.45, time: '12d', status: 'warning', forks: 12, type: 'sabotage' },
      { id: 'TL-2844', title: 'TAIWAN STRAIT', prob: 0.62, time: '18d', status: 'active', forks: 5, type: 'shield' },
      { id: 'TL-2843', title: 'SPACEX LAUNCH', prob: 0.51, time: '26d', status: 'active', forks: 8, type: 'market' },
      { id: 'TL-2842', title: 'PUTIN HEALTH RUMORS', prob: 0.38, time: '1mo', status: 'collapsed', forks: 15, type: 'paradox' },
    ];

    /* ------------------------------------------------------------------
       UTILITY FUNCTIONS
       ------------------------------------------------------------------ */
    function generateId() { return Math.random().toString(36).substr(2, 9); }
    
    function formatTime() {
        const now = new Date();
        return now.toISOString().substr(11, 8) + ' UTC';
    }
    
    function updateClock() {
        document.getElementById('clock').textContent = formatTime();
    }
    setInterval(updateClock, 1000);
    updateClock();

    function getRandomInt(min, max) { return Math.floor(Math.random() * (max - min + 1)) + min; }
    function getRandomFloat(min, max, decimals = 2) { return (Math.random() * (max - min) + min).toFixed(decimals); }

    /* ------------------------------------------------------------------
       RIBBON EVENTS
       ------------------------------------------------------------------ */
    function initRibbon() {
        const events = [
            { type: 'market', theatre: 'ORB_SALVAGE_F7', agent: 'MEGALODON', action: 'Opened large position', delta: '+42K' },
            { type: 'shield', theatre: 'ORB_SALVAGE_F7', agent: 'AEGIS', action: 'Hedge placed', delta: '+28K' },
            { type: 'sabotage', theatre: 'FED_RATE_DECISION', agent: 'LEECH', action: 'Spread attack detected', delta: '-15K' },
            { type: 'fork', theatre: 'TL-2847', agent: 'GHOST', action: 'New fork detected', delta: '7 forks' },
        ];
        
        const container = document.getElementById('ribbonContent');
        container.innerHTML = events.map(e => \`
            <div class="ribbon-event">
                <span class="ribbon-tag \${e.type}">\${e.type.toUpperCase()}</span>
                <span class="ribbon-text"><b>\${e.theatre}</b> · \${e.agent} · \${e.action}</span>
                <span class="ribbon-delta positive">\${e.delta}</span>
                <span class="ribbon-time">\${formatTime()}</span>
            </div>
        \`).join('');
    }

    /* ------------------------------------------------------------------
       ORDER BOOK
       ------------------------------------------------------------------ */
    function initOrderBook() {
        const asksContainer = document.getElementById('asksContainer');
        const bidsContainer = document.getElementById('bidsContainer');
        
        let asksHtml = '';
        let bidsHtml = '';
        
        for (let i = 0; i < 12; i++) {
            const askPrice = (3.82 + 0.01 * (i + 1) + Math.random() * 0.005).toFixed(2);
            const askSize = getRandomInt(1000, 50000);
            const askDepth = Math.random() * 100;
            
            asksHtml += \`
                <div class="book-row">
                    <div class="depth-bar ask" style="width: \${askDepth}%"></div>
                    <span class="book-price negative">\${askPrice}</span>
                    <span class="book-size mono">\${(askSize/1000).toFixed(1)}K</span>
                </div>
            \`;
            
            const bidPrice = (3.82 - 0.01 * (i + 1) - Math.random() * 0.005).toFixed(2);
            const bidSize = getRandomInt(1000, 50000);
            const bidDepth = Math.random() * 100;
            
            bidsHtml += \`
                <div class="book-row">
                    <div class="depth-bar bid" style="width: \${bidDepth}%"></div>
                    <span class="book-price positive">\${bidPrice}</span>
                    <span class="book-size mono">\${(bidSize/1000).toFixed(1)}K</span>
                </div>
            \`;
        }
        
        asksContainer.innerHTML = asksHtml;
        bidsContainer.innerHTML = bidsHtml;
    }

    /* ------------------------------------------------------------------
       TIME & SALES
       ------------------------------------------------------------------ */
    function initTimeSales() {
        const container = document.getElementById('tsList');
        const agents = ['LEVIATHAN', 'TITAN', 'AMBASSADOR', 'CARDINAL', 'DEPTH', 'STRIKER'];
        
        let html = '';
        for (let i = 0; i < 20; i++) {
            const time = new Date(Date.now() - i * getRandomInt(5000, 30000)).toISOString().substr(11, 8);
            const price = (3.80 + Math.random() * 0.05).toFixed(2);
            const size = getRandomInt(1000, 25000);
            const side = Math.random() > 0.45 ? 'buy' : 'sell';
            const agent = agents[getRandomInt(0, agents.length - 1)];
            const colorClass = side === 'buy' ? 'positive' : 'negative';
            
            html += \`
                <div class="data-row">
                    <span class="col-time">\${time}</span>
                    <span class="col-price \${colorClass}">$\${price}</span>
                    <span class="col-size">\${(size/1000).toFixed(1)}K</span>
                    <span class="col-side"><span class="side-badge \${side}">\${side.toUpperCase()}</span></span>
                    <span class="col-agent">\${agent}</span>
                </div>
            \`;
        }
        container.innerHTML = html;
    }

    /* ------------------------------------------------------------------
       LEADERBOARD
       ------------------------------------------------------------------ */
    function initLeaderboard() {
        const container = document.getElementById('leaderboardBody');
        const searchInput = document.getElementById('leaderboardSearch');
        
        function render(filter = '') {
            const filtered = agentsData.filter(a => 
                a.name.toLowerCase().includes(filter.toLowerCase())
            ).sort((a, b) => parseFloat(b.pnl.replace(/[^0-9.-]/g, '')) - parseFloat(a.pnl.replace(/[^0-9.-]/g, '')));
            
            container.innerHTML = filtered.map((a, i) => {
                const pnlNum = parseFloat(String(a.pnl).replace(/[^0-9.-]/g, ''));
                return \`
                    <tr>
                        <td><span class="rank-badge \${i < 3 ? 'rank-' + (i + 1) : 'rank-other'}">\${i + 1}</span></td>
                        <td>
                            <div class="agent-cell">
                                <div class="agent-avatar" style="background: \${archetypeColors[a.archetype]?.text || '#666'}">\${a.name[0]}</div>
                                <div class="agent-name">\${a.name}</div>
                            </div>
                        </td>
                        <td class="numeric \${pnlNum >= 0 ? 'positive' : 'negative'}">\${a.pnl}</td>
                        <td class="numeric mono">\${a.volume}</td>
                    </tr>
                \`;
            }).join('');
        }
        
        searchInput.addEventListener('input', (e) => render(e.target.value));
        render();
    }

    /* ------------------------------------------------------------------
       INTERCEPTS
       ------------------------------------------------------------------ */
    function initIntercepts() {
        const intercepts = [
            { icon: '🎯', iconBg: 'var(--status-info-bg)', title: 'Large Buy Order', time: '14:32:45', details: 'WHALE agent accumulated 50K shares at $3.78', source: 'Order Flow', severity: 'info' },
            { icon: '⚠️', iconBg: 'var(--status-warning-bg)', title: 'Unusual Volume', time: '14:31:22', details: 'Volume spike 3x average on TL-2847', source: 'Volume Analyzer', severity: 'warning' },
            { icon: '💀', iconBg: 'var(--status-danger-bg)', title: 'Spread Manipulation', time: '14:30:18', details: 'SABOTEUR agent spreading asks to move price', source: 'Market Monitor', severity: 'critical' },
            { icon: '🔀', iconBg: 'var(--status-paradox-bg)', title: 'Fork Detected', time: '14:28:55', details: 'New timeline fork: TL-2847-fork-7', source: 'Fork Scanner', severity: 'info' },
            { icon: '🛡️', iconBg: 'var(--status-success-bg)', title: 'Hedge Placed', time: '14:27:12', details: 'DIPLOMAT agent opened protective position', source: 'Position Tracker', severity: 'success' },
        ];
        
        const container = document.getElementById('interceptsList');
        container.innerHTML = intercepts.map(i => \`
            <div class="intercept-item" style="border-left-color: \${i.severity === 'critical' ? 'var(--status-danger)' : i.severity === 'warning' ? 'var(--status-warning)' : i.severity === 'success' ? 'var(--status-success)' : 'var(--status-info)'}">
                <div class="intercept-icon" style="background: \${i.iconBg}">\${i.icon}</div>
                <div class="intercept-content">
                    <div class="intercept-header">
                        <span class="intercept-title">\${i.title}</span>
                        <span class="intercept-time">\${i.time}</span>
                    </div>
                    <div class="intercept-details">\${i.details}</div>
                    <div class="intercept-meta">
                        <span>Source: \${i.source}</span>
                        <span class="intercept-tag">\${i.severity.toUpperCase()}</span>
                    </div>
                </div>
            </div>
        \`).join('');
    }

    /* ------------------------------------------------------------------
       CHART
       ------------------------------------------------------------------ */
    function initChart() {
        const svg = document.getElementById('chartGrid');
        const candlesContainer = document.getElementById('candlesContainer');
        const volumeBars = document.getElementById('volumeBars');
        
        const width = 1000;
        const height = 300;
        const volumeHeight = 40;
        
        // Generate candles
        let currentPrice = 3.80;
        const candles = [];
        const numCandles = 60;
        
        for (let i = 0; i < numCandles; i++) {
            const open = currentPrice;
            const close = open + (Math.random() - 0.48) * 0.05;
            const high = Math.max(open, close) + Math.random() * 0.02;
            const low = Math.min(open, close) - Math.random() * 0.02;
            const volume = getRandomInt(10000, 50000);
            
            candles.push({ open, close, high, low, volume });
            currentPrice = close;
        }
        
        // Draw grid
        const gridLines = [];
        for (let i = 0; i <= 4; i++) {
            const y = (i / 4) * height;
            gridLines.push(\`<line x1="0" y1="\${y}" x2="\${width}" y2="\${y}" />\`);
        }
        svg.innerHTML = gridLines.join('');
        
        // Draw candles
        const candleWidth = width / numCandles - 2;
        const priceRange = Math.max(...candles.map(c => c.high)) - Math.min(...candles.map(c => c.low));
        const priceScale = height / priceRange;
        
        let candlesHtml = '';
        let volumesHtml = '';
        
        candles.forEach((candle, i) => {
            const x = i * (width / numCandles) + 1;
            const candleHeight = Math.max(1, (candle.high - candle.low) * priceScale);
            const bodyTop = (Math.max(candle.open, candle.close) - Math.min(...candles.map(c => c.low))) * priceScale;
            const bodyHeight = Math.max(1, Math.abs(candle.close - candle.open) * priceScale);
            const isUp = candle.close > candle.open;
            
            candlesHtml += \`
                <div class="candle \${isUp ? 'up' : 'down'}" style="position: absolute; left: \${x}px; top: \${height - (candle.high - Math.min(...candles.map(c => c.low))) * priceScale}px; width: \${candleWidth}px;">
                    <div class="candle-wick" style="position: absolute; left: 50%; transform: translateX(-50%); width: 1px; height: \${candleHeight}px;"></div>
                    <div class="candle-body" style="position: absolute; left: 50%; transform: translateX(-50%); width: \${candleWidth}px; height: \${bodyHeight}px; top: \${bodyTop - (candle.high - Math.min(...candles.map(c => c.low))) * priceScale}px;"></div>
                </div>
            \`;
            
            const volHeight = (candle.volume / 50000) * volumeHeight;
            const volColor = isUp ? 'up' : 'down';
            volumesHtml += \`<div class="volume-bar \${volColor}" style="height: \${volHeight}px; width: \${width / numCandles - 1}px;"></div>\`;
        });
        
        candlesContainer.innerHTML = candlesHtml;
        volumeBars.innerHTML = volumesHtml;
    }

    /* ------------------------------------------------------------------
       TIMELINE & WAR CHEST GRIDS
       ------------------------------------------------------------------ */
    function initGrids() {
        const timelineGrid = document.getElementById('timelineGrid');
        const warGrid = document.getElementById('warGrid');
        
        const typeColors = {
            fork: { bg: 'var(--status-paradox-bg)', text: 'var(--status-paradox)', icon: '🔀' },
            market: { bg: 'var(--status-info-bg)', text: 'var(--status-info)', icon: '📈' },
            sabotage: { bg: 'var(--status-danger-bg)', text: 'var(--status-danger)', icon: '💀' },
            shield: { bg: 'var(--status-success-bg)', text: 'var(--status-success)', icon: '🛡️' }
        };
        
        const statusColors = {
            active: { bg: 'var(--status-success-bg)', text: 'var(--status-success)' },
            warning: { bg: 'var(--status-warning-bg)', text: '#854d0e' },
            collapsed: { bg: 'var(--status-danger-bg)', text: 'var(--status-danger)' }
        };
        
        timelineGrid.innerHTML = timelineData.map(t => {
            const type = typeColors[t.type] || typeColors.market;
            const status = statusColors[t.status] || statusColors.active;
            return \`
                <div class="panel" style="cursor: pointer;">
                    <div class="panel-header" style="padding: 12px 16px;">
                        <span class="panel-title" style="font-size: 11px;">\${t.id}</span>
                        <span style="font-size: 9px; padding: 2px 6px; background: \${status.bg}; color: \${status.text}; border-radius: 4px; font-weight: 600; text-transform: uppercase;">\${t.status}</span>
                    </div>
                    <div style="padding: 16px;">
                        <div style="font-size: 14px; font-weight: 600; margin-bottom: 8px;">\${t.title}</div>
                        <div style="display: flex; gap: 16px; font-size: 11px; color: var(--text-secondary); margin-bottom: 12px;">
                            <span>Prob: <span style="color: \${t.prob > 0.5 ? 'var(--status-success)' : 'var(--text-secondary)'}">\${(t.prob * 100).toFixed(0)}%</span></span>
                            <span>ETA: \${t.time}</span>
                            <span>\${t.forks} forks</span>
                        </div>
                        <div style="display: flex; align-items: center; gap: 8px;">
                            <span style="font-size: 20px;">\${type.icon}</span>
                            <span style="font-size: 10px; padding: 3px 8px; background: \${type.bg}; color: \${type.text}; border-radius: 4px; font-weight: 600; text-transform: uppercase;">\${t.type}</span>
                        </div>
                    </div>
                </div>
            \`;
        }).join('');
        
        warGrid.innerHTML = timelineData.filter(t => t.type === 'fork' || t.status === 'warning').map(t => \`
            <div class="panel" style="cursor: pointer;">
                <div class="panel-header" style="padding: 12px 16px;">
                    <span class="panel-title" style="font-size: 11px;">\${t.id}</span>
                    <span style="font-size: 9px; padding: 2px 6px; background: var(--status-warning-bg); color: #854d0e; border-radius: 4px; font-weight: 600;">⚠️ ALERT</span>
                </div>
                <div style="padding: 16px;">
                    <div style="font-size: 14px; font-weight: 600; margin-bottom: 8px;">\${t.title}</div>
                    <div style="font-size: 11px; color: var(--text-secondary); margin-bottom: 12px;">
                        <div>Risk Score: <span style="color: var(--status-warning); font-weight: 600;">\${getRandomInt(40, 75)}</span></div>
                        <div style="margin-top: 4px;">Exposure: <span style="font-family: var(--font-mono);">$\${(getRandomInt(10, 100) * 1000).toLocaleString()}</span></div>
                    </div>
                    <div style="display: flex; gap: 6px;">
                        <button class="action-btn">HEDGE</button>
                        <button class="action-btn">CLOSE</button>
                        <button class="action-btn" style="border-color: var(--status-info); color: var(--status-info);">DETAILS</button>
                    </div>
                </div>
            </div>
        \`).join('');
    }

    /* ------------------------------------------------------------------
       EVENTS TABLE
       ------------------------------------------------------------------ */
    function initEventsTable() {
        const tbody = document.getElementById('eventsTableBody');
        const events = [
            { time: '14:32:45', type: 'market', theatre: 'ORB_SALVAGE_F7', agent: 'MEGALODON', action: 'Position opened', volume: 42000 },
            { time: '14:32:12', type: 'shield', theatre: 'ORB_SALVAGE_F7', agent: 'AEGIS', action: 'Hedge placed', volume: 28000 },
            { time: '14:31:58', type: 'sabotage', theatre: 'FED_RATE_DECISION', agent: 'SABOTEUR', action: 'Spread attack', volume: 15000 },
            { time: '14:31:34', type: 'market', theatre: 'VEN_OIL_TANKER', agent: 'DART', action: 'Quick flip', volume: 8500 },
            { time: '14:30:45', type: 'shield', theatre: 'TAIWAN_STRAIT', agent: 'BULL', action: 'Leverage up', volume: 52000 },
        ];
        
        tbody.innerHTML = events.map(e => \`
            <tr>
                <td class="mono">\${e.time}</td>
                <td><span class="ribbon-tag \${e.type}">\${e.type.toUpperCase()}</span></td>
                <td>\${e.theatre}</td>
                <td>\${e.agent}</td>
                <td>\${e.action}</td>
                <td class="numeric mono">\${e.volume.toLocaleString()}</td>
            </tr>
        \`).join('');
    }

    /* ------------------------------------------------------------------
       TAB SWITCHING
       ------------------------------------------------------------------ */
    document.querySelectorAll('.tab-btn, .tab-button').forEach(btn => {
        btn.addEventListener('click', function() {
            const tabId = this.dataset.tab;
            
            // Update buttons
            const container = this.closest('.tab-nav, .tab-nav');
            container.querySelectorAll('.tab-btn, .tab-button').forEach(b => b.classList.remove('active'));
            this.classList.add('active');
            
            // Update content
            document.querySelectorAll('.tab-content').forEach(c => {
                c.classList.remove('active');
                if (c.id === tabId) c.classList.add('active');
            });
        });
    });

    /* ------------------------------------------------------------------
       INITIALIZATION
       ------------------------------------------------------------------ */
    initRibbon();
    initOrderBook();
    initTimeSales();
    initLeaderboard();
    initIntercepts();
    initChart();
    initGrids();
    initEventsTable();

  <\/script>

<script>
(function(){
  function safeClick(sel){
    const el=document.querySelector(sel);
    if(el){ el.click(); return true; }
    return false;
  }
  function clickByText(tag, text){
    const els=[...document.querySelectorAll(tag)];
    const el=els.find(e=> (e.textContent||'').trim().toLowerCase().includes(text.toLowerCase()));
    if(el){ el.click(); return true; }
    return false;
  }
  window.addEventListener('message', function(ev){
    const msg = ev.data || {};
    if(!msg || msg.__echelon_shell__ !== true) return;
    const action = msg.action;
    if(!action) return;
    try{
      switch(action){
        case 'openAlert':
          safeClick('#alertBadgeBtn') || safeClick('.alert-badge-btn') || clickByText('button','alerts');
          break;
        case 'openCompare':
          safeClick('.btn-compare') || safeClick('[onclick*="toggleCompare"]') || safeClick('.compare-open') || safeClick('.compare-btn');
          break;
        case 'openSettings':
          clickByText('button','settings') || safeClick('[data-open="settings"]');
          break;
        case 'newPosition':
          clickByText('button','new position') || safeClick('.header-btn');
          break;
        case 'refresh':
          if(typeof window.refreshDashboard === 'function'){ window.refreshDashboard(); }
          clickByText('button','refresh');
          break;
        case 'marketView':
          clickByText('button','market view') || clickByText('a','market view');
          break;
        case 'roboticsView':
          clickByText('button','robotics view') || clickByText('a','robotics view');
          break;
        case 'agentRoster':
          clickByText('button','agent roster') || clickByText('a','agent roster');
          break;
        case 'globalIntel':
          clickByText('button','global intelligence') || clickByText('a','global intelligence');
          break;
        case 'deployAgent':
          clickByText('button','deploy agent') || clickByText('button','+ deploy');
          break;
        case 'breachConsole':
          clickByText('button','breach console') || clickByText('a','breach console');
          break;
        case 'exportConsole':
          clickByText('button','export console') || clickByText('a','export console');
          break;
        default:
          break;
      }
    }catch(e){ /* ignore */ }
  });
})();
<\/script>

</body>
</html>
`,
      portfolio: `<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Echelon — Portfolio</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=JetBrains+Mono:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/remixicon@4.2.0/fonts/remixicon.css" rel="stylesheet">
    <style>
        :root {
            --slate-950: #0B0C0E;
            --slate-900: #121417;
            --slate-850: #151719;
            --slate-800: #1A1D21;
            --slate-750: #26292E;
            --slate-700: #363A40;

            --bg-app: var(--slate-950);
            --bg-panel: var(--slate-850);
            --bg-card: var(--slate-900);
            --bg-card-hover: var(--slate-800);
            --border-outer: var(--slate-750);
            --border-inner: rgba(54, 58, 64, 0.5);
            
            --text-primary: #F1F5F9;
            --text-secondary: #94A3B8;
            --text-muted: #64748B;
            --font-sans: 'Inter', system-ui, sans-serif;
            --font-mono: 'JetBrains Mono', monospace;

            --status-success: #4ADE80;
            --status-success-bg: rgba(74, 222, 128, 0.1);
            --status-success-border: rgba(74, 222, 128, 0.2);
            
            --status-warning: #FACC15;
            --status-warning-bg: rgba(250, 204, 21, 0.1);
            
            --status-danger: #FB7185;
            --status-danger-bg: rgba(251, 113, 133, 0.1);
            
            --status-info: #3B82F6;
            --status-info-bg: rgba(59, 130, 246, 0.1);
            
            --status-paradox: #8B5CF6;
            --status-paradox-bg: rgba(139, 92, 246, 0.1);

            --echelon-cyan: #22D3EE;
            --echelon-cyan-bg: rgba(34, 211, 238, 0.1);
            --echelon-cyan-border: rgba(34, 211, 238, 0.3);
            
            --echelon-purple: #A855F7;
            --echelon-purple-bg: rgba(168, 85, 247, 0.1);
            --echelon-purple-border: rgba(168, 85, 247, 0.3);
            
            --echelon-amber: #F59E0B;
            --echelon-amber-bg: rgba(245, 158, 11, 0.1);
            --echelon-amber-border: rgba(245, 158, 11, 0.3);
            
            --echelon-red: #EF4444;
            --echelon-red-bg: rgba(239, 68, 68, 0.1);
            --echelon-red-border: rgba(239, 68, 68, 0.3);

            --space-xs: 4px;
            --space-sm: 8px;
            --space-md: 12px;
            --space-lg: 16px;
            --space-xl: 24px;
            --space-2xl: 32px;
            --radius-sm: 6px;
            --radius-md: 8px;
            --radius-lg: 12px;
        }

        * { margin: 0; padding: 0; box-sizing: border-box; }

        body {
            font-family: var(--font-sans);
            background: var(--bg-app);
            color: var(--text-primary);
            font-size: 13px;
            line-height: 1.5;
            -webkit-font-smoothing: antialiased;
        }

        .mono { font-family: var(--font-mono); }
        .flex { display: flex; }
        .flex-col { flex-direction: column; }
        .items-center { align-items: center; }
        .justify-between { justify-content: space-between; }
        .justify-center { justify-content: center; }
        .gap-1 { gap: 4px; }
        .gap-2 { gap: 8px; }
        .gap-3 { gap: 12px; }
        .gap-4 { gap:16px; }
        .gap-6 { gap: 24px; }
        
        /* Layout */
        .app-layout { display: flex; min-height: 100vh; }
        
        /* Main Content */
        .main-content {
            flex: 1;
            display: flex;
            flex-direction: column;
            overflow: hidden;
        }
        
        /* Header */
        .header {
            height: 64px;
            background: var(--bg-panel);
            border-bottom: 1px solid var(--border-outer);
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 0 var(--space-xl);
            flex-shrink: 0;
        }
        
        .page-title {
            font-size: 16px;
            font-weight: 600;
            color: var(--text-primary);
            letter-spacing: 0.02em;
        }
        
        .header-right { display: flex; align-items: center; gap: var(--space-lg); }
        
        .header-btn {
            display: flex;
            align-items: center;
            gap: var(--space-sm);
            padding: var(--space-sm) var(--space-md);
            background: var(--bg-card);
            border: 1px solid var(--border-outer);
            border-radius: var(--radius-sm);
            color: var(--text-secondary);
            font-size: 12px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s;
        }
        
        .header-btn:hover {
            border-color: var(--echelon-cyan);
            color: var(--echelon-cyan);
        }
        
        .connection-status {
            display: flex;
            align-items: center;
            gap: 6px;
            font-size: 11px;
            font-weight: 600;
            color: var(--status-success);
            background: rgba(74, 222, 128, 0.1);
            padding: 4px 10px;
            border-radius: 20px;
            border: 1px solid rgba(74, 222, 128, 0.2);
        }
        
        .live-dot {
            width: 6px;
            height: 6px;
            border-radius: 50%;
            background: var(--status-success);
            animation: pulse 2s infinite;
        }
        
        @keyframes pulse { 0% { opacity: 1; } 50% { opacity: 0.5; } 100% { opacity: 1; } }
        
        .clock {
            font-family: var(--font-mono);
            font-size: 12px;
            color: var(--text-secondary);
        }
        
        /* Content Area */
        .content-area {
            flex: 1;
            padding: var(--space-lg);
            display: flex;
            gap: var(--space-lg);
            overflow: hidden;
        }
        
        .main-panel {
            flex: 1;
            background: var(--bg-card);
            border: 1px solid var(--border-outer);
            border-radius: var(--radius-md);
            display: flex;
            flex-direction: column;
            overflow: hidden;
        }
        
        .main-panel-header {
            padding: var(--space-lg);
            border-bottom: 1px solid var(--border-outer);
        }
        
        .main-panel-title {
            font-size: 14px;
            font-weight: 600;
            color: var(--text-primary);
            margin-bottom: 4px;
        }
        
        .main-panel-subtitle {
            font-size: 12px;
            color: var(--text-muted);
        }
        
        /* Top Metrics */
        .metrics-row {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: var(--space-md);
            padding: var(--space-lg);
        }
        
        .metric-card {
            background: var(--bg-app);
            border: 1px solid var(--border-outer);
            border-radius: var(--radius-sm);
            padding: var(--space-md);
        }
        
        .metric-label {
            font-size: 10px;
            font-weight: 600;
            color: var(--text-muted);
            text-transform: uppercase;
            letter-spacing: 0.05em;
            margin-bottom: 4px;
        }
        
        .metric-value {
            font-family: var(--font-mono);
            font-size: 24px;
            font-weight: 700;
        }
        
        .metric-value.positive { color: var(--status-success); }
        .metric-value.negative { color: var(--status-danger); }
        .metric-value.neutral { color: var(--text-primary); }
        
        /* Main Scrollable Content */
        .main-scroll {
            flex: 1;
            overflow-y: auto;
            padding: 0 var(--space-lg) var(--space-lg);
        }
        
        /* KPI Tiles */
        .kpi-section {
            margin-top: var(--space-lg);
        }
        
        .kpi-title {
            font-size: 11px;
            font-weight: 600;
            color: var(--text-primary);
            text-transform: uppercase;
            letter-spacing: 0.05em;
            margin-bottom: var(--space-md);
        }
        
        .kpi-grid {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: var(--space-md);
        }
        
        .kpi-tile {
            background: var(--bg-app);
            border: 1px solid var(--border-outer);
            border-radius: var(--radius-md);
            padding: var(--space-md);
        }
        
        .kpi-label-row {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: var(--space-sm);
        }
        
        .kpi-label {
            font-size: 11px;
            color: var(--text-secondary);
        }
        
        .kpi-icon {
            font-size: 14px;
            color: var(--text-muted);
        }
        
        .kpi-value {
            font-family: var(--font-mono);
font-size: 28px;
            font-weight: 700;
            color: var(--text-primary);
            line-height: 1.2;
        }
        
        .kpi-max {
            font-size: 11px;
            color: var(--text-muted);
            font-family: var(--font-mono);
        }
        
        .risk-indicator { margin-top: var(--space-sm); }
        
        .risk-bar-container {
            height: 4px;
            background: var(--bg-card);
            border-radius: 2px;
            overflow: hidden;
            margin-bottom: 4px;
        }
        
        .risk-bar {
            height: 100%;
            border-radius: 2px;
            transition: width 0.3s;
        }
        
        .risk-bar.low { background: var(--status-success); }
        .risk-bar.medium { background: var(--status-warning); }
        .risk-bar.high { background: var(--status-danger); }
        
        .risk-status-row {
            display: flex;
            align-items: center;
            justify-content: space-between;
        }
        
        .risk-status {
            font-size: 9px;
            font-weight: 600;
            padding: 2px 6px;
            border-radius: 3px;
        }
        
        .risk-status.low {
            background: var(--status-success-bg);
            color: var(--status-success);
        }
        
        .risk-status.medium {
            background: var(--status-warning-bg);
            color: var(--status-warning);
        }
        
        .risk-status.high {
            background: var(--status-danger-bg);
            color: var(--status-danger);
        }
        
        /* Exposure Section */
        .exposure-section {
            margin-top: var(--space-lg);
            padding: var(--space-md);
            background: var(--bg-app);
            border: 1px solid var(--border-outer);
            border-radius: var(--radius-md);
        }
        
        .exposure-title {
            font-size: 11px;
            font-weight: 600;
            color: var(--text-primary);
            text-transform: uppercase;
            letter-spacing: 0.05em;
            margin-bottom: var(--space-md);
        }
        
        .exposure-row {
            margin-bottom: var(--space-md);
        }
        
        .exposure-row:last-child { margin-bottom: 0; }
        
        .exposure-label-row {
            display: flex;
            justify-content: space-between;
            margin-bottom: var(--space-xs);
        }
        
        .exposure-label {
            font-size: 11px;
            color: var(--text-secondary);
        }
        
        .exposure-value {
            font-family: var(--font-mono);
            font-size: 12px;
            font-weight: 600;
            color: var(--text-primary);
        }
        
        .exposure-value.text-green { color: var(--status-success); }
        .exposure-value.text-red { color: var(--status-danger); }
        
        .progress-bar {
            height: 6px;
            background: var(--bg-card);
            border-radius: 3px;
            overflow: hidden;
        }
        
        .progress-fill {
            height: 100%;
            border-radius: 3px;
        }
        
        .progress-fill.green { background: var(--status-success); }
        .progress-fill.red { background: var(--status-danger); }
        
        /* Allocation Section */
        .allocation-section {
            margin-top: var(--space-lg);
            padding: var(--space-md);
            background: var(--bg-app);
            border: 1px solid var(--border-outer);
            border-radius: var(--radius-md);
        }
        
        .allocation-title {
            font-size: 11px;
            font-weight: 600;
            color: var(--text-primary);
            text-transform: uppercase;
            letter-spacing: 0.05em;
            margin-bottom: var(--space-md);
        }
        
        .allocation-item {
            display: flex;
            align-items: center;
            gap: var(--space-md);
            margin-bottom: var(--space-sm);
        }
        
        .allocation-item:last-child { margin-bottom: 0; }
        
        .allocation-asset {
            font-family: var(--font-mono);
            font-size: 11px;
            color: var(--text-primary);
            width: 90px;
        }
        
        .allocation-bar {
            flex: 1;
            height: 8px;
            background: var(--bg-card);
            border-radius: 4px;
            overflow: hidden;
        }
        
        .allocation-fill {
            height: 100%;
            border-radius: 4px;
        }
        
        .allocation-fill.yes { background: var(--status-success); }
        .allocation-fill.no { background: var(--status-danger); }
        
        .allocation-percent {
            font-family: var(--font-mono);
            font-size: 11px;
            color: var(--text-muted);
            width: 45px;
            text-align: right;
        }
        
        /* Equity Chart */
        .equity-section {
            margin-top: var(--space-lg);
            padding: var(--space-md);
            background: var(--bg-app);
            border: 1px solid var(--border-outer);
            border-radius: var(--radius-md);
        }
        
        .equity-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: var(--space-md);
        }
        
        .equity-title {
            font-size: 11px;
            font-weight: 600;
            color: var(--text-primary);
            text-transform: uppercase;
            letter-spacing: 0.05em;
        }
        
        .chart-controls {
            display: flex;
            gap: 4px;
        }
        
        .chart-btn {
            padding: 4px 10px;
            background: transparent;
            border: 1px solid var(--border-outer);
            border-radius: var(--radius-sm);
            color: var(--text-muted);
            font-size: 10px;
            cursor: pointer;
            transition: all 0.2s;
        }
        
        .chart-btn:hover { color: var(--text-primary); }
        
        .chart-btn.active {
            background: var(--echelon-cyan-bg);
            border-color: var(--echelon-cyan);
            color: var(--echelon-cyan);
        }
        
        .equity-chart {
            position: relative;
            height: 120px;
            background: var(--bg-card);
            border-radius: var(--radius-sm);
            overflow: hidden;
        }
        
        .chart-svg {
            position: absolute;
            inset: 0;
            width: 100%;
            height: 100%;
        }
        
        .chart-grid {
            position: absolute;
            inset: 0;
        }
        
        .chart-grid-line {
            position: absolute;
            left: 0;
            right: 0;
            height: 1px;
            background: var(--border-outer);
        }
        
        .chart-labels {
            position: absolute;
            bottom: 8px;
            left: 16px;
            right: 16px;
            display: flex;
            justify-content: space-between;
            font-size: 10px;
            color: var(--text-muted);
        }
        
        .chart-summary {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: var(--space-md);
            margin-top: var(--space-md);
            padding-top: var(--space-md);
            border-top: 1px solid var(--border-outer);
        }
        
        .chart-stat { text-align: center; }
        
        .chart-stat-value {
            font-family: var(--font-mono);
            font-size: 16px;
            font-weight: 700;
            color: var(--text-primary);
        }
        
        .chart-stat-value.positive { color: var(--status-success); }
        .chart-stat-value.negative { color: var(--status-danger); }
        
        .chart-stat-label {
            font-size: 10px;
            color: var(--text-muted);
            margin-top: 2px;
        }
        
        /* Correlation Matrix */
        .correlation-section {
            margin-top: var(--space-lg);
            padding: var(--space-md);
            background: var(--bg-app);
            border: 1px solid var(--border-outer);
            border-radius: var(--radius-md);
        }
        
        .correlation-title {
            font-size: 11px;
            font-weight: 600;
            color: var(--text-primary);
            text-transform: uppercase;
            letter-spacing: 0.05em;
            margin-bottom: var(--space-md);
        }
        
        .correlation-matrix {
            width: 100%;
            border-collapse: collapse;
            font-size: 11px;
        }
        
        .correlation-matrix th,
        .correlation-matrix td {
            padding: var(--space-sm);
            text-align: center;
            border: 1px solid var(--border-outer);
        }
        
        .correlation-matrix th {
            background: var(--bg-card);
            font-weight: 600;
            color: var(--text-muted);
        }
        
        .correlation-matrix td:first-child {
            background: var(--bg-card);
            font-weight: 600;
            color: var(--text-muted);
        }
        
        .correlation-low { color: var(--status-success); }
        .correlation-medium { color: var(--status-warning); }
        .correlation-high { color: var(--status-danger); }
        
        /* Risks Table */
        .risks-section {
            margin-top: var(--space-lg);
        }
        
        .risks-title {
            font-size: 11px;
            font-weight: 600;
            color: var(--text-primary);
            text-transform: uppercase;
            letter-spacing: 0.05em;
            margin-bottom: var(--space-md);
        }
        
        .data-table {
            width: 100%;
            border-collapse: collapse;
            background: var(--bg-app);
            border: 1px solid var(--border-outer);
            border-radius: var(--radius-md);
            overflow: hidden;
        }
        
        .data-table th,
        .data-table td {
            padding: var(--space-sm) var(--space-md);
            text-align: left;
            border-bottom: 1px solid var(--border-outer);
        }
        
        .data-table th {
            background: var(--bg-card);
            font-size: 9px;
            font-weight: 600;
            color: var(--text-muted);
            text-transform: uppercase;
            letter-spacing: 0.05em;
        }
        
        .data-table tr:last-child td { border-bottom: none; }
        
        .timeline-id {
            font-family: var(--font-mono);
            font-size: 12px;
            font-weight: 600;
            color: var(--text-primary);
        }
        
        .risk-score {
            font-family: var(--font-mono);
            font-size: 12px;
            font-weight: 600;
        }
        
        .risk-drivers {
            font-size: 10px;
            color: var(--text-muted);
        }
        
        .burn-value {
            font-family: var(--font-mono);
            font-size: 11px;
            color: var(--status-danger);
        }
        
        .action-btns {
            display: flex;
            gap: 4px;
            justify-content: flex-end;
        }
        
        .action-btn {
            padding: 4px 8px;
            background: var(--bg-app);
            border: 1px solid var(--border-outer);
            border-radius: var(--radius-sm);
            color: var(--text-secondary);
            font-size: 10px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s;
        }
        
        .action-btn:hover {
            border-color: var(--echelon-cyan);
            color: var(--echelon-cyan);
        }
        
        /* Recommendations */
        .recommendations-section {
            padding: var(--space-lg) 0;
        }
        
        .rec-title {
            font-size: 11px;
            font-weight: 600;
            color: var(--text-primary);
            text-transform: uppercase;
            letter-spacing: 0.05em;
            margin-bottom: var(--space-md);
        }
        
        .rec-list {
            list-style: none;
        }
        
        .rec-item {
            display: flex;
            align-items: flex-start;
            gap: var(--space-sm);
            font-size: 12px;
            color: var(--text-primary);
            margin-bottom: var(--space-sm);
        }
        
        .rec-icon {
            color: var(--echelon-cyan);
            font-size: 14px;
            margin-top: 1px;
        }
        
        /* Positions Panel */
        .positions-panel {
            flex: 1;
            background: var(--bg-card);
            border: 1px solid var(--border-outer);
            border-radius: var(--radius-md);
            display: flex;
            flex-direction: column;
            margin-top: var(--space-lg);
            overflow: hidden;
        }
        
        .positions-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: var(--space-md) var(--space-lg);
            border-bottom: 1px solid var(--border-outer);
        }
        
        .positions-tabs {
            display: flex;
            gap: var(--space-md);
        }
        
        .positions-tab {
            padding: 4px 12px;
            background: transparent;
            border: none;
            color: var(--text-muted);
            font-size: 11px;
            font-weight: 500;
            cursor: pointer;
            border-radius: var(--radius-sm);
            transition: all 0.2s;
        }
        
        .positions-tab:hover { color: var(--text-secondary); }
        
        .positions-tab.active {
            background: var(--echelon-cyan-bg);
            color: var(--echelon-cyan);
        }
        
        .positions-table-container {
            flex: 1;
            overflow-y: auto;
        }
        
        .positions-table {
            width: 100%;
            border-collapse: collapse;
        }
        
        .positions-table th {
            text-align: left;
            padding: var(--space-sm) var(--space-md);
            font-size: 9px;
            font-weight: 600;
            color: var(--text-muted);
            text-transform: uppercase;
            letter-spacing: 0.05em;
            background: var(--bg-app);
            border-bottom: 1px solid var(--border-outer);
            position: sticky;
            top: 0;
        }
        
        .positions-table td {
            padding: var(--space-sm) var(--space-md);
            border-bottom: 1px solid var(--border-outer);
        }
        
        .direction-badge {
            display: inline-block;
            padding: 2px 6px;
            border-radius: 3px;
            font-size: 10px;
            font-weight: 600;
        }
        
        .direction-badge.yes {
            background: var(--status-success-bg);
            color: var(--status-success);
        }
        
        .direction-badge.no {
            background: var(--status-danger-bg);
            color: var(--status-danger);
        }
        
        .price {
            font-family: var(--font-mono);
            font-size: 12px;
            color: var(--text-primary);
        }
        
        .pl-value {
            font-family: var(--font-mono);
            font-size: 12px;
            font-weight: 600;
        }
        
        .pl-value.positive { color: var(--status-success); }
        .pl-value.negative { color: var(--status-danger); }
        
        /* Right Sidebar Widgets */
        .right-sidebar {
            width: 280px;
            flex-shrink: 0;
            display: flex;
            flex-direction: column;
            gap: var(--space-lg);
        }
        
        .widget {
            background: var(--bg-card);
            border: 1px solid var(--border-outer);
            border-radius: var(--radius-md);
        }
        
        .widget-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: var(--space-sm) var(--space-md);
            border-bottom: 1px solid var(--border-outer);
        }
        
        .widget-title {
            font-size: 11px;
            font-weight: 600;
            color: var(--text-primary);
            text-transform: uppercase;
            letter-spacing: 0.05em;
        }
        
        .widget-body {
            padding: var(--space-md);
        }
        
        /* Ghost Forks */
        .ghost-fork-item {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: var(--space-sm) 0;
            border-bottom: 1px solid var(--border-outer);
        }
        
        .ghost-fork-item:last-child {
            border-bottom: none;
        }
        
        .ghost-fork-id {
            font-family: var(--font-mono);
            font-size: 11px;
            color: var(--text-primary);
        }
        
        .ghost-fork-time {
            font-size: 10px;
            color: var(--text-muted);
        }
        
        /* My Agents */
        .agent-item {
            display: flex;
            align-items: center;
            gap: var(--space-sm);
            padding: var(--space-sm) 0;
        }
        
        .agent-avatar {
            width: 24px;
            height: 24px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 10px;
            font-weight: 700;
            color: white;
        }
        
        .agent-name {
            font-size: 12px;
            color: var(--text-primary);
            flex: 1;
        }
        
        .agent-archetype {
            font-size: 9px;
            color: var(--text-muted);
            padding: 2px 6px;
            background: var(--bg-app);
            border-radius: 3px;
        }
        
        .agent-pnl {
            font-family: var(--font-mono);
            font-size: 11px;
            font-weight: 600;
        }
        
        .agent-pnl.positive { color: var(--status-success); }
        .agent-pnl.negative { color: var(--status-danger); }
        
        /* Stats Row */
        .stats-row {
            display: flex;
            gap: var(--space-md);
        }
        
        .stat-item {
            flex: 1;
            text-align: center;
            padding: var(--space-md);
            background: var(--bg-card);
            border: 1px solid var(--border-outer);
            border-radius: var(--radius-md);
        }
        
        .stat-value {
            font-family: var(--font-mono);
            font-size: 20px;
            font-weight: 700;
            color: var(--text-primary);
        }
        
        .stat-label {
            font-size: 10px;
            color: var(--text-muted);
            margin-top: 2px;
        }
        
        /* Side Panels - Slide in from right */
        .backdrop {
            position: fixed;
            inset: 0;
            background: rgba(0,0,0,0.5);
            z-index: 1400;
            opacity: 0;
            visibility: hidden;
            transition: all 0.3s;
        }
        .backdrop.active { opacity: 1; visibility: visible; }
        
        .side-panel {
            position: fixed;
            top: 0;
            right: 0;
            bottom: 0;
            width: 420px;
            background: var(--bg-panel);
            border-left: 1px solid var(--border-outer);
            z-index: 1500;
            transform: translateX(100%);
            transition: transform 0.3s ease;
            display: flex;
            flex-direction: column;
        }
        .side-panel.active { transform: translateX(0); }
        
        .side-panel-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: var(--space-lg);
            border-bottom: 1px solid var(--border-outer);
            flex-shrink: 0;
        }
        
        .side-panel-title {
            font-size: 14px;
            font-weight: 600;
            color: var(--text-primary);
            display: flex;
            align-items: center;
            gap: var(--space-sm);
        }
        
        .side-panel-title i {
            font-size: 18px;
            color: var(--echelon-cyan);
        }
        
        .side-panel-close {
            width: 32px;
            height: 32px;
            display: flex;
            align-items: center;
            justify-content: center;
            background: var(--bg-app);
            border: 1px solid var(--border-outer);
            border-radius: var(--radius-sm);
            color: var(--text-muted);
            cursor: pointer;
            transition: all 0.2s;
        }
        
        .side-panel-close:hover {
            border-color: var(--status-danger);
            color: var(--status-danger);
        }
        
        .side-panel-body {
            flex: 1;
            overflow-y: auto;
            padding: var(--space-lg);
        }
        
        /* Agent Cards in Panel */
        .agent-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: var(--space-md);
        }
        
        .agent-card-mini {
            background: var(--bg-app);
            border: 1px solid var(--border-outer);
            border-radius: var(--radius-md);
            padding: var(--space-md);
        }
        
        .agent-card-header-mini {
            display: flex;
            align-items: center;
            gap: var(--space-sm);
            margin-bottom: var(--space-sm);
        }
        
        .agent-avatar-mini {
            width: 28px;
            height: 28px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 12px;
            font-weight: 700;
            color: white;
        }
        
        .agent-info-mini { flex: 1; }
        
        .agent-name-mini {
            font-size: 13px;
            font-weight: 600;
            color: var(--text-primary);
        }
        
        .agent-archetype-mini {
            font-size: 10px;
            color: var(--text-muted);
            text-transform: uppercase;
        }
        
        .agent-pnl-mini {
            font-family: var(--font-mono);
            font-size: 14px;
            font-weight: 600;
        }
        
        .agent-pnl-mini.positive { color: var(--status-success); }
        .agent-pnl-mini.negative { color: var(--status-danger); }
        
        .agent-chart-mini {
            height: 40px;
            margin-top: var(--space-sm);
            position: relative;
        }
        
        .agent-stats-mini {
            display: flex;
            justify-content: space-between;
            margin-top: var(--space-sm);
            font-size: 10px;
            color: var(--text-muted);
        }
        
        /* Fork List in Panel */
        .fork-list {
            display: flex;
            flex-direction: column;
            gap: var(--space-sm);
        }
        
        .fork-item-detail {
            background: var(--bg-app);
            border: 1px solid var(--border-outer);
            border-radius: var(--radius-md);
            padding: var(--space-md);
        }
        
        .fork-header-row {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: var(--space-sm);
        }
        
        .fork-id {
            font-family: var(--font-mono);
            font-size: 12px;
            font-weight: 600;
            color: var(--text-primary);
        }
        
        .fork-time {
            font-size: 10px;
            color: var(--text-muted);
        }
        
        .fork-details {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: var(--space-md);
            margin-top: var(--space-sm);
        }
        
        .fork-detail {
            text-align: center;
        }
        
        .fork-detail-value {
            font-family: var(--font-mono);
            font-size: 14px;
            font-weight: 600;
            color: var(--text-primary);
        }
        
        .fork-detail-label {
            font-size: 9px;
            color: var(--text-muted);
            text-transform: uppercase;
            letter-spacing: 0.05em;
        }
        
        /* Founders Yield in Panel */
        .founders-yield-section {
            margin-top: var(--space-lg);
            padding-top: var(--space-lg);
            border-top: 1px solid var(--border-outer);
        }
        
        .yield-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: var(--space-md);
        }
        
        .yield-title {
            font-size: 12px;
            font-weight: 600;
            color: var(--text-primary);
            text-transform: uppercase;
            letter-spacing: 0.05em;
            display: flex;
            align-items: center;
            gap: var(--space-sm);
        }
        
        .yield-title i {
            color: var(--echelon-cyan);
        }
        
        .yield-value {
            font-family: var(--font-mono);
            font-size: 20px;
            font-weight: 700;
            color: var(--status-success);
        }
        
        .yield-breakdown {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: var(--space-sm);
        }
        
        .yield-item {
            background: var(--bg-app);
            border: 1px solid var(--border-outer);
            border-radius: var(--radius-sm);
            padding: var(--space-sm);
            text-align: center;
        }
        
        .yield-item-value {
            font-family: var(--font-mono);
            font-size: 14px;
            font-weight: 600;
            color: var(--text-primary);
        }
        
        .yield-item-label {
            font-size: 9px;
            color: var(--text-muted);
            text-transform: uppercase;
            margin-top: 2px;
        }
        
        /* Mini Chart Paths */
        .mini-path {
            fill: none;
            stroke-width: 1.5;
            stroke-linecap: round;
        }
        .mini-path.positive { stroke: var(--status-success); }
        .mini-path.negative { stroke: var(--status-danger); }
    </style>
    <svg style="position: absolute; width: 0; height: 0; overflow: hidden;">
        <defs>
            <linearGradient id="equityGradient" x1="0%" y1="0%" x2="0%" y2="100%">
                <stop offset="0%" stop-color="var(--status-success)" stop-opacity="0.4"/>
                <stop offset="100%" stop-color="var(--status-success)" stop-opacity="0"/>
            </linearGradient>
        </defs>
    </svg>
<style id="__shell_hide__">
header.header{display:none!important;}
.connection-status,.system-clock,.clock,#clock,.live-indicator,.network-badge{display:none!important;}
html,body{height:100%;} body{overflow:auto;}

/* __table_fix__ */
.leaderboard-table{width:100%!important;border-collapse:collapse!important;table-layout:fixed!important;}
.leaderboard-table thead th{padding:10px 16px!important;text-align:left!important;font-size:10px!important;letter-spacing:.08em!important;text-transform:uppercase!important;color:var(--text-muted)!important;font-weight:700!important;border-bottom:1px solid var(--border-outer)!important;background:var(--bg-card)!important;position:sticky!important;top:0!important;z-index:2!important;}
.leaderboard-table tbody td{padding:10px 16px!important;border-bottom:1px solid var(--border-inner)!important;vertical-align:middle!important;font-size:11px!important;color:var(--text-secondary)!important;}
.leaderboard-table th.numeric,.leaderboard-table td.numeric{text-align:right!important;}
.leaderboard-table th:first-child,.leaderboard-table td:first-child{width:30px!important;padding-left:16px!important;}

</style>
</head>
<body>
    <div class="app-layout">
        <!-- Main Content -->
        <main class="main-content">
            <!-- Header -->
            <header class="header">
                <div class="page-title">Portfolio</div>
                <div class="header-right">
                    <button class="header-btn">
                        <i class="ri-add-line"></i>
                        New Position
                    </button>
                    <div class="connection-status">
                        <span class="live-dot"></span>
                        Connected
                    </div>
                    <span class="clock" id="clock">--:--:-- UTC</span>
                </div>
            </header>

            <!-- Content -->
            <div class="content-area">
                <!-- Main Panel -->
                <div class="main-panel">
                    <!-- Header -->
                    <div class="main-panel-header">
                        <div class="main-panel-title">Portfolio Overview</div>
                        <div class="main-panel-subtitle">Portfolio risk metrics, positions, and performance data</div>
                    </div>

                    <!-- Top Metrics -->
                    <div class="metrics-row">
                        <div class="metric-card">
                            <div class="metric-label">Total P/L</div>
                            <div class="metric-value positive">+$124,580</div>
                        </div>
                        <div class="metric-card">
                            <div class="metric-label">Win Rate</div>
                            <div class="metric-value neutral">68%</div>
                        </div>
                        <div class="metric-card">
                            <div class="metric-label">Positions</div>
                            <div class="metric-value neutral">6</div>
                        </div>
                    </div>

                    <!-- Scrollable Content -->
                    <div class="main-scroll">
                        <!-- KPI Tiles -->
                        <div class="kpi-section">
                            <div class="kpi-title">Risk Metrics</div>
                            <div class="kpi-grid">
                                <div class="kpi-tile">
                                    <div class="kpi-label-row">
                                        <span class="kpi-label">Volatility</span>
                                        <i class="ri-dashboard-3-line kpi-icon text-green"></i>
                                    </div>
                                    <div class="kpi-value" style="color: #4ADE80;">18.4</div>
                                    <div class="kpi-max">/ 100</div>
                                    <div class="risk-indicator">
                                        <div class="risk-bar-container">
                                            <div class="risk-bar low" style="width: 18.4%;"></div>
                                        </div>
                                        <div class="risk-status-row">
                                            <span class="risk-status low">LOW</span>
                                            <span class="text-muted" style="font-size: 9px;">18.4%</span>
                                        </div>
                                    </div>
                                </div>
                                <div class="kpi-tile">
                                    <div class="kpi-label-row">
                                        <span class="kpi-label">VaR (95%)</span>
                                        <i class="ri-bar-chart-box-line kpi-icon text-amber"></i>
                                    </div>
                                    <div class="kpi-value" style="color: #FF9500;">32.4</div>
                                    <div class="kpi-max">/ 100</div>
                                    <div class="risk-indicator">
                                        <div class="risk-bar-container">
                                            <div class="risk-bar medium" style="width: 32.4%;"></div>
                                        </div>
                                        <div class="risk-status-row">
                                            <span class="risk-status medium">MEDIUM</span>
                                            <span class="text-muted" style="font-size: 9px;">32.4%</span>
                                        </div>
                                    </div>
                                </div>
                                <div class="kpi-tile">
                                    <div class="kpi-label-row">
                                        <span class="kpi-label">Fragility Index</span>
                                        <i class="ri-trending-up-line kpi-icon text-amber"></i>
                                    </div>
                                    <div class="kpi-value" style="color: #FF9500;">45.2</div>
                                    <div class="kpi-max">/ 100</div>
                                    <div class="risk-indicator">
                                        <div class="risk-bar-container">
                                            <div class="risk-bar medium" style="width: 45.2%;"></div>
                                        </div>
                                        <div class="risk-status-row">
                                            <span class="risk-status medium">MEDIUM</span>
                                            <span class="text-muted" style="font-size: 9px;">45.2%</span>
                                        </div>
                                    </div>
                                </div>
                                <div class="kpi-tile">
                                    <div class="kpi-label-row">
                                        <span class="kpi-label">Belief Divergence</span>
                                        <i class="ri-error-warning-line kpi-icon text-green"></i>
                                    </div>
                                    <div class="kpi-value" style="color: #00FF41;">28.1</div>
                                    <div class="kpi-max">/ 100</div>
                                    <div class="risk-indicator">
                                        <div class="risk-bar-container">
                                            <div class="risk-bar low" style="width: 28.1%;"></div>
                                        </div>
                                        <div class="risk-status-row">
                                            <span class="risk-status low">LOW</span>
                                            <span class="text-muted" style="font-size: 9px;">28.1%</span>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Exposure Summary -->
                        <div class="exposure-section">
                            <div class="exposure-title">Exposure Summary</div>
                            <div class="exposure-row">
                                <div class="exposure-label-row">
                                    <span class="exposure-label">Total Notional</span>
                                    <span class="exposure-value">$124,850.00</span>
                                </div>
                            </div>
                            <div class="exposure-row">
                                <div class="exposure-label-row">
                                    <span class="exposure-label">Net YES Notional</span>
                                    <span class="exposure-value text-green">$67,420.00</span>
                                </div>
                                <div class="progress-bar">
                                    <div class="progress-fill green" style="width: 54%;"></div>
                                </div>
                            </div>
                            <div class="exposure-row">
                                <div class="exposure-label-row">
                                    <span class="exposure-label">Net NO Notional</span>
                                    <span class="exposure-value text-red">$57,430.00</span>
                                </div>
                                <div class="progress-bar">
                                    <div class="progress-fill red" style="width: 46%;"></div>
                                </div>
                            </div>
                        </div>

                        <!-- Portfolio Allocation -->
                        <div class="allocation-section">
                            <div class="allocation-title">Portfolio Allocation</div>
                            <div class="allocation-item">
                                <span class="allocation-asset">TL-2847 (YES)</span>
                                <div class="allocation-bar">
                                    <div class="allocation-fill yes" style="width: 19.8%;"></div>
                                </div>
                                <span class="allocation-percent">19.8%</span>
                            </div>
                            <div class="allocation-item">
                                <span class="allocation-asset">TL-2846 (NO)</span>
                                <div class="allocation-bar">
                                    <div class="allocation-fill no" style="width: 14.8%;"></div>
                                </div>
                                <span class="allocation-percent">14.8%</span>
                            </div>
                            <div class="allocation-item">
                                <span class="allocation-asset">TL-2845 (YES)</span>
                                <div class="allocation-bar">
                                    <div class="allocation-fill yes" style="width: 12.4%;"></div>
                                </div>
                                <span class="allocation-percent">12.4%</span>
                            </div>
                            <div class="allocation-item">
                                <span class="allocation-asset">TL-2844 (NO)</span>
                                <div class="allocation-bar">
                                    <div class="allocation-fill no" style="width: 11.2%;"></div>
                                </div>
                                <span class="allocation-percent">11.2%</span>
                            </div>
                            <div class="allocation-item">
                                <span class="allocation-asset">TL-2843 (YES)</span>
                                <div class="allocation-bar">
                                    <div class="allocation-fill yes" style="width: 10.5%;"></div>
                                </div>
                                <span class="allocation-percent">10.5%</span>
                            </div>
                            <div class="allocation-item">
                                <span class="allocation-asset">TL-2842 (NO)</span>
                                <div class="allocation-bar">
                                    <div class="allocation-fill no" style="width: 9.8%;"></div>
                                </div>
                                <span class="allocation-percent">9.8%</span>
                            </div>
                        </div>

                        <!-- Equity Curve -->
                        <div class="equity-section">
                            <div class="equity-header">
                                <div class="equity-title">Equity Curve (30D)</div>
                                <div class="chart-controls">
                                    <button class="chart-btn">1D</button>
                                    <button class="chart-btn">7D</button>
                                    <button class="chart-btn active">30D</button>
                                    <button class="chart-btn">ALL</button>
                                </div>
                            </div>
                            <div class="equity-chart">
                                <svg class="chart-svg" viewBox="0 0 100 100" preserveAspectRatio="none">
                                    <path class="equity-area" d="M0,80 L10,75 L20,78 L30,65 L40,70 L50,55 L60,60 L70,45 L80,50 L90,35 L100,25 L100,100 L0,100 Z" fill="url(#equityGradient)"/>
                                    <path class="equity-path" d="M0,80 L10,75 L20,78 L30,65 L40,70 L50,55 L60,60 L70,45 L80,50 L90,35 L100,25" fill="none" stroke="#4ADE80" stroke-width="1" stroke-linecap="round"/>
                                </svg>
                                <div class="chart-grid">
                                    <div class="chart-grid-line" style="top: 0%;"></div>
                                    <div class="chart-grid-line" style="top: 25%;"></div>
                                    <div class="chart-grid-line" style="top: 50%;"></div>
                                    <div class="chart-grid-line" style="top: 75%;"></div>
                                </div>
                                <div class="chart-labels">
                                    <span>Dec 28</span>
                                    <span>Jan 7</span>
                                    <span>Jan 17</span>
                                    <span>Jan 27</span>
                                </div>
                            </div>
                            <div class="chart-summary">
                                <div class="chart-stat">
                                    <div class="chart-stat-value positive">+$12,450</div>
                                    <div class="chart-stat-label">Total P/L</div>
                                </div>
                                <div class="chart-stat">
                                    <div class="chart-stat-value">+8.4%</div>
                                    <div class="chart-stat-label">Return</div>
                                </div>
                                <div class="chart-stat">
                                    <div class="chart-stat-value">2.1x</div>
                                    <div class="chart-stat-label">Sharpe Ratio</div>
                                </div>
                                <div class="chart-stat">
                                    <div class="chart-stat-value negative">-$2,850</div>
                                    <div class="chart-stat-label">Max Drawdown</div>
                                </div>
                            </div>
                        </div>

                        <!-- Correlation Matrix -->
                        <div class="correlation-section">
                            <div class="correlation-title">Position Correlations</div>
                            <table class="correlation-matrix">
                                <thead>
                                    <tr>
                                        <th></th>
                                        <th>TL-2847</th>
                                        <th>TL-2846</th>
                                        <th>TL-2845</th>
                                        <th>TL-2844</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr>
                                        <td>TL-2847</td>
                                        <td class="correlation-low">1.00</td>
                                        <td class="correlation-high">0.84</td>
                                        <td class="correlation-medium">0.52</td>
                                        <td class="correlation-low">0.31</td>
                                    </tr>
                                    <tr>
                                        <td>TL-2846</td>
                                        <td class="correlation-high">0.84</td>
                                        <td class="correlation-low">1.00</td>
                                        <td class="correlation-medium">0.47</td>
                                        <td class="correlation-low">0.28</td>
                                    </tr>
                                    <tr>
                                        <td>TL-2845</td>
                                        <td class="correlation-medium">0.52</td>
                                        <td class="correlation-medium">0.47</td>
                                        <td class="correlation-low">1.00</td>
                                        <td class="correlation-low">0.19</td>
                                    </tr>
                                    <tr>
                                        <td>TL-2844</td>
                                        <td class="correlation-low">0.31</td>
                                        <td class="correlation-low">0.28</td>
                                        <td class="correlation-low">0.19</td>
                                        <td class="correlation-low">1.00</td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>

                        <!-- Top Risks Table -->
                        <div class="risks-section">
                            <div class="risks-title">Top Risks</div>
                            <table class="data-table">
                                <thead>
                                    <tr>
                                        <th>Timeline</th>
                                        <th>Risk Score</th>
                                        <th>Drivers</th>
                                        <th>Burn at Collapse</th>
                                        <th style="text-align: right;">Actions</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr>
                                        <td><span class="timeline-id">TL-2847</span></td>
                                        <td><span class="risk-score" style="color: #FF9500;">58.4</span></td>
                                        <td><span class="risk-drivers">Entropy, Logic Gap</span></td>
                                        <td><span class="burn-value">$24,850</span></td>
<td>
                                            <div class="action-btns">
                                                <button class="action-btn">OPEN</button>
                                                <button class="action-btn">REPLAY</button>
                                            </div>
                                        </td>
                                    </tr>
                                    <tr>
                                        <td><span class="timeline-id">TL-2846</span></td>
                                        <td><span class="risk-score" style="color: #FF3B3B;">72.1</span></td>
                                        <td><span class="risk-drivers">Sabotage, Instability</span></td>
                                        <td><span class="burn-value">$18,420</span></td>
                                        <td>
                                            <div class="action-btns">
                                                <button class="action-btn">OPEN</button>
                                                <button class="action-btn">REPLAY</button>
                                            </div>
                                        </td>
                                    </tr>
                                    <tr>
                                        <td><span class="timeline-id">TL-2845</span></td>
                                        <td><span class="risk-score" style="color: #FF9500;">51.8</span></td>
                                        <td><span class="risk-drivers">Paradox Proximity</span></td>
                                        <td><span class="burn-value">$12,180</span></td>
                                        <td>
                                            <div class="action-btns">
                                                <button class="action-btn">OPEN</button>
                                                <button class="action-btn">REPLAY</button>
                                            </div>
                                        </td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>

                        <!-- Recommendations -->
                        <div class="recommendations-section">
                            <div class="rec-title">Recommendations</div>
                            <ul class="rec-list">
                                <li class="rec-item">
                                    <i class="ri-arrow-right-line rec-icon"></i>
                                    Consider reducing exposure to TL-2846 as sabotage heat increases
                                </li>
                                <li class="rec-item">
                                    <i class="ri-arrow-right-line rec-icon"></i>
                                    Diversify YES positions across more independent timelines
                                </li>
                            </ul>
                        </div>

                        <!-- Positions Panel -->
                        <div class="positions-panel">
                            <div class="positions-header">
                                <div class="positions-tabs">
                                    <button class="positions-tab active">Positions</button>
                                    <button class="positions-tab">Foldovers</button>
                                </div>
                                <button class="header-btn">
                                    <i class="ri-filter-3-line"></i>
                                    Filter
                                </button>
                            </div>
                            <div class="positions-table-container">
                                <table class="positions-table">
                                    <thead>
                                        <tr>
                                            <th>Timeline</th>
                                            <th>Direction</th>
                                            <th>Entry Price</th>
                                            <th>Current Price</th>
                                            <th>P/L</th>
                                            <th style="text-align: right;">Actions</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <tr>
                                            <td><span class="timeline-id">TL-2847</span></td>
                                            <td><span class="direction-badge yes">YES</span></td>
                                            <td><span class="price">$0.42</span></td>
                                            <td><span class="price">$0.58</span></td>
                                            <td><span class="pl-value positive">+$8,420</span></td>
                                            <td>
                                                <div class="action-btns">
                                                    <button class="action-btn">OPEN</button>
                                                    <button class="action-btn">REPLAY</button>
                                                </div>
                                            </td>
                                        </tr>
                                        <tr>
                                            <td><span class="timeline-id">TL-2846</span></td>
                                            <td><span class="direction-badge no">NO</span></td>
                                            <td><span class="price">$0.61</span></td>
                                            <td><span class="price">$0.55</span></td>
                                            <td><span class="pl-value positive">+$4,280</span></td>
                                            <td>
                                                <div class="action-btns">
                                                    <button class="action-btn">OPEN</button>
                                                    <button class="action-btn">REPLAY</button>
                                                </div>
                                            </td>
                                        </tr>
                                        <tr>
                                            <td><span class="timeline-id">TL-2845</span></td>
                                            <td><span class="direction-badge yes">YES</span></td>
                                            <td><span class="price">$0.33</span></td>
                                            <td><span class="price">$0.38</span></td>
                                            <td><span class="pl-value positive">+$2,850</span></td>
                                            <td>
                                                <div class="action-btns">
                                                    <button class="action-btn">OPEN</button>
                                                    <button class="action-btn">REPLAY</button>
                                                </div>
                                            </td>
                                        </tr>
                                        <tr>
                                            <td><span class="timeline-id">TL-2844</span></td>
                                            <td><span class="direction-badge no">NO</span></td>
                                            <td><span class="price">$0.72</span></td>
                                            <td><span class="price">$0.68</span></td>
                                            <td><span class="pl-value negative">-$1,420</span></td>
                                            <td>
                                                <div class="action-btns">
                                                    <button class="action-btn">OPEN</button>
                                                    <button class="action-btn">REPLAY</button>
                                                </div>
                                            </td>
                                        </tr>
                                        <tr>
                                            <td><span class="timeline-id">TL-2843</span></td>
                                            <td><span class="direction-badge yes">YES</span></td>
                                            <td><span class="price">$0.25</span></td>
                                            <td><span class="price">$0.31</span></td>
                                            <td><span class="pl-value positive">+$4,180</span></td>
                                            <td>
                                                <div class="action-btns">
                                                    <button class="action-btn">OPEN</button>
                                                    <button class="action-btn">REPLAY</button>
                                                </div>
                                            </td>
                                        </tr>
                                        <tr>
                                            <td><span class="timeline-id">TL-2842</span></td>
                                            <td><span class="direction-badge no">NO</span></td>
                                            <td><span class="price">$0.45</span></td>
                                            <td><span class="price">$0.52</span></td>
                                            <td><span class="pl-value negative">-$2,640</span></td>
                                            <td>
                                                <div class="action-btns">
                                                    <button class="action-btn">OPEN</button>
                                                    <button class="action-btn">REPLAY</button>
                                                </div>
                                            </td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Right Sidebar -->
                <aside class="right-sidebar">
                    <!-- Ghost Forks Widget -->
                    <div class="widget">
                        <div class="widget-header">
                            <span class="widget-title">Ghost Forks</span>
                            <button class="action-btn" onclick="openForksPanel()">VIEW ALL</button>
                        </div>
                        <div class="widget-body">
                            <div class="ghost-fork-item">
                                <span class="ghost-fork-id">TL-2847-fork-7</span>
                                <span class="ghost-fork-time">2m ago</span>
                            </div>
                            <div class="ghost-fork-item">
                                <span class="ghost-fork-id">TL-2846-fork-3</span>
                                <span class="ghost-fork-time">8m ago</span>
                            </div>
                            <div class="ghost-fork-item">
                                <span class="ghost-fork-id">TL-2845-fork-12</span>
                                <span class="ghost-fork-time">15m ago</span>
                            </div>
                        </div>
                    </div>

                    <!-- My Agents Widget -->
                    <div class="widget">
                        <div class="widget-header">
                            <span class="widget-title">My Agents</span>
                            <button class="action-btn" onclick="openAgentsPanel()">MANAGE</button>
                        </div>
                        <div class="widget-body">
                            <div class="agent-item">
                                <div class="agent-avatar" style="background: #3B82F6;">A</div>
                                <span class="agent-name">AGENT-A</span>
                                <span class="agent-archetype">WHALE</span>
                                <span class="agent-pnl positive">+$8.2K</span>
                            </div>
                            <div class="agent-item">
                                <div class="agent-avatar" style="background: #8B5CF6;">B</div>
                                <span class="agent-name">AGENT-B</span>
                                <span class="agent-archetype">SABOTEUR</span>
                                <span class="agent-pnl negative">-$2.4K</span>
                            </div>
                            <div class="agent-item">
                                <div class="agent-avatar" style="background: #F59E0B;">C</div>
                                <span class="agent-name">AGENT-C</span>
                                <span class="agent-archetype">DIPLOMAT</span>
                                <span class="agent-pnl positive">+$4.1K</span>
                            </div>
                            <div class="agent-item">
                                <div class="agent-avatar" style="background: #10B981;">D</div>
                                <span class="agent-name">AGENT-D</span>
                                <span class="agent-archetype">SNIPER</span>
                                <span class="agent-pnl positive">+$6.8K</span>
                            </div>
                        </div>
                    </div>

                    <!-- Stats Row -->
                    <div class="stats-row">
                        <div class="stat-item">
                            <div class="stat-value">8</div>
                            <div class="stat-label">Live Agents</div>
                        </div>
                        <div class="stat-item">
                            <div class="stat-value">24</div>
                            <div class="stat-label">Active Ops</div>
                        </div>
                    </div>
                </aside>
            </div>
        </main>
    </div>

    <!-- Backdrop -->
    <div class="backdrop" id="backdrop" onclick="closeAllPanels()"></div>

    <!-- AGENTS PANEL (Slides from right) -->
    <div class="side-panel" id="agentsPanel">
        <div class="side-panel-header">
            <div class="side-panel-title"><i class="ri-robot-line"></i> Manage Agents</div>
            <button class="side-panel-close" onclick="closeAgentsPanel()"><i class="ri-close-line"></i></button>
        </div>
        <div class="side-panel-body">
            <div class="agent-grid">
                <div class="agent-card-mini">
                    <div class="agent-card-header-mini">
                        <div class="agent-avatar-mini" style="background: #3B82F6;">A</div>
                        <div class="agent-info-mini"><div class="agent-name-mini">AGENT-A</div><div class="agent-archetype-mini">WHALE</div></div>
                        <span class="agent-pnl-mini positive">+$8.2K</span>
                    </div>
                    <div class="agent-chart-mini"><svg viewBox="0 0 100 40"><path class="mini-path positive" d="M0,30 L10,28 L20,25 L30,22 L40,20 L50,18 L60,15 L70,12 L80,10 L90,8 L100,5"/></svg></div>
                    <div class="agent-stats-mini"><span>Actions: 2,847</span><span>Win: 78%</span><span>Sanity: 85</span></div>
                </div>
                <div class="agent-card-mini">
                    <div class="agent-card-header-mini">
                        <div class="agent-avatar-mini" style="background: #8B5CF6;">B</div>
                        <div class="agent-info-mini"><div class="agent-name-mini">AGENT-B</div><div class="agent-archetype-mini">SABOTEUR</div></div>
                        <span class="agent-pnl-mini negative">-$2.4K</span>
                    </div>
                    <div class="agent-chart-mini"><svg viewBox="0 0 100 40"><path class="mini-path negative" d="M0,15 L10,18 L20,22 L30,20 L40,25 L50,22 L60,28 L70,25 L80,30 L90,28 L100,32"/></svg></div>
                    <div class="agent-stats-mini"><span>Actions: 1,456</span><span>Win: 68%</span><span>Sanity: 52</span></div>
                </div>
                <div class="agent-card-mini">
                    <div class="agent-card-header-mini">
                        <div class="agent-avatar-mini" style="background: #F59E0B;">C</div>
                        <div class="agent-info-mini"><div class="agent-name-mini">AGENT-C</div><div class="agent-archetype-mini">DIPLOMAT</div></div>
                        <span class="agent-pnl-mini positive">+$4.1K</span>
                    </div>
                    <div class="agent-chart-mini"><svg viewBox="0 0 100 40"><path class="mini-path positive" d="M0,28 L15,25 L30,26 L45,22 L60,20 L75,18 L90,15 L100,12"/></svg></div>
                    <div class="agent-stats-mini"><span>Actions: 1,234</span><span>Win: 71%</span><span>Sanity: 92</span></div>
                </div>
                <div class="agent-card-mini">
                    <div class="agent-card-header-mini">
                        <div class="agent-avatar-mini" style="background: #10B981;">D</div>
                        <div class="agent-info-mini"><div class="agent-name-mini">AGENT-D</div><div class="agent-archetype-mini">SNIPER</div></div>
                        <span class="agent-pnl-mini positive">+$6.8K</span>
                    </div>
                    <div class="agent-chart-mini"><svg viewBox="0 0 100 40"><path class="mini-path positive" d="M0,32 L10,30 L20,28 L30,25 L40,28 L50,22 L60,20 L70,18 L80,15 L90,12 L100,10"/></svg></div>
                    <div class="agent-stats-mini"><span>Actions: 892</span><span>Win: 82%</span><span>Sanity: 78</span></div>
                </div>
                <div class="agent-card-mini">
                    <div class="agent-card-header-mini">
                        <div class="agent-avatar-mini" style="background: #EC4899;">E</div>
                        <div class="agent-info-mini"><div class="agent-name-mini">AGENT-E</div><div class="agent-archetype-mini">HUNTER</div></div>
                        <span class="agent-pnl-mini positive">+$3.5K</span>
                    </div>
                    <div class="agent-chart-mini"><svg viewBox="0 0 100 40"><path class="mini-path positive" d="M0,30 L12,28 L24,30 L36,25 L48,22 L60,20 L72,18 L84,15 L100,12"/></svg></div>
                    <div class="agent-stats-mini"><span>Actions: 678</span><span>Win: 75%</span><span>Sanity: 88</span></div>
                </div>
                <div class="agent-card-mini">
                    <div class="agent-card-header-mini">
                        <div class="agent-avatar-mini" style="background: #6366F1;">F</div>
                        <div class="agent-info-mini"><div class="agent-name-mini">AGENT-F</div><div class="agent-archetype-mini">BUILDER</div></div>
                        <span class="agent-pnl-mini positive">+$5.2K</span>
                    </div>
                    <div class="agent-chart-mini"><svg viewBox="0 0 100 40"><path class="mini-path positive" d="M0,35 L15,32 L30,30 L45,28 L60,25 L75,22 L90,18 L100,15"/></svg></div>
                    <div class="agent-stats-mini"><span>Actions: 1,567</span><span>Win: 79%</span><span>Sanity: 72</span></div>
                </div>
            </div>
        </div>
    </div>

    <!-- FORKS PANEL (Slides from right) -->
    <div class="side-panel" id="forksPanel">
        <div class="side-panel-header">
            <div class="side-panel-title"><i class="ri-git-branch-line"></i> Ghost Forks</div>
            <button class="side-panel-close" onclick="closeForksPanel()"><i class="ri-close-line"></i></button>
        </div>
        <div class="side-panel-body">
            <div class="fork-list">
                <div class="fork-item-detail">
                    <div class="fork-header-row">
                        <span class="fork-id">TL-2847-fork-7</span>
                        <span class="fork-time">2m ago</span>
                    </div>
                    <div class="fork-details">
                        <div class="fork-detail">
                            <div class="fork-detail-value">$8,420</div>
                            <div class="fork-detail-label">Notional</div>
                        </div>
                        <div class="fork-detail">
                            <div class="fork-detail-value">YES</div>
                            <div class="fork-detail-label">Direction</div>
                        </div>
                        <div class="fork-detail">
                            <div class="fork-detail-value">0.58</div>
                            <div class="fork-detail-label">Price</div>
                        </div>
                    </div>
                </div>
                <div class="fork-item-detail">
                    <div class="fork-header-row">
                        <span class="fork-id">TL-2846-fork-3</span>
                        <span class="fork-time">8m ago</span>
                    </div>
                    <div class="fork-details">
                        <div class="fork-detail">
                            <div class="fork-detail-value">$4,280</div>
                            <div class="fork-detail-label">Notional</div>
                        </div>
                        <div class="fork-detail">
                            <div class="fork-detail-value">NO</div>
                            <div class="fork-detail-label">Direction</div>
                        </div>
                        <div class="fork-detail">
                            <div class="fork-detail-value">0.55</div>
                            <div class="fork-detail-label">Price</div>
                        </div>
                    </div>
                </div>
                <div class="fork-item-detail">
                    <div class="fork-header-row">
                        <span class="fork-id">TL-2845-fork-12</span>
                        <span class="fork-time">15m ago</span>
                    </div>
                    <div class="fork-details">
                        <div class="fork-detail">
                            <div class="fork-detail-value">$2,850</div>
                            <div class="fork-detail-label">Notional</div>
                        </div>
                        <div class="fork-detail">
                            <div class="fork-detail-value">YES</div>
                            <div class="fork-detail-label">Direction</div>
                        </div>
                        <div class="fork-detail">
                            <div class="fork-detail-value">0.38</div>
                            <div class="fork-detail-label">Price</div>
                        </div>
                    </div>
                </div>
                <div class="fork-item-detail">
                    <div class="fork-header-row">
                        <span class="fork-id">TL-2844-fork-8</span>
                        <span class="fork-time">22m ago</span>
                    </div>
                    <div class="fork-details">
                        <div class="fork-detail">
                            <div class="fork-detail-value">$6,120</div>
                            <div class="fork-detail-label">Notional</div>
                        </div>
                        <div class="fork-detail">
                            <div class="fork-detail-value">NO</div>
                            <div class="fork-detail-label">Direction</div>
                        </div>
                        <div class="fork-detail">
                            <div class="fork-detail-value">0.68</div>
                            <div class="fork-detail-label">Price</div>
                        </div>
                    </div>
                </div>
                <div class="fork-item-detail">
                    <div class="fork-header-row">
                        <span class="fork-id">TL-2843-fork-5</span>
                        <span class="fork-time">28m ago</span>
                    </div>
                    <div class="fork-details">
                        <div class="fork-detail">
                            <div class="fork-detail-value">$3,940</div>
                            <div class="fork-detail-label">Notional</div>
                        </div>
                        <div class="fork-detail">
                            <div class="fork-detail-value">YES</div>
                            <div class="fork-detail-label">Direction</div>
                        </div>
                        <div class="fork-detail">
                            <div class="fork-detail-value">0.31</div>
                            <div class="fork-detail-label">Price</div>
                        </div>
                    </div>
                </div>
                <div class="fork-item-detail">
                    <div class="fork-header-row">
                        <span class="fork-id">TL-2842-fork-9</span>
                        <span class="fork-time">35m ago</span>
                    </div>
                    <div class="fork-details">
                        <div class="fork-detail">
                            <div class="fork-detail-value">$5,180</div>
                            <div class="fork-detail-label">Notional</div>
                        </div>
                        <div class="fork-detail">
                            <div class="fork-detail-value">NO</div>
                            <div class="fork-detail-label">Direction</div>
                        </div>
                        <div class="fork-detail">
                            <div class="fork-detail-value">0.52</div>
                            <div class="fork-detail-label">Price</div>
                        </div>
                    </div>
                </div>
                <div class="fork-item-detail">
                    <div class="fork-header-row">
                        <span class="fork-id">TL-2847-fork-6</span>
                        <span class="fork-time">42m ago</span>
                    </div>
                    <div class="fork-details">
                        <div class="fork-detail">
                            <div class="fork-detail-value">$7,850</div>
                            <div class="fork-detail-label">Notional</div>
                        </div>
                        <div class="fork-detail">
                            <div class="fork-detail-value">YES</div>
                            <div class="fork-detail-label">Direction</div>
                        </div>
                        <div class="fork-detail">
                            <div class="fork-detail-value">0.55</div>
                            <div class="fork-detail-label">Price</div>
                        </div>
                    </div>
                </div>
                <div class="fork-item-detail">
                    <div class="fork-header-row">
                        <span class="fork-id">TL-2846-fork-2</span>
                        <span class="fork-time">48m ago</span>
                    </div>
                    <div class="fork-details">
                        <div class="fork-detail">
                            <div class="fork-detail-value">$3,640</div>
                            <div class="fork-detail-label">Notional</div>
                        </div>
                        <div class="fork-detail">
                            <div class="fork-detail-value">NO</div>
                            <div class="fork-detail-label">Direction</div>
                        </div>
                        <div class="fork-detail">
                            <div class="fork-detail-value">0.58</div>
                            <div class="fork-detail-label">Price</div>
                        </div>
                    </div>
                </div>
                <div class="fork-item-detail">
                    <div class="fork-header-row">
                        <span class="fork-id">TL-2845-fork-11</span>
                        <span class="fork-time">55m ago</span>
                    </div>
                    <div class="fork-details">
                        <div class="fork-detail">
                            <div class="fork-detail-value">$4,920</div>
                            <div class="fork-detail-label">Notional</div>
                        </div>
                        <div class="fork-detail">
                            <div class="fork-detail-value">YES</div>
                            <div class="fork-detail-label">Direction</div>
                        </div>
                        <div class="fork-detail">
                            <div class="fork-detail-value">0.35</div>
                            <div class="fork-detail-label">Price</div>
                        </div>
                    </div>
                </div>
                <div class="fork-item-detail">
                    <div class="fork-header-row">
                        <span class="fork-id">TL-2844-fork-7</span>
                        <span class="fork-time">1h ago</span>
                    </div>
                    <div class="fork-details">
                        <div class="fork-detail">
                            <div class="fork-detail-value">$2,180</div>
                            <div class="fork-detail-label">Notional</div>
                        </div>
                        <div class="fork-detail">
                            <div class="fork-detail-value">NO</div>
                            <div class="fork-detail-label">Direction</div>
                        </div>
                        <div class="fork-detail">
                            <div class="fork-detail-value">0.70</div>
                            <div class="fork-detail-label">Price</div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Founders Yield -->
            <div class="founders-yield-section">
                <div class="yield-header">
                    <div class="yield-title"><i class="ri-star-line"></i> Founders Yield</div>
                    <div class="yield-value">+$2,847</div>
                </div>
                <div class="yield-breakdown">
                    <div class="yield-item">
                        <div class="yield-item-value">$1,240</div>
                        <div class="yield-item-label">Agent Fees</div>
                    </div>
                    <div class="yield-item">
                        <div class="yield-item-value">$842</div>
                        <div class="yield-item-label">Fork Rewards</div>
                    </div>
                    <div class="yield-item">
                        <div class="yield-item-value">$485</div>
                        <div class="yield-item-label">Paradox Bonus</div>
                    </div>
                    <div class="yield-item">
                        <div class="yield-item-value">$280</div>
                        <div class="yield-item-label">Referral</div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Clock
        function updateClock() {
            const now = new Date();
            const timeString = now.toISOString().slice(0, 19).replace('T', ' ') + ' UTC';
            document.getElementById('clock').textContent = timeString;
        }
        setInterval(updateClock, 1000);
        updateClock();

        // Panel functions
        function openAgentsPanel() {
            document.getElementById('agentsPanel').classList.add('active');
            document.getElementById('backdrop').classList.add('active');
        }

        function closeAgentsPanel() {
            document.getElementById('agentsPanel').classList.remove('active');
            document.getElementById('backdrop').classList.remove('active');
        }

        function openForksPanel() {
            document.getElementById('forksPanel').classList.add('active');
            document.getElementById('backdrop').classList.add('active');
        }

        function closeForksPanel() {
            document.getElementById('forksPanel').classList.remove('active');
            document.getElementById('backdrop').classList.remove('active');
        }

        function closeAllPanels() {
            closeAgentsPanel();
            closeForksPanel();
        }

        // Tab switching
        document.querySelectorAll('.positions-tab').forEach(tab => {
            tab.addEventListener('click', function() {
                document.querySelectorAll('.positions-tab').forEach(t => t.classList.remove('active'));
                this.classList.add('active');
            });
        });

        // Chart button switching
        document.querySelectorAll('.chart-btn').forEach(btn => {
            btn.addEventListener('click', function() {
                document.querySelectorAll('.chart-btn').forEach(b => b.classList.remove('active'));
                this.classList.add('active');
            });
        });
    <\/script>

<script>
(function(){
  function safeClick(sel){
    const el=document.querySelector(sel);
    if(el){ el.click(); return true; }
    return false;
  }
  function clickByText(tag, text){
    const els=[...document.querySelectorAll(tag)];
    const el=els.find(e=> (e.textContent||'').trim().toLowerCase().includes(text.toLowerCase()));
    if(el){ el.click(); return true; }
    return false;
  }
  window.addEventListener('message', function(ev){
    const msg = ev.data || {};
    if(!msg || msg.__echelon_shell__ !== true) return;
    const action = msg.action;
    if(!action) return;
    try{
      switch(action){
        case 'openAlert':
          safeClick('#alertBadgeBtn') || safeClick('.alert-badge-btn') || clickByText('button','alerts');
          break;
        case 'openCompare':
          safeClick('.btn-compare') || safeClick('[onclick*="toggleCompare"]') || safeClick('.compare-open') || safeClick('.compare-btn');
          break;
        case 'openSettings':
          clickByText('button','settings') || safeClick('[data-open="settings"]');
          break;
        case 'newPosition':
          clickByText('button','new position') || safeClick('.header-btn');
          break;
        case 'refresh':
          if(typeof window.refreshDashboard === 'function'){ window.refreshDashboard(); }
          clickByText('button','refresh');
          break;
        case 'marketView':
          clickByText('button','market view') || clickByText('a','market view');
          break;
        case 'roboticsView':
          clickByText('button','robotics view') || clickByText('a','robotics view');
          break;
        case 'agentRoster':
          clickByText('button','agent roster') || clickByText('a','agent roster');
          break;
        case 'globalIntel':
          clickByText('button','global intelligence') || clickByText('a','global intelligence');
          break;
        case 'deployAgent':
          clickByText('button','deploy agent') || clickByText('button','+ deploy');
          break;
        case 'breachConsole':
          clickByText('button','breach console') || clickByText('a','breach console');
          break;
        case 'exportConsole':
          clickByText('button','export console') || clickByText('a','export console');
          break;
        default:
          break;
      }
    }catch(e){ /* ignore */ }
  });
})();
<\/script>

</body>
</html>`,
      rlmf: `<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Echelon RLMF Interface — Robotics Training V3</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=JetBrains+Mono:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        :root {
            /* Core Slate Palette */
            --slate-950: #0B0C0E;
            --slate-900: #121417;
            --slate-850: #151719;
            --slate-800: #1A1D21;
            --slate-750: #26292E;
            --slate-700: #363A40;

            /* Semantic Mappings */
            --bg-app: var(--slate-950);
            --bg-panel: var(--slate-850);
            --bg-card: var(--slate-900);
            --bg-card-hover: var(--slate-800);
            --border-outer: var(--slate-750);
            --border-inner: rgba(54, 58, 64, 0.5);
            --border-glass: rgba(255, 255, 255, 0.05);
            
            /* Typography */
            --text-primary: #F1F5F9;
            --text-secondary: #94A3B8;
            --text-muted: #64748B;
            --font-sans: 'Inter', system-ui, sans-serif;
            --font-mono: 'JetBrains Mono', monospace;

            /* Status Colors */
            --status-success: #4ADE80;
            --status-success-bg: rgba(74, 222, 128, 0.1);
            --status-warning: #FACC15;
            --status-warning-bg: rgba(250, 204, 21, 0.1);
            --status-danger: #FB7185;
            --status-danger-bg: rgba(251, 113, 133, 0.1);
            --status-info: #3B82F6;
            --status-info-bg: rgba(59, 130, 246, 0.1);
            --status-paradox: #8B5CF6;
            --status-paradox-bg: rgba(139, 92, 246, 0.1);

            /* Spacing */
            --radius-sm: 4px;
            --radius-md: 8px;
            --radius-lg: 12px;
        }

        * { margin: 0; padding: 0; box-sizing: border-box; }

        body {
            font-family: var(--font-sans);
            background-color: var(--bg-app);
            color: var(--text-primary);
            min-height: 100vh;
            font-size: 13px;
            line-height: 1.5;
            overflow: hidden;
            -webkit-font-smoothing: antialiased;
        }

        /* Scrollbars */
        ::-webkit-scrollbar { width: 6px; height: 6px; }
        ::-webkit-scrollbar-track { background: var(--bg-app); }
        ::-webkit-scrollbar-thumb { background: var(--border-outer); border-radius: 3px; }
        ::-webkit-scrollbar-thumb:hover { background: var(--slate-700); }

        /* Utilities */
        .mono { font-family: var(--font-mono); font-variant-numeric: tabular-nums; }
        .text-muted { color: var(--text-muted); }
        .text-secondary { color: var(--text-secondary); }
        .text-success { color: var(--status-success); }
        .text-warning { color: var(--status-warning); }
        .text-danger { color: var(--status-danger); }
        .text-info { color: var(--status-info); }
        .text-paradox { color: var(--status-paradox); }
        .label { font-size: 10px; font-weight: 600; text-transform: uppercase; letter-spacing: 0.05em; color: var(--text-muted); }

        /* Navigation */
        .top-nav {
            height: 60px;
            background: var(--bg-panel);
            border-bottom: 1px solid var(--border-outer);
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 0 24px;
            flex-shrink: 0;
            box-shadow: 0 4px 20px rgba(0,0,0,0.2);
            z-index: 100;
        }

        .logo {
            font-size: 18px;
            font-weight: 700;
            letter-spacing: 0.1em;
            color: var(--text-primary);
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .logo::after {
            content: "RLMF INTERFACE";
            font-size: 10px;
            background: var(--bg-card);
            border: 1px solid var(--border-outer);
            padding: 3px 8px;
            border-radius: 4px;
            color: var(--text-muted);
            font-weight: 600;
            letter-spacing: 0.05em;
        }

        .nav-controls { display: flex; align-items: center; gap: 24px; }
        
        .view-toggle {
            display: flex;
            background: var(--bg-app);
            padding: 4px;
            border-radius: var(--radius-md);
            border: 1px solid var(--border-outer);
        }

        .toggle-btn {
            padding: 6px 14px;
            font-size: 11px;
            font-weight: 600;
            color: var(--text-muted);
            background: transparent;
            border: 1px solid transparent;
            border-radius: 6px;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .toggle-btn:hover { color: var(--text-primary); }

        .toggle-btn.active {
            background: var(--bg-panel);
            color: var(--text-primary);
            border-color: var(--border-inner);
            box-shadow: 0 2px 4px rgba(0,0,0,0.2);
        }

        .mode-indicator {
            display: flex;
            align-items: center;
            gap: 12px;
            font-size: 11px;
            font-family: var(--font-mono);
            padding: 6px 12px;
            background: var(--bg-card);
            border: 1px solid var(--border-outer);
border-radius: var(--radius-md);
            color: var(--text-secondary);
        }

        .status-dot { width: 6px; height: 6px; border-radius: 50%; background: var(--status-success); margin-right: 6px; box-shadow: 0 0 8px rgba(74,222,128,0.4); }

        /* Theatre Header */
        .theatre-meta {
            padding: 16px 24px;
            background: var(--bg-app);
            border-bottom: 1px solid var(--border-outer);
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-shrink: 0;
        }

        .theatre-info h2 { font-size: 14px; font-weight: 600; margin-bottom: 6px; display: flex; align-items: center; gap: 8px; color: var(--text-primary); letter-spacing: 0.02em; }

        .badge {
            font-size: 9px;
            padding: 3px 8px;
            border-radius: 4px;
            text-transform: uppercase;
            font-weight: 700;
            border: 1px solid transparent;
            letter-spacing: 0.05em;
        }

        .badge.blue { background: var(--status-info-bg); color: var(--status-info); border-color: rgba(59, 130, 246, 0.2); }
        .badge.green { background: var(--status-success-bg); color: var(--status-success); border-color: rgba(74, 222, 128, 0.2); }
        .badge.purple { background: var(--status-paradox-bg); color: var(--status-paradox); border-color: rgba(139, 92, 246, 0.2); }
        
        .meta-stats { display: flex; gap: 32px; text-align: right; }
        .stat-pair { display: flex; flex-direction: column; gap: 2px; }
        .stat-pair label { font-size: 9px; color: var(--text-muted); text-transform: uppercase; letter-spacing: 0.05em; font-weight: 600; }
        .stat-pair span { font-family: var(--font-mono); font-size: 13px; font-weight: 500; color: var(--text-primary); }

        /* Main Grid */
        .main-grid {
            display: grid;
            grid-template-columns: 2fr 1fr;
            gap: 20px;
            padding: 24px;
            height: calc(100vh - 130px);
            overflow: hidden;
        }
        
        .col-left, .col-right {
            display: flex;
            flex-direction: column;
            gap: 16px;
            overflow-y: auto;
            padding-right: 4px;
        }

        /* Panels & Cards */
        .panel {
            background: var(--bg-panel);
            border: 1px solid var(--border-outer);
            border-radius: var(--radius-lg);
            overflow: hidden;
            flex-shrink: 0;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
            position: relative;
        }
        /* Top inner highlight for glass feel */
        .panel::after {
            content: ''; position: absolute; top: 0; left: 0; right: 0; height: 1px;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.1), transparent);
            pointer-events: none;
        }

        .panel-header {
            padding: 12px 20px;
            background: rgba(18, 20, 23, 0.6);
            border-bottom: 1px solid var(--border-outer);
            display: flex;
            justify-content: space-between;
            align-items: center;
            backdrop-filter: blur(8px);
        }

        .panel-title { 
            font-size: 11px; font-weight: 700; text-transform: uppercase; 
            letter-spacing: 0.08em; color: var(--text-muted); 
            display: flex; align-items: center; gap: 8px; 
        }
        .panel-body { padding: 20px; position: relative; }

        /* 3D Visualizer (Tactical Feed Style) */
        .visualizer-container {
            height: 360px;
            position: relative;
            background: radial-gradient(circle at center, #13161a 0%, #08090a 100%);
            border-bottom: 1px solid var(--border-outer);
            overflow: hidden;
        }
        
        /* Grid Overlay */
        .grid-overlay {
            position: absolute; inset: 0;
            background-image: 
                linear-gradient(rgba(255, 255, 255, 0.03) 1px, transparent 1px),
                linear-gradient(90deg, rgba(255, 255, 255, 0.03) 1px, transparent 1px);
            background-size: 40px 40px;
            pointer-events: none;
        }
        
        /* Scanlines */
        .scanlines {
            position: absolute; inset: 0;
            background: linear-gradient(to bottom, rgba(255,255,255,0), rgba(255,255,255,0) 50%, rgba(0,0,0,0.2) 50%, rgba(0,0,0,0.2));
            background-size: 100% 4px;
            pointer-events: none;
            opacity: 0.6;
            z-index: 5;
        }

        .hud-overlay {
            position: absolute;
            top: 16px;
            left: 16px;
            background: rgba(11, 12, 14, 0.7);
            border: 1px solid var(--border-outer);
            box-shadow: 0 4px 12px rgba(0,0,0,0.3);
            backdrop-filter: blur(4px);
            padding: 16px;
            border-radius: var(--radius-md);
            width: 200px;
            z-index: 10;
        }

        .hud-row { display: flex; justify-content: space-between; margin-bottom: 10px; font-size: 11px; align-items: center; }
        .hud-row:last-child { margin-bottom: 0; }
        .hud-bar { height: 4px; background: var(--bg-app); margin-top: 6px; border-radius: 2px; overflow: hidden; border: 1px solid var(--border-inner); }
        .hud-fill { height: 100%; background: var(--status-success); width: 87%; transition: width 0.3s; box-shadow: 0 0 8px rgba(74,222,128,0.5); }

        /* Animation Elements */
        .star { position: absolute; background: white; border-radius: 50%; opacity: 0.4; }
        
        .station-mockup {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 140px;
            height: 90px;
            border: 1px solid rgba(59, 130, 246, 0.4);
            background: rgba(59, 130, 246, 0.05);
            border-radius: 8px;
            box-shadow: 0 0 20px rgba(59, 130, 246, 0.1);
        }

        .orbit-ring {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 280px;
            height: 280px;
            border: 1px dashed rgba(139, 92, 246, 0.3);
            border-radius: 50%;
            animation: spin 30s linear infinite;
        }

        @keyframes spin { from { transform: translate(-50%, -50%) rotate(0deg); } to { transform: translate(-50%, -50%) rotate(360deg); } }
        
        .agent-avatar {
            position: absolute;
            top: 50%; right: 20%;
            transform: translateY(-50%);
            width: 36px; height: 36px;
            background: var(--bg-card);
            border: 2px solid var(--status-info);
            border-radius: 50%;
            display: flex; align-items: center; justify-content: center;
            box-shadow: 0 0 15px rgba(59, 130, 246, 0.5);
            z-index: 10; font-size: 16px;
        }

        .alert-overlay {
            position: absolute; inset: 0;
            background: rgba(239, 68, 68, 0.15);
            display: flex; align-items: center; justify-content: center;
            backdrop-filter: blur(4px);
            z-index: 50; display: none;
        }

        .alert-box {
            background: var(--bg-panel);
            border: 1px solid var(--status-danger);
            padding: 24px 32px;
            border-radius: var(--radius-lg);
            text-align: center;
            box-shadow: 0 0 40px rgba(239, 68, 68, 0.3);
            border-top: 4px solid var(--status-danger);
        }

        /* Agent Thoughts */
        .terminal-log {
            font-family: var(--font-mono);
            font-size: 11px;
            padding: 12px 16px;
            background: var(--bg-card);
            border-left: 2px solid var(--status-info);
            color: var(--text-secondary);
            display: flex; gap: 16px; align-items: center;
        }

        .log-avatar {
            width: 24px; height: 24px;
            background: rgba(59, 130, 246, 0.1);
            border-radius: 4px;
            display: flex; align-items: center; justify-content: center;
            font-size: 14px;
        }

        /* Fork Options */
        .fork-grid { display: grid; grid-template-columns: repeat(3, 1fr); gap: 16px; }
        
        .fork-option {
            background: var(--bg-card);
            border: 1px solid var(--border-outer);
            border-radius: var(--radius-md);
            padding: 16px;
            cursor: pointer;
            transition: all 0.2s;
            position: relative;
            overflow: hidden;
        }

        .fork-option:hover { transform: translateY(-2px); border-color: var(--text-muted); box-shadow: 0 4px 12px rgba(0,0,0,0.2); }
        .fork-option.selected-A { border-color: var(--status-info); background: rgba(59, 130, 246, 0.05); }
        .fork-option.selected-B { border-color: var(--status-warning); background: rgba(250, 204, 21, 0.05); }
        .fork-option.selected-C { border-color: var(--status-paradox); background: rgba(139, 92, 246, 0.05); }

        .opt-header { display: flex; justify-content: space-between; margin-bottom: 12px; font-size: 11px; font-weight: 700; letter-spacing: 0.05em; }
        .opt-price { font-family: var(--font-mono); font-weight: 700; font-size: 14px; }
        .opt-desc { font-size: 12px; color: var(--text-secondary); margin-bottom: 12px; line-height: 1.4; }
        .opt-meta { font-size: 10px; color: var(--text-muted); display: flex; justify-content: space-between; border-top: 1px solid var(--border-inner); padding-top: 8px; font-weight: 500; text-transform: uppercase; }

        /* Betting Panel - Refined */
        .betting-panel {
            background: var(--bg-panel);
            border: 1px solid var(--border-outer);
            border-radius: var(--radius-lg);
            overflow: hidden; flex-shrink: 0; margin-top: 20px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.2);
        }

        .betting-panel .panel-header {
            background: linear-gradient(90deg, rgba(59, 130, 246, 0.1), transparent);
            border-bottom: 1px solid rgba(59, 130, 246, 0.2);
        }

        .betting-grid { display: grid; grid-template-columns: repeat(3, 1fr); gap: 16px; padding: 20px; }

        .bet-option {
            background: var(--bg-card);
            border: 1px solid var(--border-outer);
            border-radius: var(--radius-md);
            padding: 16px;
            transition: all 0.2s;
            display: flex; flex-direction: column;
        }

        .bet-option:hover { border-color: var(--text-muted); transform: translateY(-1px); }
        .bet-option.highlight-A { border-top: 2px solid var(--status-info); }
        .bet-option.highlight-B { border-top: 2px solid var(--status-warning); }
        .bet-option.highlight-C { border-top: 2px solid var(--status-paradox); }

        .bet-option-label { font-size: 10px; font-weight: 700; text-transform: uppercase; letter-spacing: 0.08em; margin-bottom: 8px; }
        .bet-option-label.text-A { color: var(--status-info); }
        .bet-option-label.text-B { color: var(--status-warning); }
        .bet-option-label.text-C { color: var(--status-paradox); }

        .bet-price { font-family: var(--font-mono); font-size: 18px; font-weight: 700; margin-bottom: 4px; color: var(--text-primary); }
        .bet-probability { font-size: 12px; color: var(--text-muted); font-weight: 400; font-family: var(--font-sans); }

        /* Custom Range Slider */
        .betting-slider-container { margin: 16px 0 12px 0; }
        .betting-slider {
            width: 100%; height: 4px;
            -webkit-appearance: none; appearance: none;
            background: var(--bg-app); border-radius: 2px;
            outline: none; cursor: pointer; border: 1px solid var(--border-outer);
        }
        .betting-slider::-webkit-slider-thumb {
            -webkit-appearance: none; appearance: none;
            width: 12px; height: 12px; border-radius: 50%;
            background: var(--text-primary); cursor: pointer;
            border: 2px solid var(--bg-card);
            box-shadow: 0 0 0 2px rgba(255,255,255,0.1);
            transition: transform 0.1s;
        }
        .betting-slider::-webkit-slider-thumb:hover { transform: scale(1.2); }

        .bet-size-display {
            font-family: var(--font-mono); font-size: 12px; font-weight: 600;
            color: var(--text-primary); margin-bottom: 12px;
            display: flex; justify-content: space-between;
            padding-bottom: 8px; border-bottom: 1px dashed var(--border-inner);
        }

        .bet-btn {
            width: 100%; padding: 10px; margin-top: auto;
            background: var(--bg-app); border: 1px solid var(--border-outer);
            border-radius: var(--radius-sm); color: var(--text-muted);
            font-size: 11px; font-weight: 600; text-transform: uppercase; letter-spacing: 0.05em;
            cursor: pointer; transition: all 0.2s;
        }
        .bet-btn:hover:not(:disabled) { border-color: var(--text-primary); color: var(--text-primary); background: var(--bg-panel); }
        .bet-btn:disabled { opacity: 0.5; cursor: not-allowed; }
        .bet-btn.confirm { background: var(--status-success); border-color: var(--status-success); color: #000; }

        /* RLMF Narrative */
        .rlmf-narrative {
            background: linear-gradient(135deg, rgba(34, 211, 238, 0.05), rgba(168, 85, 247, 0.05));
            border: 1px solid rgba(34, 211, 238, 0.15);
            border-radius: var(--radius-md);
            padding: 14px 20px; margin: 0 20px 20px 20px;
            display: flex; align-items: center; gap: 16px;
            font-size: 12px; color: var(--text-secondary); line-height: 1.5;
        }
        .rlmf-narrative strong { color: #22D3EE; font-weight: 600; }

        /* Contribution & Positions */
        .contribution-panel { background: var(--bg-card); border: 1px solid var(--border-outer); border-radius: var(--radius-md); padding: 16px; margin: 0 20px 20px 20px; }
        .contribution-grid { display: grid; grid-template-columns: repeat(3, 1fr); gap: 12px; }
        .contribution-item { text-align: center; padding: 12px; background: var(--bg-app); border-radius: var(--radius-sm); border: 1px solid var(--border-inner); }
        .contribution-value { font-family: var(--font-mono); font-size: 18px; font-weight: 700; color: var(--text-primary); margin-bottom: 4px; }
        .contribution-label { font-size: 9px; color: var(--text-muted); text-transform: uppercase; letter-spacing: 0.05em; }

        .my-positions { background: var(--bg-card); border: 1px solid var(--border-outer); border-radius: var(--radius-md); padding: 16px; margin: 0 20px 20px 20px; }
        .position-item { display: flex; justify-content: space-between; align-items: center; padding: 10px; background: var(--bg-app); border-radius: var(--radius-sm); margin-bottom: 8px; border: 1px solid var(--border-inner); }
        .position-option { font-size: 10px; font-weight: 700; padding: 3px 8px; border-radius: 3px; text-transform: uppercase; }
        .position-option.A { background: var(--status-info-bg); color: var(--status-info); }
        .position-option.B { background: var(--status-warning-bg); color: var(--status-warning); }
        .position-option.C { background: var(--status-paradox-bg); color: var(--status-paradox); }
        .position-pnl { font-family: var(--font-mono); font-size: 11px; font-weight: 600; padding: 2px 6px; border-radius: 3px; }
        .position-pnl.positive { color: var(--status-success); }
        .position-pnl.negative { color: var(--status-danger); }

        /* Timeline */
        .timeline-steps { padding-left: 12px; margin-top: 12px; border-left: 1px solid var(--border-inner); margin-left: 8px; }
        .t-step { position: relative; padding-left: 24px; margin-bottom: 24px; }
        .t-dot { 
            position: absolute; left: -5px; top: 2px; width: 9px; height: 9px;
            border-radius: 50%; background: var(--bg-panel); border: 2px solid var(--border-outer);
            transition: all 0.3s;
        }
        .t-step.active .t-dot { border-color: var(--status-info); background: var(--status-info); box-shadow: 0 0 0 4px rgba(59, 130, 246, 0.15); }
        .t-step.done .t-dot { border-color: var(--status-success); background: var(--status-success); }
        .t-time { font-family: var(--font-mono); font-size: 11px; color: var(--text-primary); font-weight: 600; }
        .t-desc { font-size: 11px; color: var(--text-muted); margin-top: 4px; }

        /* Right Column Metrics */
        .reward-row { margin-bottom: 12px; }
        .reward-label { display: flex; justify-content: space-between; font-size: 10px; color: var(--text-muted); margin-bottom: 6px; font-weight: 600; letter-spacing: 0.03em; }
        .reward-track { height: 6px; background: var(--bg-app); border-radius: 3px; overflow: hidden; border: 1px solid var(--border-inner); }
        .reward-fill { height: 100%; border-radius: 2px; transition: width 0.5s ease; box-shadow: 0 0 10px rgba(0,0,0,0.3); }
        
        .metric-row { 
            display: flex; justify-content: space-between; align-items: center;
            padding: 10px 14px; background: var(--bg-card);
            border-radius: var(--radius-md); margin-bottom: 8px;
            border: 1px solid var(--border-inner);
        }
        .metric-label { font-size: 11px; color: var(--text-secondary); font-weight: 500; }
        .metric-val { font-family: var(--font-mono); font-size: 13px; font-weight: 600; }

        .export-form { background: var(--bg-card); padding: 16px; border-radius: var(--radius-md); border: 1px dashed var(--border-outer); }
        .form-row { display: flex; justify-content: space-between; align-items: center; margin-bottom: 14px; font-size: 11px; color: var(--text-secondary); }
        select, input[type="range"] { background: var(--bg-app); border: 1px solid var(--border-outer); color: var(--text-primary); padding: 4px 8px; border-radius: 4px; font-size: 11px; outline: none; }
        
        .btn-export { 
            width: 100%; padding: 10px; background: var(--bg-panel);
            border: 1px solid var(--status-info); color: var(--status-info);
            border-radius: var(--radius-md); font-weight: 600; cursor: pointer; font-size: 11px;
            transition: all 0.2s; text-transform: uppercase; letter-spacing: 0.05em;
        }
        .btn-export:hover { background: var(--status-info-bg); }

        .code-block { 
            background: var(--bg-app); border: 1px solid var(--border-outer);
            padding: 14px; border-radius: var(--radius-md); font-family: var(--font-mono);
            font-size: 10px; color: var(--text-muted); line-height: 1.6; overflow-x: auto;
            margin-top: 12px;
        }

        .action-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; }
        .action-btn {
            padding: 10px; background: var(--bg-card); border: 1px solid var(--border-outer);
            border-radius: var(--radius-md); color: var(--text-secondary);
            font-size: 11px; font-weight: 600; cursor: pointer; transition: all 0.2s;
        }
        .action-btn:hover { background: var(--bg-card-hover); border-color: var(--text-muted); color: var(--text-primary); }
        .action-btn.danger:hover { border-color: var(--status-danger); color: var(--status-danger); }

        /* Animation */
        .saboteur-flash { animation: flashRed 0.5s ease-out; }
        @keyframes flashRed { 0%, 100% { background: transparent; } 50% { background: rgba(239, 68, 68, 0.3); } }

        /* Responsive */
        @media (max-width: 980px) {
            .main-grid { grid-template-columns: 1fr; height: auto; overflow: visible; }
            .col-left, .col-right { overflow: visible; }
        }
    </style>
<style id="__shell_hide__">.top-nav{display:none!important;}
.connection-status,.system-clock,.clock,#clock,.live-indicator,.network-badge{display:none!important;}
html,body{height:100%;} body{overflow:hidden;}

/* __table_fix__ */
.leaderboard-table{width:100%!important;border-collapse:collapse!important;table-layout:fixed!important;}
.leaderboard-table thead th{padding:10px 16px!important;text-align:left!important;font-size:10px!important;letter-spacing:.08em!important;text-transform:uppercase!important;color:var(--text-muted)!important;font-weight:700!important;border-bottom:1px solid var(--border-outer)!important;background:var(--bg-card)!important;position:sticky!important;top:0!important;z-index:2!important;}
.leaderboard-table tbody td{padding:10px 16px!important;border-bottom:1px solid var(--border-inner)!important;vertical-align:middle!important;font-size:11px!important;color:var(--text-secondary)!important;}
.leaderboard-table th.numeric,.leaderboard-table td.numeric{text-align:right!important;}
.leaderboard-table th:first-child,.leaderboard-table td:first-child{width:30px!important;padding-left:16px!important;}
.main-grid{height:calc(100vh - 70px)!important;}
</style>
</head>
<body>

    <nav class="top-nav">
        <div class="logo">ECHELON</div>
        <div class="nav-controls">
            <div class="view-toggle">
                <button class="toggle-btn active" onclick="switchView('market')">Market View</button>
                <button class="toggle-btn" onclick="switchView('robotics')">Robotics View</button>
            </div>
            
            <div class="mode-indicator">
                <span class="status-dot"></span>
                <span>Mode 0: Deterministic</span>
                <span class="text-muted" style="margin: 0 8px;">|</span>
                <span class="mono text-success">Conf: 0.98</span>
            </div>
        </div>
    </nav>

    <div class="theatre-meta">
        <div class="theatre-info">
            <h2>
                Orbital Salvage Echelon
                <span class="badge blue">3D SPATIAL</span>
                <span class="badge purple">MANIPULATION</span>
            </h2>
            <div class="text-muted" style="font-size: 11px;">ID: orbital_salvage_v1 • Template: 3D-INERT • Diff: Standard</div>
        </div>
        <div class="meta-stats">
            <div class="stat-pair">
                <label>Epoch</label>
                <span><span class="text-info">184</span>/250</span>
            </div>
            <div class="stat-pair">
                <label>Elapsed</label>
                <span id="time-elapsed">00:00</span>
            </div>
        </div>
    </div>

    <main class="main-grid">
        
        <div class="col-left">
            <div class="panel">
                <div class="panel-header">
                    <span class="panel-title">
                        <svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="2" y="2" width="20" height="20" rx="5" ry="5"></rect><path d="M16 11.37A4 4 0 1 1 12.63 8 4 4 0 0 1 16 11.37z"></path></svg>
                        LIVE TELEMETRY FEED
                    </span>
                    <div class="mono" style="font-size:11px;">Fork #7 in: <span class="text-warning" id="fork-timer">45s</span></div>
                </div>
                
                <div class="visualizer-container">
                    <div class="grid-overlay"></div>
                    <div class="scanlines"></div>
                    <div id="stars-container"></div>
                    
                    <div class="orbit-ring"></div>
                    <div class="station-mockup">
                        <div style="position:absolute; top:-10px; left:50%; width:4px; height:10px; background:rgba(59,130,246,0.5);"></div>
                        <div style="position:absolute; bottom:-10px; left:50%; width:4px; height:10px; background:rgba(59,130,246,0.5);"></div>
                    </div>
                    
                    <div class="agent-avatar">🤖</div>

                    <div class="hud-overlay">
                        <div class="hud-row">
                            <span class="label">STABILITY</span>
                            <span class="mono text-success" id="stability">87.3%</span>
                        </div>
                        <div class="hud-bar"><div class="hud-fill" id="stability-bar"></div></div>
                        <div class="hud-row" style="margin-top:10px;">
                            <span class="label">LOGIC GAP</span>
                            <span class="mono text-warning" id="logic-gap">12.4%</span>
                        </div>
                        <div class="hud-row">
                            <span class="label">ENTROPY</span>
                            <span class="mono text-info" id="entropy">0.34</span>
                        </div>
                    </div>

                    <div class="alert-overlay" id="saboteur-alert">
                        <div class="alert-box">
                            <div style="font-size:32px; margin-bottom:8px;">⚠️</div>
                            <h3 class="text-danger" style="font-weight:700; margin-bottom:4px;">SABOTEUR DETECTED</h3>
                            <p class="text-secondary" style="font-size:12px;">Micro-debris field approaching</p>
                            <p class="mono text-muted" style="font-size:10px; margin-top:8px;">Stability impact: -15%</p>
                        </div>
                    </div>
                </div>

                <div style="padding: 16px; border-bottom: 1px solid var(--border-outer);">
                    <div class="terminal-log">
                        <div class="log-avatar">🦈</div>
                        <div>
                            <div class="text-primary" style="font-weight:600; margin-bottom:2px;">MEGALODON <span class="text-muted" style="font-weight:400; font-size:10px;">(SHARK ARCHETYPE)</span></div>
                            <div id="agent-thoughts" class="text-info">Analyzing fork point options...</div>
                        </div>
                    </div>
                </div>

                <div class="panel-body">
                    <h3 class="label" style="margin-bottom:12px;">🎯 FORK POINT #7 DECISION</h3>
                    <div class="fork-grid">
                        <div class="fork-option" data-option="A" onclick="selectOption('A')">
                            <div class="opt-header">
                                <span class="text-info">OPTION A</span>
                                <span class="opt-price text-success">$2.40</span>
                            </div>
                            <div class="opt-desc">Stabilize rotation & secure debris.</div>
                            <div class="opt-meta">
                                <span>Risk: MED</span>
                                <span>30s</span>
                            </div>
                        </div>
                        <div class="fork-option" data-option="B" onclick="selectOption('B')">
                            <div class="opt-header">
                                <span class="text-warning">OPTION B</span>
                                <span class="opt-price text-success">$3.80</span>
                            </div>
                            <div class="opt-desc">Cut and grab immediately.</div>
                            <div class="opt-meta">
                                <span>Risk: HIGH</span>
                                <span>12s</span>
                            </div>
                        </div>
                        <div class="fork-option" data-option="C" onclick="selectOption('C')">
                            <div class="opt-header">
                                <span class="text-danger">OPTION C</span>
                                <span class="opt-price text-success">$1.20</span>
                            </div>
                            <div class="opt-desc">Wait for docking window.</div>
                            <div class="opt-meta">
                                <span>Risk: LOW</span>
                                <span>120s</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="betting-panel">
                <div class="panel-header">
                    <span class="panel-title">
                        <svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M12 2v20M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6"></path></svg>
                        PLACE YOUR BET
                    </span>
                    <span class="mono text-muted" style="font-size:11px;">Fork #7</span>
                </div>
                <div class="betting-grid">
                    <div class="bet-option highlight-A">
                        <div class="bet-option-label text-A">OPTION A</div>
                        <div class="bet-price">
                            $2.40
                            <span class="bet-probability">(42%)</span>
                        </div>
                        <div class="betting-slider-container">
                            <input type="range" class="betting-slider" id="slider-A" min="0" max="10000" step="100" value="0" oninput="updateBetSize('A')">
                        </div>
                        <div class="bet-size-display">
                            <span>BET SIZE</span>
                            <span id="bet-size-A">$0</span>
                        </div>
                        <button class="bet-btn" id="btn-A" onclick="placeBet('A')" disabled>Confirm Bet</button>
                    </div>
                    
                    <div class="bet-option highlight-B">
                        <div class="bet-option-label text-B">OPTION B</div>
                        <div class="bet-price">
                            $3.80
                            <span class="bet-probability">(38%)</span>
                        </div>
                        <div class="betting-slider-container">
                            <input type="range" class="betting-slider" id="slider-B" min="0" max="10000" step="100" value="0" oninput="updateBetSize('B')">
                        </div>
                        <div class="bet-size-display">
                            <span>BET SIZE</span>
                            <span id="bet-size-B">$0</span>
                        </div>
                        <button class="bet-btn" id="btn-B" onclick="placeBet('B')" disabled>Confirm Bet</button>
                    </div>
                    
                    <div class="bet-option highlight-C">
                        <div class="bet-option-label text-C">OPTION C</div>
                        <div class="bet-price">
                            $1.20
                            <span class="bet-probability">(12%)</span>
                        </div>
                        <div class="betting-slider-container">
                            <input type="range" class="betting-slider" id="slider-C" min="0" max="10000" step="100" value="0" oninput="updateBetSize('C')">
                        </div>
                        <div class="bet-size-display">
                            <span>BET SIZE</span>
                            <span id="bet-size-C">$0</span>
                        </div>
                        <button class="bet-btn" id="btn-C" onclick="placeBet('C')" disabled>Confirm Bet</button>
                    </div>
                </div>
                
                <div class="rlmf-narrative">
                    <span>🤖</span>
                    <span>
                        <strong>Your bets create market prices → Market prices become reward signals → Reward signals train robot policies</strong>
                    </span>
                </div>
                
                <div class="contribution-panel">
                    <div class="panel-title" style="margin-bottom:12px;">📊 YOUR RLMF CONTRIBUTION</div>
                    <div class="contribution-grid">
                        <div class="contribution-item">
                            <div class="contribution-value" id="contrib-episodes">47</div>
                            <div class="contribution-label">Episodes</div>
                        </div>
                        <div class="contribution-item">
                            <div class="contribution-value" id="contrib-vectors">184</div>
                            <div class="contribution-label">Reward Vectors</div>
                        </div>
                        <div class="contribution-item">
                            <div class="contribution-value" id="contrib-partners">2</div>
                            <div class="contribution-label">Robot Partners</div>
                        </div>
                    </div>
                </div>
                
                <div class="my-positions">
                    <div class="panel-title" style="margin-bottom:12px; display:flex; justify-content:space-between;">
                        <span>🎯 MY POSITIONS</span>
                        <span class="mono text-info" id="total-exposure">$2,450.00</span>
                    </div>
                    <div id="positions-list">
                        <div class="position-item">
                            <div style="display:flex; gap:8px; align-items:center;">
                                <span class="position-option A">A</span>
                                <span class="text-muted" style="font-size:10px;">14:28:33</span>
                            </div>
                            <div style="display:flex; gap:12px; align-items:center;">
                                <span class="mono" style="font-weight:600;">$1,200</span>
                                <span class="position-pnl positive">+$42</span>
                            </div>
                        </div>
                        <div class="position-item">
                            <div style="display:flex; gap:8px; align-items:center;">
                                <span class="position-option B">B</span>
                                <span class="text-muted" style="font-size:10px;">14:27:15</span>
                            </div>
                            <div style="display:flex; gap:12px; align-items:center;">
                                <span class="mono" style="font-weight:600;">$850</span>
                                <span class="position-pnl negative">-$18</span>
                            </div>
                        </div>
                        <div class="position-item">
                            <div style="display:flex; gap:8px; align-items:center;">
                                <span class="position-option A">A</span>
                                <span class="text-muted" style="font-size:10px;">14:25:42</span>
                            </div>
                            <div style="display:flex; gap:12px; align-items:center;">
                                <span class="mono" style="font-weight:600;">$400</span>
                                <span class="position-pnl positive">+$14</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="panel">
                <div class="panel-header">
                    <span class="panel-title">FORK RESOLUTION PATH</span>
                </div>
                <div class="panel-body">
                    <div class="timeline-steps">
                        <div class="t-step done">
                            <div class="t-dot"></div>
                            <div class="t-time">T+00:00 — Fork Triggered</div>
                            <div class="t-desc">Agent reached decision point #7</div>
                        </div>
                        <div class="t-step active">
                            <div class="t-dot"></div>
                            <div class="t-time">T+00:45 — Market Converges</div>
                            <div class="t-desc">Option B: 62% | Option A: 28% | Option C: 10%</div>
                        </div>
                        <div class="t-step">
                            <div class="t-dot"></div>
                            <div class="t-time">T+01:00 — Action Executed</div>
                            <div class="t-desc">Agent selects and executes chosen option</div>
                        </div>
                        <div class="t-step">
                            <div class="t-dot"></div>
                            <div class="t-time">T+01:30 — Settlement</div>
                            <div class="t-desc">Deterministic outcome via simulation logs</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div class="col-right">
            
            <div class="panel">
                <div class="panel-header">
                    <span class="panel-title">REWARD VECTOR</span>
                    <span class="mono text-info" style="font-size:11px; font-weight:600;">0.68</span>
                </div>
                <div class="panel-body">
                    <div class="reward-row">
                        <div class="reward-label"><span>TIME EFFICIENCY</span> <span class="mono">0.72</span></div>
                        <div class="reward-track"><div class="reward-fill" style="width: 72%; background:var(--status-info);"></div></div>
                    </div>
                    <div class="reward-row">
                        <div class="reward-label"><span>VALUE</span> <span class="mono">0.88</span></div>
                        <div class="reward-track"><div class="reward-fill" style="width: 88%; background:var(--status-success);"></div></div>
                    </div>
                    <div class="reward-row">
                        <div class="reward-label"><span>COLLATERAL</span> <span class="mono">0.35</span></div>
                        <div class="reward-track"><div class="reward-fill" style="width: 35%; background:var(--status-warning);"></div></div>
                    </div>
                    <div class="reward-row">
                        <div class="reward-label"><span>SAFETY</span> <span class="mono">0.91</span></div>
                        <div class="reward-track"><div class="reward-fill" style="width: 91%; background:var(--status-success);"></div></div>
                    </div>
                    <div class="reward-row">
                        <div class="reward-label"><span>TRACE</span> <span class="mono">0.58</span></div>
                        <div class="reward-track"><div class="reward-fill" style="width: 58%; background:var(--status-paradox);"></div></div>
                    </div>
                </div>
            </div>

            <div class="panel">
                <div class="panel-header">
                    <span class="panel-title">MARKET COLLABORATION</span>
                </div>
                <div class="panel-body">
                    <div style="font-size:10px; color:var(--text-muted); margin-bottom:12px; border:1px solid var(--border-outer); padding:8px; border-radius:4px; background:var(--bg-app);">
                        TARGETS: Brier &lt; 0.20 | ECE &lt; 0.10
                    </div>
                    <div class="metric-row">
                        <span class="metric-label">Brier Score</span>
                        <span class="metric-val text-success">0.19</span>
                    </div>
                    <div class="metric-row">
                        <span class="metric-label">ECE (Error)</span>
                        <span class="metric-val text-success">0.06</span>
                    </div>
                    <div class="metric-row">
                        <span class="metric-label">Agent Accuracy</span>
                        <span class="metric-val text-info">67.3%</span>
                    </div>
                    <div class="metric-row">
                        <span class="metric-label">Sample Size</span>
                        <span class="metric-val text-muted">12,847</span>
                    </div>
                </div>
            </div>

            <div class="panel">
                <div class="panel-header">
                    <span class="panel-title">ACTIVE AGENTS (7)</span>
                </div>
                <div class="panel-body">
                    <div class="dist-row">
                        <span class="dist-label">SHARK (3)</span>
                        <div class="dist-bar-bg"><div class="dist-bar-fill" style="width:43%; background:var(--status-info);"></div></div>
                    </div>
                    <div class="dist-row">
                        <span class="dist-label">SPY (2)</span>
                        <div class="dist-bar-bg"><div class="dist-bar-fill" style="width:29%; background:var(--status-paradox);"></div></div>
                    </div>
                    <div class="dist-row">
                        <span class="dist-label">SABOT (1)</span>
                        <div class="dist-bar-bg"><div class="dist-bar-fill" style="width:14%; background:var(--status-danger);"></div></div>
                    </div>
                    <div class="dist-row">
                        <span class="dist-label">DIPLO (1)</span>
                        <div class="dist-bar-bg"><div class="dist-bar-fill" style="width:14%; background:var(--status-warning);"></div></div>
                    </div>
                </div>
            </div>

            <div class="panel" id="fork-market">
                <div class="panel-header">
                    <span class="panel-title">FORK MARKET</span>
                </div>
                <div class="panel-body" style="display:flex; flex-direction:column; gap:8px;">
                     <div class="metric-row" style="background:rgba(59,130,246,0.05); border-color:rgba(59,130,246,0.2);">
                        <span class="metric-label text-info">Option A</span>
                        <div style="text-align:right;"><div class="metric-val text-info">42%</div><div class="mono text-muted" style="font-size:10px;">$2.40</div></div>
                    </div>
                    <div class="metric-row" style="background:rgba(250,204,21,0.05); border-color:rgba(250,204,21,0.2);">
                        <span class="metric-label text-warning">Option B</span>
                        <div style="text-align:right;"><div class="metric-val text-warning">38%</div><div class="mono text-muted" style="font-size:10px;">$3.80</div></div>
                    </div>
                    <div class="metric-row" style="background:rgba(139,92,246,0.05); border-color:rgba(139,92,246,0.2);">
                        <span class="metric-label text-paradox" style="color:var(--status-paradox)">Option C</span>
                        <div style="text-align:right;"><div class="metric-val text-paradox" style="color:var(--status-paradox)">12%</div><div class="mono text-muted" style="font-size:10px;">$1.20</div></div>
                    </div>
                </div>
            </div>

            <div class="panel">
                <div class="panel-header"><span class="panel-title">RLMF EXPORT</span></div>
                <div class="panel-body">
                    <div class="export-form">
                        <div class="form-row"><span>Sampling Rate</span> <span class="mono">50%</span></div>
                        <input type="range" style="width:100%; margin-bottom:12px;" min="0" max="100" value="50">
                        <div class="form-row"><span>Format</span> <select><option>PyTorch (.pt)</option><option>JSON</option></select></div>
                        <button class="btn-export">📥 EXPORT DATA</button>
                    </div>
                    <div class="code-block">
{
  "episode_id": "uuid-184",
  "reward": { "time": 0.72, "val": 0.88 },
  "calib": { "brier": 0.19 }
}
                    </div>
                </div>
            </div>

            <div class="panel">
                <div class="panel-header"><span class="panel-title">ACTIONS</span></div>
                <div class="panel-body">
                    <div class="action-grid">
                        <button class="action-btn" onclick="triggerManualDecision()">Override</button>
                        <button class="action-btn" onclick="skipToNextFork()">Skip Fork</button>
                        <button class="action-btn danger" onclick="triggerSaboteur()">Inject Saboteur</button>
                        <button class="action-btn danger" onclick="triggerParadox()">Force Paradox</button>
                    </div>
                </div>
            </div>

        </div>
    </main>

    <script>
        // Stars initialization
        function createStars() {
            const container = document.getElementById('stars-container');
            for (let i = 0; i < 60; i++) {
                const star = document.createElement('div');
                star.className = 'star';
                star.style.width = Math.random() * 2 + 1 + 'px';
                star.style.height = star.style.width;
                star.style.left = Math.random() * 100 + '%';
                star.style.top = Math.random() * 100 + '%';
                star.style.opacity = Math.random() * 0.5 + 0.2;
                container.appendChild(star);
            }
        }
        
        // Betting State
        let bettingState = {
            A: { size: 0, price: 2.40 },
            B: { size: 0, price: 3.80 },
            C: { size: 0, price: 1.20 }
        };
        
        let myPositions = [
            { option: 'A', size: 1200, price: 2.40, timestamp: '14:28:33' },
            { option: 'B', size: 850, price: 3.80, timestamp: '14:27:15' },
            { option: 'A', size: 400, price: 2.40, timestamp: '14:25:42' }
        ];
        
        let contributionMetrics = {
            episodes: 47,
            vectors: 184,
            partners: 2
        };
        
        // Update bet size display
        function updateBetSize(option) {
            const slider = document.getElementById(\`slider-\${option}\`);
            const size = parseInt(slider.value);
            const betSizeEl = document.getElementById(\`bet-size-\${option}\`);
            const btnEl = document.getElementById(\`btn-\${option}\`);
            
            betSizeEl.textContent = \`$\${size.toLocaleString()}\`;
            bettingState[option].size = size;
            
            // Enable/disable button based on bet size
            btnEl.disabled = size === 0;
            
            if (size > 0) {
                btnEl.textContent = \`CONFIRM $\${(size / 100).toFixed(0)} BET\`;
            } else {
                btnEl.textContent = 'CONFIRM BET';
            }
        }
        
        // Place bet
        function placeBet(option) {
            const size = bettingState[option].size;
            if (size === 0) return;
            
            // Add to positions
            const position = {
                option: option,
                size: size,
                price: bettingState[option].price,
                timestamp: new Date().toLocaleTimeString('en-US', {hour12: false, hour:'2-digit', minute:'2-digit'}),
                forkNumber: 7
            };
            
            myPositions.push(position);
            
            // Update contribution metrics
            contributionMetrics.episodes++;
            contributionMetrics.vectors += 4;
            
            // Update UI
            updateContributionDisplay();
            updatePositionsDisplay();
            
            // Reset slider and button
            const slider = document.getElementById(\`slider-\${option}\`);
            const btnEl = document.getElementById(\`btn-\${option}\`);
            slider.value = 0;
            bettingState[option].size = 0;
            document.getElementById(\`bet-size-\${option}\`).textContent = '$0';
            btnEl.disabled = true;
            btnEl.textContent = 'CONFIRM BET';
            
            // Visual feedback
            btnEl.classList.add('confirm');
            btnEl.textContent = 'BET PLACED';
            setTimeout(() => {
                btnEl.classList.remove('confirm');
                btnEl.textContent = 'CONFIRM BET';
            }, 1000);
        }
        
        // Update contribution display
        function updateContributionDisplay() {
            document.getElementById('contrib-episodes').textContent = contributionMetrics.episodes;
            document.getElementById('contrib-vectors').textContent = contributionMetrics.vectors;
            document.getElementById('contrib-partners').textContent = contributionMetrics.partners;
        }
        
        // Update positions display
        function updatePositionsDisplay() {
            const container = document.getElementById('positions-list');
            
            if (myPositions.length === 0) {
                container.innerHTML = '<div style="text-align:center; color:var(--text-muted); font-size:11px; padding:12px;">No active positions on Fork #7</div>';
                document.getElementById('total-exposure').textContent = '$0.00';
                return;
            }
            
            // Calculate total exposure
            const totalExposure = myPositions.reduce((sum, pos) => sum + pos.size, 0);
            document.getElementById('total-exposure').textContent = \`$\${totalExposure.toLocaleString()}\`;
            
            // Render positions
            let html = '';
            myPositions.forEach((pos) => {
                const probabilities = { A: 0.42, B: 0.38, C: 0.12 };
                const impliedValue = pos.size * pos.price;
                const expectedValue = impliedValue * probabilities[pos.option];
                const pnl = expectedValue - pos.size;
                const pnlClass = pnl >= 0 ? 'positive' : 'negative';
                const pnlSign = pnl >= 0 ? '+' : '';
                
                html += \`
                    <div class="position-item">
                        <div style="display:flex; gap:8px; align-items:center;">
                            <span class="position-option \${pos.option}">\${pos.option}</span>
                            <span class="text-muted" style="font-size:10px;">\${pos.timestamp}</span>
                        </div>
                        <div style="display:flex; gap:12px; align-items:center;">
                            <span class="mono" style="font-weight:600;">$\${pos.size.toLocaleString()}</span>
                            <span class="position-pnl \${pnlClass}">\${pnlSign}\${(pnl / 10).toFixed(0)}</span>
                        </div>
                    </div>
                \`;
            });
            
            container.innerHTML = html;
        }
        
        // State
        let currentOption = null;
        let seconds = 0;
        let forkTimer = 45;
        let stability = 87.3;
        
        // Timer
        setInterval(() => {
            seconds++;
            document.getElementById('time-elapsed').textContent = 
                new Date(seconds * 1000).toISOString().substr(14, 5);
        }, 1000);
        
        // Fork countdown
        setInterval(() => {
            forkTimer--;
            if (forkTimer <= 0) {
                forkTimer = 45;
                updateAgentDecision();
            }
            document.getElementById('fork-timer').textContent = forkTimer + 's';
        }, 1000);
        
        // Agent decision logic
        function updateAgentDecision() {
            const thoughts = document.getElementById('agent-thoughts');
            const options = ['A', 'B', 'C'];
            const selected = options[Math.floor(Math.random() * options.length)];
            
            const messages = {
                'A': '<span class="text-success">Evidence supports Option A. Stability preservation has highest expected value.</span>',
                'B': '<span class="text-warning">Option B offers highest reward but elevated risk. Taking position.</span>',
                'C': '<span class="text-info">Conservative approach warranted. Waiting for docking window.</span>'
            };
            
            thoughts.innerHTML = messages[selected];
            selectOption(selected);
        }
        
        function selectOption(option) {
            currentOption = option;
            document.querySelectorAll('.fork-option').forEach(node => {
                node.className = 'fork-option'; // reset
            });
            document.querySelector(\`[data-option="\${option}"]\`).classList.add(\`selected-\${option}\`);
        }
        
        // Interactions
        function triggerSaboteur() {
            const alert = document.getElementById('saboteur-alert');
            alert.style.display = 'flex';
            alert.classList.add('saboteur-flash');
            
            stability = Math.max(0, stability - 15);
            document.getElementById('stability').textContent = stability.toFixed(1) + '%';
            document.getElementById('stability-bar').style.width = stability + '%';
            
            document.getElementById('agent-thoughts').innerHTML = 
                '<span class="text-danger">⚠️ Sabotage detected! Re-evaluating position... Stability compromised.</span>';
            
            setTimeout(() => { 
                alert.style.display = 'none'; 
                alert.classList.remove('saboteur-flash');
            }, 2000);
        }

        function triggerParadox() {
            const thoughts = document.getElementById('agent-thoughts');
            thoughts.innerHTML = '<span class="text-danger">💥 PARADOX EVENT: Logic gap critical. Timeline unstable.</span>';
            
            const alert = document.getElementById('saboteur-alert');
            alert.style.display = 'flex';
            alert.innerHTML = \`
                <div class="alert-box">
                    <div style="font-size:32px; margin-bottom:8px;">💥</div>
                    <h3 class="text-danger" style="font-weight:700; margin-bottom:4px;">PARADOX EVENT</h3>
                    <p class="text-secondary" style="font-size:12px;">Logic gap: 64%</p>
                    <p class="mono text-muted" style="font-size:10px; margin-top:8px;">Timeline stability critical</p>
                </div>
            \`;
            setTimeout(() => { 
                alert.style.display = 'none';
                alert.innerHTML = \`
                    <div class="alert-box">
                        <div style="font-size:32px; margin-bottom:8px;">⚠️</div>
                        <h3 class="text-danger" style="font-weight:700; margin-bottom:4px;">SABOTEUR DETECTED</h3>
                        <p class="text-secondary" style="font-size:12px;">Micro-debris field approaching</p>
                        <p class="mono text-muted" style="font-size:10px; margin-top:8px;">Stability impact: -15%</p>
                    </div>
                \`;
            }, 3000);
        }
        
        function switchView(view) {
            currentView = view;
            document.querySelectorAll('.toggle-btn').forEach(btn => btn.classList.remove('active'));
            event.target.classList.add('active');
            
            const forkMarket = document.getElementById('fork-market');
            forkMarket.style.display = (view === 'robotics') ? 'none' : 'block';
        }
        
        function triggerManualDecision() { console.log('Manual override'); }
        function skipToNextFork() { forkTimer = 1; }

        // Initialize
        createStars();
    <\/script>

<script>
(function(){
  function safeClick(sel){
    const el=document.querySelector(sel);
    if(el){ el.click(); return true; }
    return false;
  }
  function clickByText(tag, text){
    const els=[...document.querySelectorAll(tag)];
    const el=els.find(e=> (e.textContent||'').trim().toLowerCase().includes(text.toLowerCase()));
    if(el){ el.click(); return true; }
    return false;
  }
  window.addEventListener('message', function(ev){
    const msg = ev.data || {};
    if(!msg || msg.__echelon_shell__ !== true) return;
    const action = msg.action;
    if(!action) return;
    try{
      switch(action){
        case 'openAlert':
          safeClick('#alertBadgeBtn') || safeClick('.alert-badge-btn') || clickByText('button','alerts');
          break;
        case 'openCompare':
          safeClick('.btn-compare') || safeClick('[onclick*="toggleCompare"]') || safeClick('.compare-open') || safeClick('.compare-btn');
          break;
        case 'openSettings':
          clickByText('button','settings') || safeClick('[data-open="settings"]');
          break;
        case 'newPosition':
          clickByText('button','new position') || safeClick('.header-btn');
          break;
        case 'refresh':
          if(typeof window.refreshDashboard === 'function'){ window.refreshDashboard(); }
          clickByText('button','refresh');
          break;
        case 'marketView':
          clickByText('button','market view') || clickByText('a','market view');
          break;
        case 'roboticsView':
          clickByText('button','robotics view') || clickByText('a','robotics view');
          break;
        case 'agentRoster':
          clickByText('button','agent roster') || clickByText('a','agent roster');
          break;
        case 'globalIntel':
          clickByText('button','global intelligence') || clickByText('a','global intelligence');
          break;
        case 'deployAgent':
          clickByText('button','deploy agent') || clickByText('button','+ deploy');
          break;
        case 'breachConsole':
          clickByText('button','breach console') || clickByText('a','breach console');
          break;
        case 'exportConsole':
          clickByText('button','export console') || clickByText('a','export console');
          break;
        default:
          break;
      }
    }catch(e){ /* ignore */ }
  });
})();
<\/script>

</body>
</html>
`,
      vrf: `<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Echelon VRF Verification Dashboard | Institutional Trust Interface</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=JetBrains+Mono:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        :root {
            /* Core Slate Palette (Echelon Standard) */
            --slate-950: #0B0C0E;
            --slate-900: #121417;
            --slate-850: #151719;
            --slate-800: #1A1D21;
            --slate-750: #26292E;
            --slate-700: #363A40;

            /* Semantic Mappings */
            --bg-app: var(--slate-950);
            --bg-panel: var(--slate-850);
            --bg-card: var(--slate-900);
            --bg-card-hover: var(--slate-800);
            --border-outer: var(--slate-750);
            --border-inner: rgba(54, 58, 64, 0.5);
            
            /* Typography */
            --text-primary: #F1F5F9;
            --text-secondary: #94A3B8;
            --text-muted: #64748B;
            --font-sans: 'Inter', system-ui, sans-serif;
            --font-mono: 'JetBrains Mono', monospace;

            /* Status Colors */
            --status-success: #4ADE80;
            --status-success-bg: rgba(74, 222, 128, 0.1);
            --status-warning: #FACC15;
            --status-warning-bg: rgba(250, 204, 21, 0.1);
            --status-danger: #FB7185;
            --status-danger-bg: rgba(251, 113, 133, 0.1);
            --status-info: #3B82F6;
            --status-info-bg: rgba(59, 130, 246, 0.1);
            
            /* VRF Specific - Mapped to Paradox/Entropy Theme */
            --status-vrf: #8B5CF6;
            --status-vrf-bg: rgba(139, 92, 246, 0.1);
            --status-entropy: #06b6d4;
            --status-entropy-bg: rgba(6, 182, 212, 0.1);

            /* Spacing */
            --radius-sm: 4px;
            --radius-md: 8px;
            --radius-lg: 12px;
            --space-sm: 8px;
            --space-md: 16px;
            --space-lg: 24px;
        }

        * { margin: 0; padding: 0; box-sizing: border-box; }

        body {
            font-family: var(--font-sans);
            background-color: var(--bg-app);
            color: var(--text-primary);
            -webkit-font-smoothing: antialiased;
            min-height: 100vh;
            font-size: 13px;
            line-height: 1.5;
        }

        /* Scrollbar */
        ::-webkit-scrollbar { width: 6px; height: 6px; }
        ::-webkit-scrollbar-track { background: var(--bg-app); }
        ::-webkit-scrollbar-thumb { background: var(--border-outer); border-radius: 3px; }
        ::-webkit-scrollbar-thumb:hover { background: var(--slate-700); }

        /* --- UTILITIES --- */
        .mono { font-family: var(--font-mono); }
        .text-muted { color: var(--text-muted); }
        .text-secondary { color: var(--text-secondary); }
        .positive { color: var(--status-success); }
        .negative { color: var(--status-danger); }
        .warning { color: var(--status-warning); }
        .info { color: var(--status-info); }
        .vrf-text { color: var(--status-vrf); }

        /* --- NAVIGATION (Matches Market Page) --- */
        .top-nav {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 0 24px;
            height: 60px;
            background: var(--bg-panel);
            border-bottom: 1px solid var(--border-outer);
            position: sticky;
            top: 0;
            z-index: 100;
        }

        .logo {
            font-size: 18px;
            font-weight: 700;
            letter-spacing: 0.1em;
            color: var(--text-primary);
            display: flex;
            align-items: center;
            gap: 12px;
        }
        .logo::after {
            content: "VERIFICATION";
            font-size: 10px;
            background: var(--bg-card);
            border: 1px solid var(--border-outer);
            padding: 2px 6px;
            border-radius: 4px;
            color: var(--text-muted);
            font-weight: 500;
        }

        .nav-controls { display: flex; align-items: center; gap: 16px; }

        .network-badge {
            display: flex;
            align-items: center;
            gap: 6px;
            padding: 6px 12px;
            background: var(--bg-card);
            border: 1px solid var(--border-outer);
            border-radius: var(--radius-md);
            font-size: 11px;
            font-family: var(--font-mono);
            color: var(--text-secondary);
        }
        .network-badge .dot {
            width: 6px;
            height: 6px;
            background: var(--status-success);
            border-radius: 50%;
            box-shadow: 0 0 6px rgba(74, 222, 128, 0.4);
        }

        .live-indicator {
            display: flex;
            align-items: center;
            gap: 6px;
            padding: 6px 12px;
            background: var(--status-success-bg);
            border: 1px solid var(--status-success-border);
            border-radius: var(--radius-md);
            font-size: 11px;
            font-weight: 600;
            color: var(--status-success);
        }
        .live-indicator .dot {
            width: 6px;
            height: 6px;
            background: var(--status-success);
            border-radius: 50%;
            animation: pulse 2s infinite;
        }

        @keyframes pulse { 0% { opacity: 1; } 50% { opacity: 0.5; } 100% { opacity: 1; } }

        .refresh-btn {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 8px 16px;
            font-size: 12px;
            font-weight: 600;
            background: var(--status-vrf-bg);
            border: 1px solid rgba(139, 92, 246, 0.3);
            border-radius: var(--radius-md);
            color: var(--status-vrf);
            cursor: pointer;
            transition: all 0.2s;
        }
        .refresh-btn:hover { background: rgba(139, 92, 246, 0.2); transform: translateY(-1px); }

        /* --- MAIN LAYOUT --- */
        .main-container {
            max-width: 1600px;
            margin: 0 auto;
            padding: 24px;
            display: flex;
            flex-direction: column;
            gap: 24px;
        }

        /* --- STATS GRID --- */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(240px, 1fr));
            gap: 16px;
        }

        .stat-card {
            background: var(--bg-panel);
            border: 1px solid var(--border-outer);
            border-radius: var(--radius-lg);
            padding: 20px;
            transition: all 0.2s ease;
        }
        .stat-card:hover {
            border-color: var(--text-muted);
            transform: translateY(-2px);
        }

        .stat-label { font-size: 10px; color: var(--text-muted); text-transform: uppercase; letter-spacing: 0.05em; font-weight: 600; margin-bottom: 8px; }
        .stat-value { font-family: var(--font-mono); font-size: 24px; font-weight: 600; color: var(--text-primary); letter-spacing: -0.02em; }
        .stat-sub { font-size: 11px; color: var(--text-muted); margin-top: 4px; }
        .stat-change { font-size: 11px; margin-top: 8px; display: flex; align-items: center; gap: 4px; font-weight: 500; }
        
        /* --- SECTIONS --- */
        .section-header { display: flex; align-items: center; justify-content: space-between; margin-bottom: 16px; }
        .section-title { 
            font-size: 13px; font-weight: 600; color: var(--text-primary); 
            text-transform: uppercase; letter-spacing: 0.05em; 
            display: flex; align-items: center; gap: 8px;
        }
        .section-icon { color: var(--status-vrf); width: 16px; height: 16px; }
        
        .capsule-badge {
            font-size: 10px; font-weight: 700; padding: 2px 8px; border-radius: 4px;
            text-transform: uppercase; letter-spacing: 0.05em;
            background: var(--bg-card); border: 1px solid var(--border-outer); color: var(--text-secondary);
        }
        .capsule-badge.vrf { background: var(--status-vrf-bg); border-color: var(--status-vrf); color: var(--status-vrf); }

        /* --- VRF LIVE GRID --- */
        .vrf-live-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 16px; }
        @media (max-width: 1024px) { .vrf-live-grid { grid-template-columns: 1fr; } }

        .panel {
            background: var(--bg-panel);
            border: 1px solid var(--border-outer);
            border-radius: var(--radius-lg);
            overflow: hidden;
        }
        .panel-header {
            padding: 12px 20px;
            background: rgba(26, 29, 33, 0.5); /* Glass feel */
            border-bottom: 1px solid var(--border-outer);
            display: flex; justify-content: space-between; align-items: center;
}
        .panel-title { font-size: 12px; font-weight: 600; color: var(--text-secondary); }
        .panel-body { padding: 20px; }

        /* Hash Display (Terminal Style) */
        .hash-display {
            font-family: var(--font-mono); font-size: 11px;
            background: var(--bg-app); border: 1px solid var(--border-outer);
            border-radius: var(--radius-md); padding: 16px; margin-bottom: 16px;
            position: relative;
        }
        .hash-val { color: var(--status-vrf); word-break: break-all; line-height: 1.6; }
        .hash-meta {
            display: flex; gap: 16px; margin-top: 12px; padding-top: 12px;
            border-top: 1px dashed var(--border-outer); color: var(--text-muted); font-size: 10px;
        }

        /* Verification Steps (Ribbon Style) */
        .verify-steps { display: flex; flex-direction: column; gap: 8px; }
        .step-item {
            display: flex; align-items: center; gap: 12px;
            padding: 10px 12px; background: var(--bg-card);
            border: 1px solid var(--border-outer); border-radius: var(--radius-md);
            transition: all 0.15s;
        }
        .step-item:hover { background: var(--bg-card-hover); border-color: var(--border-inner); }
        
        .step-icon { 
            width: 20px; height: 20px; border-radius: 50%; 
            display: flex; align-items: center; justify-content: center; font-size: 10px; 
        }
        .step-icon.success { background: var(--status-success-bg); color: var(--status-success); }
        .step-icon.info { background: var(--status-info-bg); color: var(--status-info); }
        
        .step-text h4 { font-size: 12px; font-weight: 500; color: var(--text-primary); }
        .step-text p { font-size: 10px; color: var(--text-muted); }

        /* Circuit Breakers (Market Outcome Style) */
        .breaker-grid { display: grid; grid-template-columns: repeat(2, 1fr); gap: 12px; }
        .breaker-item {
            background: var(--bg-card); border: 1px solid var(--border-outer);
            border-radius: var(--radius-md); padding: 12px;
            transition: all 0.2s; position: relative; overflow: hidden;
        }
        .breaker-item.secure { border-color: rgba(74, 222, 128, 0.3); }
        .breaker-item.secure::before {
            content: ''; position: absolute; left: 0; top: 0; bottom: 0; width: 3px; background: var(--status-success);
        }
        
        .breaker-label { font-size: 10px; color: var(--text-muted); text-transform: uppercase; letter-spacing: 0.05em; margin-bottom: 6px; }
        .breaker-val { font-family: var(--font-mono); font-size: 16px; font-weight: 600; color: var(--text-primary); }
        .breaker-vrf { font-size: 10px; color: var(--status-vrf); margin-top: 4px; font-family: var(--font-mono); }

        /* Chainlink Integration */
        .cl-panel {
            display: flex; align-items: center; justify-content: space-between;
            margin-top: 16px; padding: 12px 16px;
            background: var(--bg-card); border: 1px solid var(--border-outer); border-radius: var(--radius-md);
        }
        .cl-info { display: flex; align-items: center; gap: 12px; }
        .cl-logo {
            width: 28px; height: 28px; background: #375bd2; color: white;
            border-radius: 6px; display: flex; align-items: center; justify-content: center;
            font-weight: 700; font-size: 10px;
        }
        .cl-metrics { display: flex; gap: 24px; }
        .cl-metric { text-align: right; }
        .cl-metric-val { font-family: var(--font-mono); font-size: 13px; font-weight: 600; }
        .cl-metric-label { font-size: 9px; color: var(--text-muted); }

        /* Data Validation (Stability Gauge Style) */
        .validation-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(180px, 1fr)); gap: 12px; }
        .val-card {
            background: var(--bg-card); border: 1px solid var(--border-outer);
            border-radius: var(--radius-md); padding: 16px; text-align: center;
        }
        .val-icon { color: var(--text-secondary); font-size: 16px; margin-bottom: 8px; }
        .val-name { font-size: 12px; font-weight: 600; margin-bottom: 8px; }
        
        .val-gauge { height: 4px; background: var(--bg-app); border-radius: 2px; overflow: hidden; margin: 12px 0 6px; }
        .val-fill { height: 100%; background: var(--status-success); border-radius: 2px; }
        .val-score { font-size: 10px; font-family: var(--font-mono); color: var(--text-muted); }
        
        .vrf-tag { font-size: 9px; color: var(--status-vrf); background: var(--status-vrf-bg); padding: 2px 6px; border-radius: 4px; display: inline-block; }

        /* RLMF Section */
        .rlmf-box {
            background: linear-gradient(135deg, rgba(139, 92, 246, 0.03) 0%, rgba(6, 182, 212, 0.03) 100%);
            border: 1px solid rgba(139, 92, 246, 0.2);
            border-radius: var(--radius-lg); padding: 20px;
        }
        .rlmf-stats { display: grid; grid-template-columns: repeat(4, 1fr); gap: 16px; margin-top: 16px; }
        @media (max-width: 768px) { .rlmf-stats { grid-template-columns: 1fr 1fr; } }
        
        .rlmf-stat { background: var(--bg-card); border: 1px solid var(--border-outer); padding: 12px; border-radius: var(--radius-md); text-align: center; }
        .rlmf-val { font-family: var(--font-mono); font-size: 18px; font-weight: 600; color: var(--status-vrf); }
        .stat-sub { font-size: 11px; color: var(--text-muted); margin-top: 4px; }

        /* Tables (History) */
        .history-table { width: 100%; border-collapse: collapse; font-size: 12px; }
        .history-table th {
            text-align: left; padding: 10px 16px;
            color: var(--text-muted); font-weight: 600; font-size: 10px;
            text-transform: uppercase; border-bottom: 1px solid var(--border-outer);
            background: var(--bg-card);
        }
        .history-table td { padding: 10px 16px; border-bottom: 1px solid var(--border-inner); color: var(--text-secondary); }
        .history-table tr:hover td { background: var(--bg-card-hover); }
        
        .status-pill { display: inline-flex; align-items: center; gap: 6px; font-size: 11px; }
        .status-dot { width: 6px; height: 6px; border-radius: 50%; }
        .status-dot.verified { background: var(--status-success); box-shadow: 0 0 4px rgba(74, 222, 128, 0.4); }
        .status-dot.pending { background: var(--status-warning); }
        .status-dot.failed { background: var(--status-danger); }

        /* Audit Trail (Feed Style) */
        .audit-list { max-height: 280px; overflow-y: auto; }
        .audit-row {
            display: flex; gap: 12px; padding: 10px 16px;
            border-bottom: 1px solid var(--border-inner);
            font-size: 11px; transition: background 0.15s;
        }
        .audit-row:hover { background: var(--bg-card-hover); }
        .audit-time { font-family: var(--font-mono); color: var(--text-muted); min-width: 80px; }
        .audit-type { font-weight: 600; margin-bottom: 2px; }

        /* Footer */
        .footer {
            padding: 24px 0; border-top: 1px solid var(--border-outer);
            display: flex; justify-content: space-between; color: var(--text-muted); font-size: 11px;
        }
        .footer-links a { color: var(--text-secondary); margin-left: 20px; text-decoration: none; }
        .footer-links a:hover { color: var(--text-primary); }

        /* Animation */
        @keyframes fadeIn { from { opacity: 0; transform: translateY(5px); } to { opacity: 1; transform: translateY(0); } }
        .panel, .stat-card { animation: fadeIn 0.4s ease; }
    </style>
<style id="__shell_hide__">
.top-nav{display:none!important;}
.connection-status,.system-clock,.clock,#clock,.live-indicator,.network-badge{display:none!important;}
html,body{height:100%;} body{overflow:auto;}

/* __table_fix__ */
.leaderboard-table{width:100%!important;border-collapse:collapse!important;table-layout:fixed!important;}
.leaderboard-table thead th{padding:10px 16px!important;text-align:left!important;font-size:10px!important;letter-spacing:.08em!important;text-transform:uppercase!important;color:var(--text-muted)!important;font-weight:700!important;border-bottom:1px solid var(--border-outer)!important;background:var(--bg-card)!important;position:sticky!important;top:0!important;z-index:2!important;}
.leaderboard-table tbody td{padding:10px 16px!important;border-bottom:1px solid var(--border-inner)!important;vertical-align:middle!important;font-size:11px!important;color:var(--text-secondary)!important;}
.leaderboard-table th.numeric,.leaderboard-table td.numeric{text-align:right!important;}
.leaderboard-table th:first-child,.leaderboard-table td:first-child{width:30px!important;padding-left:16px!important;}

</style>
</head>
<body>

    <nav class="top-nav">
        <div class="logo">ECHELON</div>
        <div class="nav-controls">
            <div class="live-indicator">
                <span class="dot"></span>
                LIVE
            </div>
            <div class="network-badge">
                <span class="dot"></span>
                Base Mainnet
            </div>
            <button class="refresh-btn" onclick="refreshDashboard()">
                <svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round">
                    <path d="M23 4v6h-6"></path>
                    <path d="M1 20v-6h6"></path>
                    <path d="M3.51 9a9 9 0 0 1 14.85-3.36L23 10M1 14l4.64 4.36A9 9 0 0 0 20.49 15"></path>
                </svg>
                Refresh Data
            </button>
        </div>
    </nav>

    <div class="main-container">
        
        <div class="stats-grid">
            <div class="stat-card">
                <div class="stat-label">Total VRF Requests</div>
                <div class="stat-value">47,892</div>
                <div class="stat-sub">Since network launch</div>
                <div class="stat-change positive">↑ 12.4% this week</div>
            </div>
            <div class="stat-card">
                <div class="stat-label">Verification Rate</div>
                <div class="stat-value positive">99.97%</div>
                <div class="stat-sub">On-chain success</div>
                <div class="stat-change positive">↑ 0.02% from last month</div>
            </div>
            <div class="stat-card">
                <div class="stat-label">Avg Response Time</div>
                <div class="stat-value">2.3s</div>
                <div class="stat-sub">Block to fulfillment</div>
                <div class="stat-change positive">↓ 0.4s improvement</div>
            </div>
            <div class="stat-card">
                <div class="stat-label">Entropy Quality</div>
                <div class="stat-value" style="color: var(--status-entropy);">9.8/10</div>
                <div class="stat-sub">NIST randomness score</div>
                <div class="stat-change text-secondary">Stable</div>
            </div>
        </div>

        <div class="section-header">
            <div class="section-title">
                <svg class="section-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 10V3L4 14h7v7l9-11h-7z"/></svg>
                Current Randomness State
            </div>
            <span class="capsule-badge vrf">CHAINLINK VRF V2</span>
        </div>

        <div class="vrf-live-grid">
            <div class="panel">
                <div class="panel-header">
                    <span class="panel-title">LATEST REQUEST #47,893</span>
                </div>
                <div class="panel-body">
                    <div class="hash-display">
                        <div class="hash-val mono" id="currentHash">0x8f7b2d3e1c4a9f0e6d5c8b1a4f7e3d2c9b8a7f6e5d4c3b2a1f0e9d8c7b6a5f4</div>
                        <div class="hash-meta mono">
                            <span>ID: 0x8f7b...a5f4</span>
                            <span>BLK: #2,847,392</span>
                            <span>TS: 14:32:18 UTC</span>
                        </div>
                    </div>
                    <div class="verify-steps">
                        <div class="step-item">
                            <div class="step-icon success">✓</div>
                            <div class="step-text">
                                <h4>Block Hash Verification</h4>
                                <p>Parent block hash cryptographically verified</p>
                            </div>
                        </div>
                        <div class="step-item">
                            <div class="step-icon success">✓</div>
                            <div class="step-text">
                                <h4>Proof Validation</h4>
                                <p>VRF proof successfully validated on-chain</p>
                            </div>
                        </div>
                        <div class="step-item">
                            <div class="step-icon success">✓</div>
                            <div class="step-text">
                                <h4>Output Range Check</h4>
                                <p>Random output within valid range [0, 2^256-1]</p>
                            </div>
                        </div>
                        <div class="step-item">
                            <div class="step-icon info">⟳</div>
                            <div class="step-text">
                                <h4>Execution Window</h4>
                                <p>30-60s window starting in 18s</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="panel">
                <div class="panel-header">
                    <span class="panel-title">VRF-ENHANCED CIRCUIT BREAKERS</span>
                </div>
                <div class="panel-body">
                    <div class="breaker-grid">
                        <div class="breaker-item secure">
                            <div class="breaker-label">Stability Delta</div>
                            <div class="breaker-val">10.0% <span class="vrf-text mono text-secondary" style="font-size:12px;">+VRF</span></div>
                            <div class="breaker-vrf">Randomized: +2.3%</div>
                        </div>
                        <div class="breaker-item secure">
                            <div class="breaker-label">Paradox Threshold</div>
                            <div class="breaker-val">40.0% <span class="vrf-text mono text-secondary" style="font-size:12px;">+VRF</span></div>
                            <div class="breaker-vrf">Randomized: +6.7%</div>
                        </div>
                        <div class="breaker-item secure">
                            <div class="breaker-label">Max Scaling</div>
                            <div class="breaker-val">2.5x <span class="vrf-text mono text-secondary" style="font-size:12px;">+VRF</span></div>
                            <div class="breaker-vrf">Randomized: +0.4x</div>
                        </div>
                        <div class="breaker-item secure">
                            <div class="breaker-label">Sabotage Cool</div>
                            <div class="breaker-val">300s <span class="vrf-text mono text-secondary" style="font-size:12px;">+VRF</span></div>
                            <div class="breaker-vrf">Randomized: +42s</div>
                        </div>
                    </div>

                    <div class="cl-panel">
                        <div class="cl-info">
                            <div class="cl-logo">CL</div>
                            <div class="step-text">
                                <h4>Chainlink VRF Coordinator</h4>
                                <p>0xf0d...4e21 - Base Mainnet</p>
                            </div>
                        </div>
                        <div class="cl-metrics">
                            <div class="cl-metric">
                                <div class="cl-metric-val positive">99.99%</div>
                                <div class="cl-metric-label">UPTIME</div>
                            </div>
                            <div class="cl-metric">
                                <div class="cl-metric-val">12,847</div>
                                <div class="cl-metric-label">GAS AVG</div>
                            </div>
                            <div class="cl-metric">
                                <div class="cl-metric-val">V2</div>
                                <div class="cl-metric-label">VER</div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div class="section-header">
            <div class="section-title">
                <svg class="section-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"/></svg>
                VRF-Backed Market Data Validation
            </div>
        </div>
        <div class="panel">
            <div class="panel-body">
                <p class="text-secondary" style="font-size: 12px; margin-bottom: 20px;">
                    VRF-randomized data validation sampling prevents predictable manipulation patterns. Each feed is validated using VRF-selected checkpoints.
                </p>
                <div class="validation-grid">
                    <div class="val-card">
                        <div class="val-name">Market Data</div>
                        <span class="vrf-tag"><> VRF Secured</span>
                        <div class="val-gauge"><div class="val-fill" style="width: 98%;"></div></div>
                        <div class="val-score">98.2% confidence</div>
                    </div>
                    <div class="val-card">
                        <div class="val-name">On-Chain</div>
                        <span class="vrf-tag"><> VRF Secured</span>
                        <div class="val-gauge"><div class="val-fill" style="width: 99%;"></div></div>
                        <div class="val-score">99.1% confidence</div>
                    </div>
                    <div class="val-card">
                        <div class="val-name">News/Sentiment</div>
                        <span class="vrf-tag"><> VRF Secured</span>
                        <div class="val-gauge"><div class="val-fill warning" style="width: 94%;"></div></div>
                        <div class="val-score">94.7% confidence</div>
                    </div>
                    <div class="val-card">
                        <div class="val-name">Browser Auto</div>
                        <span class="vrf-tag"><> VRF Secured</span>
                        <div class="val-gauge"><div class="val-fill warning" style="width: 91%;"></div></div>
                        <div class="val-score">91.3% confidence</div>
                    </div>
                    <div class="val-card">
                        <div class="val-name">Maritime (AIS)</div>
                        <span class="vrf-tag"><> VRF Secured</span>
                        <div class="val-gauge"><div class="val-fill" style="width: 96%;"></div></div>
                        <div class="val-score">96.5% confidence</div>
                    </div>
                    <div class="val-card">
                        <div class="val-name">Aviation (ADS-B)</div>
                        <span class="vrf-tag"><> VRF Secured</span>
                        <div class="val-gauge"><div class="val-fill" style="width: 95%;"></div></div>
                        <div class="val-score">95.8% confidence</div>
                    </div>
                </div>
            </div>
        </div>

        <div class="rlmf-box">
            <div class="section-header" style="margin-bottom:0;">
                <h3 style="font-size:13px; font-weight:600; color:var(--text-primary);">RLMF Validation Framework</h3>
                <span class="mono text-muted" style="font-size:10px;">Last updated: 14:32:22 UTC</span>
            </div>
            <div class="rlmf-stats">
                <div class="rlmf-stat">
                    <div class="stat-label">Total Episodes</div>
                    <div class="rlmf-val">12,847</div>
                    <div class="stat-sub">Fork decisions analyzed</div>
                </div>
                <div class="rlmf-stat">
                    <div class="stat-label">VRF-Sampled</div>
                    <div class="rlmf-val">1,285</div>
                    <div class="stat-sub">10% random checkpoint</div>
                </div>
                <div class="rlmf-stat">
                    <div class="stat-label">Calibration</div>
                    <div class="rlmf-val">0.18</div>
                    <div class="stat-sub">Brier Score (target: <0.20)</div>
                </div>
                <div class="rlmf-stat">
                    <div class="stat-label">Integrity</div>
                    <div class="rlmf-val positive">100%</div>
                    <div class="stat-sub">All exports verified</div>
                </div>
            </div>
        </div>

        <div class="vrf-live-grid">
            <div class="panel">
                <div class="panel-header">
                    <span class="panel-title">RECENT VRF REQUESTS</span>
                    <button style="padding:4px 8px; background:var(--bg-card); border:1px solid var(--border-outer); border-radius:4px; color:var(--text-secondary); font-size:10px; cursor:pointer;">VIEW ALL →</button>
                </div>
                <div class="panel-body" style="padding:0;">
                    <table class="history-table">
                        <thead>
                            <tr>
                                <th>Request ID</th>
                                <th>Block</th>
                                <th>Type</th>
                                <th>Status</th>
                                <th style="text-align:right;">Time</th>
                            </tr>
                        </thead>
                        <tbody id="historyBody">
                            <tr>
                                <td class="mono vrf-text">0x8f7b...a5f4</td>
                                <td class="mono text-muted">#2,847,392</td>
                                <td>Sabotage Exec</td>
                                <td><div class="status-pill"><span class="status-dot verified"></span> Verified</div></td>
                                <td class="mono" style="text-align:right;">14:32:18</td>
                            </tr>
                            <tr>
                                <td class="mono vrf-text">0x7e6a...93e3</td>
                                <td class="mono text-muted">#2,847,385</td>
                                <td>Episode Samp</td>
                                <td><div class="status-pill"><span class="status-dot verified"></span> Verified</div></td>
                                <td class="mono" style="text-align:right;">14:30:45</td>
                            </tr>
                            <tr>
                                <td class="mono vrf-text">0x6d59...82d2</td>
                                <td class="mono text-muted">#2,847,378</td>
                                <td>Circuit Breaker</td>
                                <td><div class="status-pill"><span class="status-dot verified"></span> Verified</div></td>
                                <td class="mono" style="text-align:right;">14:29:12</td>
                            </tr>
                            <tr>
                                <td class="mono vrf-text">0x5c48...71c1</td>
                                <td class="mono text-muted">#2,847,371</td>
                                <td>Data Valid</td>
                                <td><div class="status-pill"><span class="status-dot verified"></span> Verified</div></td>
                                <td class="mono" style="text-align:right;">14:27:38</td>
                            </tr>
                            <tr>
                                <td class="mono vrf-text">0x4b37...60b0</td>
                                <td class="mono text-muted">#2,847,364</td>
                                <td>Sabotage Exec</td>
                                <td><div class="status-pill"><span class="status-dot verified"></span> Verified</div></td>
                                <td class="mono" style="text-align:right;">14:26:05</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>

            <div class="panel">
                <div class="panel-header">
                    <span class="panel-title">LIVE AUDIT TRAIL</span>
                </div>
                <div class="panel-body" style="padding:0;">
                    <div class="audit-list" id="auditTrail">
                        <div class="audit-row">
                            <div class="audit-time">14:32:22</div>
                            <div class="audit-detail">
                                <div class="audit-type positive">VRF Request Fulfilled</div>
                                <div class="text-secondary">Request ID 0x8f7b...a5f4 fulfilled with proof 0x3a8f...2d4c</div>
                            </div>
                        </div>
                        <div class="audit-row">
                            <div class="audit-time">14:32:20</div>
                            <div class="audit-detail">
                                <div class="audit-type info">Circuit Breaker Updated</div>
                                <div class="text-secondary">Stability delta threshold set to 12.3% (VRF +2.3%)</div>
                            </div>
                        </div>
                        <div class="audit-row">
                            <div class="audit-time">14:32:18</div>
                            <div class="audit-detail">
                                <div class="audit-type warning">VRF Request Initiated</div>
                                <div class="text-secondary">New request sent to Chainlink VRF Coordinator</div>
                            </div>
                        </div>
                        <div class="audit-row">
                            <div class="audit-time">14:32:15</div>
                            <div class="audit-detail">
                                <div class="audit-type positive">Data Validation Complete</div>
                                <div class="text-secondary">Market data feed validated (VRF checkpoint #1,247)</div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

    </div>

    <footer class="footer">
        <div style="margin: 0 auto; max-width: 1600px; padding: 0 24px; display: flex; justify-content: space-between; width: 100%;">
            <div>Echelon Protocol VRF Dashboard - Base Mainnet</div>
            <div class="footer-links">
                <a href="#">Documentation</a>
                <a href="#">Audit Reports</a>
                <a href="#">Smart Contracts</a>
            </div>
        </div>
    </footer>

    <script>
        // VRF Dashboard Simulation Logic (Preserved)
        const VRF_USAGE_TYPES = [
            'Sabotage Exec',
            'Episode Samp',
            'Circuit Breaker',
            'Data Valid',
            'Entropy Pricing',
            'Fork Selection'
        ];

        const STATUS_WEIGHTS = [0.97, 0.02, 0.01];

        function generateHash() {
            const chars = '0123456789abcdef';
            let hash = '0x';
            for (let i = 0; i < 64; i++) {
                hash += chars[Math.floor(Math.random() * chars.length)];
            }
            return hash;
        }

        function generateRequest() {
            const hash = generateHash();
            const usageType = VRF_USAGE_TYPES[Math.floor(Math.random() * VRF_USAGE_TYPES.length)];
            const statusRoll = Math.random();
            let status = 'verified';
            if (statusRoll > STATUS_WEIGHTS[0] + STATUS_WEIGHTS[1]) {
                status = 'failed';
            } else if (statusRoll > STATUS_WEIGHTS[0]) {
                status = 'pending';
            }
            return { hash, usageType, status };
        }

        function addAuditEntry() {
            const auditTrail = document.getElementById('auditTrail');
            const events = [
                { type: 'VRF Request Fulfilled', color: 'positive', detail: 'Request fulfilled with proof verification' },
                { type: 'Block Hash Confirmed', color: 'info', detail: 'Parent block hash finalized on-chain' },
                { type: 'Data Validation', color: 'positive', detail: 'Feed validated at VRF checkpoint' },
                { type: 'Circuit Breaker Updated', color: 'info', detail: 'Threshold randomized via VRF' },
                { type: 'Entropy Calculation', color: 'warning', detail: 'Dynamic pricing updated' }
            ];
            const event = events[Math.floor(Math.random() * events.length)];
            const time = new Date().toISOString().split('T')[1].slice(0, 8);
            
            const entry = document.createElement('div');
            entry.className = 'audit-row';
            entry.innerHTML = \`
                <div class="audit-time">\${time}</div>
                <div class="audit-detail">
                    <div class="audit-type \${event.color}">\${event.type}</div>
                    <div class="text-secondary">\${event.detail}</div>
                </div>
            \`;
            
            auditTrail.prepend(entry);
            if (auditTrail.children.length > 10) {
                auditTrail.lastElementChild.remove();
            }
        }

        function updateHistory() {
            const tbody = document.getElementById('historyBody');
            const request = generateRequest();
            const shortHash = request.hash.substring(0, 6) + '...' + request.hash.substring(58);
            const blockNum = 2847000 + Math.floor(Math.random() * 500);
            const time = new Date().toISOString().split('T')[1].slice(0, 8);
            
            const row = document.createElement('tr');
            row.innerHTML = \`
                <td class="mono vrf-text">\${shortHash}</td>
                <td class="mono text-muted">#\${blockNum}</td>
                <td>\${request.usageType}</td>
                <td><div class="status-pill"><span class="status-dot \${request.status}"></span> \${request.status.charAt(0).toUpperCase() + request.status.slice(1)}</div></td>
                <td class="mono" style="text-align:right;">\${time}</td>
            \`;
            
            tbody.prepend(row);
            if (tbody.children.length > 10) {
                tbody.lastElementChild.remove();
            }
        }

        function refreshDashboard() {
            document.getElementById('currentHash').textContent = generateHash();
            addAuditEntry();
            updateHistory();
        }

        // Loops
        setInterval(addAuditEntry, 3000);
        setInterval(updateHistory, 10000);

        console.log('VRF Verification Dashboard V2 Initialized');
    <\/script>

<script>
(function(){
  function safeClick(sel){
    const el=document.querySelector(sel);
    if(el){ el.click(); return true; }
    return false;
  }
  function clickByText(tag, text){
    const els=[...document.querySelectorAll(tag)];
    const el=els.find(e=> (e.textContent||'').trim().toLowerCase().includes(text.toLowerCase()));
    if(el){ el.click(); return true; }
    return false;
  }
  window.addEventListener('message', function(ev){
    const msg = ev.data || {};
    if(!msg || msg.__echelon_shell__ !== true) return;
    const action = msg.action;
    if(!action) return;
    try{
      switch(action){
        case 'openAlert':
          safeClick('#alertBadgeBtn') || safeClick('.alert-badge-btn') || clickByText('button','alerts');
          break;
        case 'openCompare':
          safeClick('.btn-compare') || safeClick('[onclick*="toggleCompare"]') || safeClick('.compare-open') || safeClick('.compare-btn');
          break;
        case 'openSettings':
          clickByText('button','settings') || safeClick('[data-open="settings"]');
          break;
        case 'newPosition':
          clickByText('button','new position') || safeClick('.header-btn');
          break;
        case 'refresh':
          if(typeof window.refreshDashboard === 'function'){ window.refreshDashboard(); }
          clickByText('button','refresh');
          break;
        case 'marketView':
          clickByText('button','market view') || clickByText('a','market view');
          break;
        case 'roboticsView':
          clickByText('button','robotics view') || clickByText('a','robotics view');
          break;
        case 'agentRoster':
          clickByText('button','agent roster') || clickByText('a','agent roster');
          break;
        case 'globalIntel':
          clickByText('button','global intelligence') || clickByText('a','global intelligence');
          break;
        case 'deployAgent':
          clickByText('button','deploy agent') || clickByText('button','+ deploy');
          break;
        case 'breachConsole':
          clickByText('button','breach console') || clickByText('a','breach console');
          break;
        case 'exportConsole':
          clickByText('button','export console') || clickByText('a','export console');
          break;
        default:
          break;
      }
    }catch(e){ /* ignore */ }
  });
})();
<\/script>

</body>
</html>
`,
      agents: `<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Echelon — Agent Intelligence</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=JetBrains+Mono:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/remixicon@4.2.0/fonts/remixicon.css" rel="stylesheet">
    <style>
        :root {
            --slate-950: #0B0C0E;
            --slate-900: #121417;
            --slate-850: #151719;
            --slate-800: #1A1D21;
            --slate-750: #26292E;
            --slate-700: #363A40;

            --bg-app: var(--slate-950);
            --bg-panel: var(--slate-850);
            --bg-card: var(--slate-900);
            --bg-card-hover: var(--slate-800);
            --border-outer: var(--slate-750);
            --border-inner: rgba(54, 58, 64, 0.5);
            
            --text-primary: #F1F5F9;
            --text-secondary: #94A3B8;
            --text-muted: #64748B;
            --font-sans: 'Inter', system-ui, sans-serif;
            --font-mono: 'JetBrains Mono', monospace;

            --status-success: #4ADE80;
            --status-success-bg: rgba(74, 222, 128, 0.1);
            --status-success-border: rgba(74, 222, 128, 0.2);
            
            --status-warning: #FACC15;
            --status-warning-bg: rgba(250, 204, 21, 0.1);
            --status-warning-border: rgba(250, 204, 21, 0.2);
            
            --status-danger: #FB7185;
            --status-danger-bg: rgba(251, 113, 133, 0.1);
            --status-danger-border: rgba(251, 113, 133, 0.2);
            
            --status-info: #3B82F6;
            --status-info-bg: rgba(59, 130, 246, 0.1);
            
            --status-paradox: #8B5CF6;
            --status-paradox-bg: rgba(139, 92, 246, 0.1);

            --echelon-cyan: #22D3EE;
            --echelon-cyan-bg: rgba(34, 211, 238, 0.1);
            --echelon-cyan-border: rgba(34, 211, 238, 0.3);
            
            --echelon-purple: #A855F7;
            --echelon-purple-bg: rgba(168, 85, 247, 0.1);
            --echelon-purple-border: rgba(168, 85, 247, 0.3);
            
            --echelon-amber: #F59E0B;
            --echelon-amber-bg: rgba(245, 158, 11, 0.1);
            --echelon-amber-border: rgba(245, 158, 11, 0.3);
            
            --echelon-red: #EF4444;
            --echelon-red-bg: rgba(239, 68, 68, 0.1);
            --echelon-red-border: rgba(239, 68, 68, 0.3);

            --space-xs: 4px;
            --space-sm: 8px;
            --space-md: 12px;
            --space-lg: 16px;
            --space-xl: 24px;
            --space-2xl: 32px;
            --radius-sm: 6px;
            --radius-md: 8px;
            --radius-lg: 12px;
        }

        * { margin: 0; padding: 0; box-sizing: border-box; }

        body {
            font-family: var(--font-sans);
            background: var(--bg-app);
            color: var(--text-primary);
            font-size: 13px;
            line-height: 1.5;
            -webkit-font-smoothing: antialiased;
        }

        .mono { font-family: var(--font-mono); }
        .flex { display: flex; }
        .flex-col { flex-direction: column; }
        .items-center { align-items: center; }
        .justify-between { justify-content: space-between; }
        .justify-center { justify-content: center; }
        .gap-1 { gap: 4px; }
        .gap-2 { gap: 8px; }
        .gap-3 { gap: 12px; }
        .gap-4 { gap: 16px; }
        .gap-6 { gap: 24px; }
        
        /* Layout */
        .app-layout { display: flex; min-height: 100vh; }
        
        /* Sidebar */
        .sidebar {
            width: 220px;
            background: var(--bg-panel);
            border-right: 1px solid var(--border-outer);
            display: flex;
            flex-direction: column;
            flex-shrink: 0;
        }
        
        .sidebar-header {
            height: 64px;
            display: flex;
            align-items: center;
            padding: 0 var(--space-lg);
            border-bottom: 1px solid var(--border-outer);
        }
        
        .sidebar-logo {
            display: flex;
            align-items: center;
            gap: var(--space-md);
            font-size: 14px;
            font-weight: 700;
            letter-spacing: 0.1em;
            color: var(--text-primary);
        }
        
        .sidebar-logo-icon {
            width: 28px;
            height: 28px;
            background: linear-gradient(135deg, var(--status-info), var(--status-paradox));
            border-radius: var(--radius-sm);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 16px;
        }
        
        .sidebar-nav {
            flex: 1;
            padding: var(--space-md);
            overflow-y: auto;
        }
        
        .nav-section {
            margin-bottom: var(--space-lg);
        }
        
        .nav-section-title {
            font-size: 10px;
            font-weight: 600;
            color: var(--text-muted);
            text-transform: uppercase;
            letter-spacing: 0.05em;
            padding: var(--space-sm) var(--space-md);
            margin-bottom: var(--space-xs);
        }
        
        .nav-item {
            display: flex;
            align-items: center;
            gap: var(--space-md);
            padding: var(--space-sm) var(--space-md);
            border-radius: var(--radius-sm);
            color: var(--text-secondary);
            font-size: 13px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s;
        }
        
        .nav-item:hover {
            background: var(--bg-card-hover);
            color: var(--text-primary);
        }
        
        .nav-item.active {
            background: var(--echelon-cyan-bg);
            color: var(--echelon-cyan);
        }
        
        .nav-item i {
            font-size: 16px;
            width: 20px;
            text-align: center;
        }
        
        /* Main Content */
        .main-content {
            flex: 1;
            display: flex;
            flex-direction: column;
            overflow: hidden;
        }
        
        /* Header */
        .header {
            height: 64px;
            background: var(--bg-panel);
            border-bottom: 1px solid var(--border-outer);
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 0 var(--space-xl);
            flex-shrink: 0;
        }
        
        .header-left {
            display: flex;
            align-items: center;
            gap: var(--space-xl);
        }
        
        .page-tabs {
            display: flex;
            gap: var(--space-sm);
        }
        
        .page-tab {
            padding: var(--space-sm) var(--space-md);
            border-radius: var(--radius-sm);
            font-size: 12px;
            font-weight: 500;
            color: var(--text-muted);
            cursor: pointer;
            transition: all 0.2s;
            display: flex;
            align-items: center;
            gap: var(--space-sm);
        }
        
        .page-tab:hover {
            color: var(--text-secondary);
            background: var(--bg-card-hover);
        }
        
        .page-tab.active {
            background: var(--echelon-cyan-bg);
            color: var(--echelon-cyan);
            border: 1px solid var(--echelon-cyan-border);
        }
        
        .page-title {
            font-size: 16px;
            font-weight: 600;
            color: var(--text-primary);
            letter-spacing: 0.02em;
        }
        
        .page-subtitle {
            font-size: 12px;
            color: var(--text-muted);
        }
        
        .header-right {
            display: flex;
            align-items: center;
            gap: var(--space-lg);
        }
        
        .header-btn {
            display: flex;
            align-items: center;
            gap: var(--space-sm);
            padding: var(--space-sm) var(--space-md);
            background: var(--bg-card);
            border: 1px solid var(--border-outer);
            border-radius: var(--radius-sm);
            color: var(--text-secondary);
            font-size: 12px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s;
        }
        
        .header-btn:hover {
            border-color: var(--echelon-cyan);
            color: var(--echelon-cyan);
        }
        
        .header-btn.primary {
            background: var(--echelon-cyan-bg);
            border-color: var(--echelon-cyan-border);
            color: var(--echelon-cyan);
        }
        
        .header-btn.primary:hover {
            background: var(--echelon-cyan);
            color: var(--slate-950);
        }
        
        .connection-status {
            display: flex;
            align-items: center;
            gap: 6px;
            font-size: 11px;
            font-weight: 600;
            color: var(--status-success);
            background: var(--status-success-bg);
            padding: 4px 10px;
border-radius: 20px;
            border: 1px solid var(--status-success-border);
        }
        
        .live-dot {
            width: 6px;
            height: 6px;
            border-radius: 50%;
            background: var(--status-success);
            animation: pulse 2s infinite;
        }
        
        @keyframes pulse { 0% { opacity: 1; } 50% { opacity: 0.5; } 100% { opacity: 1; } }
        
        .clock {
            font-family: var(--font-mono);
            font-size: 12px;
            color: var(--text-secondary);
        }
        
        /* Content Area */
        .content-area {
            flex: 1;
            padding: var(--space-lg);
            overflow-y: auto;
        }
        
        /* View Container */
        .view-container {
            display: none;
        }
        
        .view-container.active {
            display: block;
        }
        
        /* Agent Grid */
        .agents-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(340px, 1fr));
            gap: var(--space-md);
        }
        
        /* Agent Card */
        .agent-card {
            background: var(--bg-card);
            border: 1px solid var(--border-outer);
            border-radius: var(--radius-md);
            padding: var(--space-md);
            transition: all 0.2s;
            cursor: pointer;
        }
        
        .agent-card:hover {
            border-color: var(--echelon-cyan-border);
            transform: translateY(-2px);
        }
        
        .agent-card.stressed {
            border-color: var(--echelon-amber-border);
        }
        
        .agent-card.critical {
            border-color: var(--echelon-red-border);
            animation: criticalPulse 2s infinite;
        }
        
        @keyframes criticalPulse {
            0%, 100% { box-shadow: 0 0 0 0 rgba(239, 68, 68, 0); }
            50% { box-shadow: 0 0 20px 0 rgba(239, 68, 68, 0.3); }
        }
        
        .agent-card-header {
            display: flex;
            align-items: flex-start;
            justify-content: space-between;
            margin-bottom: var(--space-md);
        }
        
        .agent-info {
            display: flex;
            align-items: center;
            gap: var(--space-md);
        }
        
        .agent-emoji {
            font-size: 28px;
        }
        
        .agent-name-row {
            display: flex;
            align-items: center;
            gap: var(--space-sm);
        }
        
        .agent-name {
            font-size: 16px;
            font-weight: 700;
            color: var(--text-primary);
        }
        
        .agent-archetype {
            font-size: 10px;
            color: var(--text-muted);
            text-transform: uppercase;
            letter-spacing: 0.05em;
        }
        
        .agent-pnl {
            font-family: var(--font-mono);
            font-size: 18px;
            font-weight: 700;
        }
        
        .agent-pnl.positive { color: var(--status-success); }
        .agent-pnl.negative { color: var(--status-danger); }
        
        /* Genealogy */
        .genealogy {
            display: flex;
            align-items: center;
            gap: var(--space-sm);
            margin-bottom: var(--space-md);
            font-size: 11px;
        }
        
        .gen-badge {
            padding: 2px 8px;
            background: var(--echelon-purple-bg);
            border: 1px solid var(--echelon-purple-border);
            border-radius: 3px;
            font-family: var(--font-mono);
            font-size: 10px;
            font-weight: 600;
            color: var(--echelon-purple);
        }
        
        .genealogy-sep {
            color: var(--text-muted);
        }
        
        .genealogy-text {
            color: var(--text-muted);
        }
        
        .genealogy-parents {
            color: var(--echelon-purple);
        }
        
        .genesis-badge {
            color: var(--echelon-cyan);
        }
        
        /* Stats Row */
        .agent-stats {
            display: flex;
            align-items: center;
            gap: var(--space-lg);
            font-size: 11px;
            color: var(--text-muted);
            margin-bottom: var(--space-md);
        }
        
        .agent-stat {
            display: flex;
            align-items: center;
            gap: 4px;
        }
        
        .agent-stat i {
            font-size: 12px;
        }
        
        /* Sanity Indicator */
        .sanity-section {
            margin-bottom: var(--space-md);
        }
        
        .sanity-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 4px;
        }
        
        .sanity-label {
            display: flex;
            align-items: center;
            gap: 4px;
            font-size: 10px;
            color: var(--text-muted);
            text-transform: uppercase;
            letter-spacing: 0.05em;
        }
        
        .sanity-status {
            font-size: 10px;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.05em;
        }
        
        .sanity-status.stable { color: var(--status-success); }
        .sanity-status.stressed { color: var(--echelon-amber); }
        .sanity-status.critical { color: var(--status-danger); animation: pulse 1s infinite; }
        .sanity-status.breakdown { color: var(--status-danger); animation: pulse 0.5s infinite; }
        
        .sanity-bar-container {
            height: 6px;
            background: var(--bg-app);
            border-radius: 3px;
            overflow: hidden;
        }
        
        .sanity-bar {
            height: 100%;
            border-radius: 3px;
            transition: width 0.5s ease;
        }
        
        .sanity-bar.stable { background: var(--status-success); }
        .sanity-bar.stressed { background: var(--echelon-amber); }
        .sanity-bar.critical { background: var(--status-danger); }
        .sanity-bar.breakdown { background: var(--status-danger); animation: pulse 1s infinite; }
        
        .sanity-values {
            display: flex;
            justify-content: space-between;
            margin-top: 4px;
            font-family: var(--font-mono);
            font-size: 11px;
        }
        
        .sanity-current {
            font-weight: 600;
        }
        
        .sanity-current.stable { color: var(--status-success); }
        .sanity-current.stressed { color: var(--echelon-amber); }
        .sanity-current.critical { color: var(--status-danger); }
        .sanity-current.breakdown { color: var(--status-danger); }
        
        .sanity-warning {
            font-size: 10px;
            color: var(--status-danger);
            display: flex;
            align-items: center;
            gap: 4px;
            margin-top: 4px;
            animation: pulse 1s infinite;
        }
        
        .sanity-warning i { font-size: 10px; }
        
        /* Action Buttons */
        .agent-actions {
            display: flex;
            gap: var(--space-sm);
            padding-top: var(--space-md);
            border-top: 1px solid var(--border-outer);
        }
        
        .action-btn {
            flex: 1;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 6px;
            padding: 8px 12px;
            border-radius: var(--radius-sm);
            font-size: 11px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
        }
        
        .action-btn i { font-size: 14px; }
        
        .action-btn.copy {
            background: var(--echelon-cyan-bg);
            border: 1px solid var(--echelon-cyan-border);
            color: var(--echelon-cyan);
        }
        
        .action-btn.copy:hover {
            background: var(--echelon-cyan);
            color: var(--slate-950);
        }
        
        .action-btn.task {
            background: var(--echelon-purple-bg);
            border: 1px solid var(--echelon-purple-border);
            color: var(--echelon-purple);
        }
        
        .action-btn.task:hover {
            background: var(--echelon-purple);
            color: white;
        }
        
        .action-btn.hire {
            padding: 8px;
            background: var(--echelon-amber-bg);
            border: 1px solid var(--echelon-amber-border);
            color: var(--echelon-amber);
        }
        
        .action-btn.hire:hover {
            background: var(--echelon-amber);
            color: var(--slate-950);
        }
        
        /* Critical Warning Banner */
        .critical-banner {
            margin-top: var(--space-sm);
            padding: 8px;
            border-radius: var(--radius-sm);
            font-size: 10px;
        }
        
        .critical-banner.stressed {
            background: var(--echelon-amber-bg);
            border: 1px solid var(--echelon-amber-border);
            color: var(--echelon-amber);
        }
        
        .critical-banner.critical {
            background: var(--echelon-red-bg);
            border: 1px solid var(--echelon-red-border);
            color: var(--status-danger);
        }
        
        /* Right Sidebar */
        .right-sidebar {
            width: 280px;
            flex-shrink: 0;
            display: flex;
            flex-direction: column;
            gap: var(--space-md);
            margin-left: var(--space-lg);
        }
        
        .widget {
            background: var(--bg-card);
            border: 1px solid var(--border-outer);
            border-radius: var(--radius-md);
        }
        
        .widget-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: var(--space-sm) var(--space-md);
            border-bottom: 1px solid var(--border-outer);
        }
        
        .widget-title {
            font-size: 11px;
            font-weight: 600;
            color: var(--text-primary);
            text-transform: uppercase;
            letter-spacing: 0.05em;
        }
        
        .widget-body {
            padding: var(--space-md);
        }
        
        /* Archetype Legend */
        .archetype-item {
            display: flex;
            align-items: center;
            gap: var(--space-md);
            padding: var(--space-sm) 0;
            border-bottom: 1px solid var(--border-outer);
        }
        
        .archetype-item:last-child {
            border-bottom: none;
        }
        
        .archetype-emoji {
            font-size: 20px;
        }
        
        .archetype-name {
            flex: 1;
            font-size: 12px;
            color: var(--text-primary);
        }
        
        .archetype-count {
            font-family: var(--font-mono);
            font-size: 12px;
            color: var(--text-muted);
        }
        
        /* Performance Stats */
        .perf-stat {
            display: flex;
            justify-content: space-between;
            padding: var(--space-sm) 0;
            border-bottom: 1px solid var(--border-outer);
        }
        
        .perf-stat:last-child {
            border-bottom: none;
        }
        
        .perf-label {
            font-size: 12px;
            color: var(--text-muted);
        }
        
        .perf-value {
            font-family: var(--font-mono);
            font-size: 12px;
            font-weight: 600;
            color: var(--text-primary);
        }
        
        .perf-value.positive { color: var(--status-success); }
        .perf-value.negative { color: var(--status-danger); }
        
        /* Grid Layout */
        .content-layout {
            display: flex;
            align-items: flex-start;
        }
        
        .main-panel {
            flex: 1;
            min-width: 0;
        }
        
        /* Scrollbar */
        ::-webkit-scrollbar { width: 6px; height: 6px; }
        ::-webkit-scrollbar-track { background: var(--bg-app); }
        ::-webkit-scrollbar-thumb { background: var(--border-outer); border-radius: 3px; }
        ::-webkit-scrollbar-thumb:hover { background: var(--slate-700); }
        
        /* Utility */
        .text-green { color: var(--status-success); }
        .text-red { color: var(--status-danger); }
        .text-amber { color: var(--echelon-amber); }
        .text-purple { color: var(--echelon-purple); }
        .text-cyan { color: var(--echelon-cyan); }
        
        /* Performance Chart */
        .performance-section {
            padding: var(--space-md);
            border-top: 1px solid var(--border-outer);
            margin-top: var(--space-md);
        }
        
        .performance-title {
            font-size: 10px;
            color: var(--text-muted);
            text-transform: uppercase;
            letter-spacing: 0.05em;
            margin-bottom: var(--space-sm);
        }
        
        .performance-chart {
            height: 60px;
            background: var(--bg-app);
            border-radius: var(--radius-sm);
            position: relative;
            overflow: hidden;
        }
        
        .performance-path {
            fill: none;
            stroke: var(--status-success);
            stroke-width: 1.5;
            stroke-linecap: round;
            stroke-linejoin: round;
        }
        
        .performance-area {
            fill: url(#perfGradient);
            opacity: 0.3;
        }
        
        /* Strategy Parameters */
        .strategy-section {
            padding: var(--space-md);
            border-top: 1px solid var(--border-outer);
            margin-top: var(--space-md);
        }
        
        .strategy-param {
            margin-bottom: var(--space-sm);
        }
        
        .strategy-param:last-child {
            margin-bottom: 0;
        }
        
        .strategy-label-row {
            display: flex;
            justify-content: space-between;
            margin-bottom: 4px;
        }
        
        .strategy-label {
            font-size: 10px;
            color: var(--text-muted);
        }
        
        .strategy-value {
            font-family: var(--font-mono);
            font-size: 10px;
            font-weight: 600;
            color: var(--text-primary);
        }
        
        .strategy-bar {
            height: 4px;
            background: var(--bg-app);
            border-radius: 2px;
            overflow: hidden;
        }
        
        .strategy-fill {
            height: 100%;
            border-radius: 2px;
            transition: width 0.5s ease;
        }
        
        .strategy-fill.aggressive { background: var(--status-danger); }
        .strategy-fill.moderate { background: var(--status-warning); }
        .strategy-fill.conservative { background: var(--status-success); }
        .strategy-fill.neutral { background: var(--status-info); }
        
        /* SVG Gradients */
        .chart-svg {
            position: absolute;
            inset: 0;
            width: 100%;
            height: 100%;
        }
        
        /* ==================== GLOBAL INTELLIGENCE DASHBOARD ==================== */
        
        /* Dashboard Grid */
        .dashboard-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: var(--space-lg);
            margin-bottom: var(--space-lg);
        }
        
        .dashboard-card {
            background: var(--bg-card);
            border: 1px solid var(--border-outer);
            border-radius: var(--radius-md);
            overflow: hidden;
        }
        
        .dashboard-card-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: var(--space-md);
            border-bottom: 1px solid var(--border-outer);
        }
        
        .dashboard-card-title {
            display: flex;
            align-items: center;
            gap: var(--space-sm);
            font-size: 12px;
            font-weight: 600;
            color: var(--text-primary);
            text-transform: uppercase;
            letter-spacing: 0.05em;
        }
        
        .dashboard-card-title i {
            font-size: 16px;
            color: var(--echelon-cyan);
        }
        
        .activity-indicator {
            display: flex;
            align-items: center;
            gap: 6px;
            font-size: 10px;
            color: var(--status-success);
        }
        
        .activity-dot {
            width: 6px;
            height: 6px;
            border-radius: 50%;
            background: var(--status-success);
            animation: pulse 1.5s infinite;
        }
        
        .dashboard-card-body {
            padding: var(--space-md);
        }
        
        /* Heat Map */
        .theatre-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: var(--space-sm);
        }
        
        .theatre-cell {
            padding: var(--space-md);
            border-radius: var(--radius-sm);
            cursor: pointer;
            transition: all 0.2s;
        }
        
        .theatre-cell:hover {
            transform: scale(1.02);
        }
        
        .theatre-cell.high {
            background: rgba(239, 68, 68, 0.15);
            border: 1px solid rgba(239, 68, 68, 0.3);
        }
        
        .theatre-cell.medium {
            background: rgba(250, 204, 21, 0.1);
            border: 1px solid rgba(250, 204, 21, 0.2);
        }
        
        .theatre-cell.low {
            background: rgba(74, 222, 128, 0.1);
            border: 1px solid rgba(74, 222, 128, 0.2);
        }
        
        .theatre-name {
            font-size: 12px;
            font-weight: 600;
            color: var(--text-primary);
            margin-bottom: 4px;
        }
        
        .theatre-meta {
            display: flex;
            justify-content: space-between;
            font-size: 10px;
        }
        
        .theatre-agents {
            color: var(--text-secondary);
        }
        
        .theatre-activity {
            font-family: var(--font-mono);
        }
        
        .theatre-cell.high .theatre-activity { color: var(--status-danger); }
        .theatre-cell.medium .theatre-activity { color: var(--status-warning); }
        .theatre-cell.low .theatre-activity { color: var(--status-success); }
        
        /* Theatre Metrics */
        .theatre-metrics {
            display: flex;
            gap: 8px;
            margin-top: 8px;
            padding-top: 8px;
            border-top: 1px solid var(--border-outer);
        }
        
        .theatre-metrics .metric-item {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 2px;
        }
        
        .theatre-metrics .metric-label {
            font-size: 9px;
            color: var(--text-muted);
            text-transform: uppercase;
        }
        
        .theatre-metrics .metric-value {
            font-family: var(--font-mono);
            font-size: 10px;
            font-weight: 600;
            color: var(--text-secondary);
        }
        
        /* Movement Feed */
        .movement-feed {
            max-height: 280px;
            overflow-y: auto;
        }
        
        .movement-item {
            display: flex;
            align-items: flex-start;
            gap: var(--space-md);
            padding: var(--space-sm) 0;
            border-bottom: 1px solid var(--border-outer);
            font-size: 11px;
        }
        
        .movement-item:last-child {
            border-bottom: none;
        }
        
        .movement-velocity {
            font-family: var(--font-mono);
            font-size: 10px;
            font-weight: 600;
            padding: 2px 6px;
            border-radius: 3px;
            margin-left: auto;
        }
        
        .movement-velocity.positive {
            background: var(--status-success-bg);
            color: var(--status-success);
        }
        
        .movement-velocity.negative {
            background: var(--status-danger-bg);
            color: var(--status-danger);
        }
        
        .movement-velocity.neutral {
            background: var(--bg-app);
            color: var(--text-muted);
        }
        
        .movement-time {
            font-family: var(--font-mono);
            font-size: 10px;
            color: var(--text-muted);
            min-width: 70px;
        }
        
        .movement-icon {
            width: 20px;
            height: 20px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 10px;
        }
        
        .movement-icon.deploy {
            background: var(--status-success-bg);
            color: var(--status-success);
        }
        
        .movement-icon.withdraw {
            background: var(--status-danger-bg);
            color: var(--status-danger);
        }
        
        .movement-icon.strategy {
            background: var(--status-info-bg);
            color: var(--status-info);
        }
        
        .movement-content {
            flex: 1;
        }
        
        .movement-agent {
            font-weight: 600;
            color: var(--text-primary);
        }
        
        .movement-action {
            color: var(--text-secondary);
        }
        
        .movement-theatre {
            color: var(--echelon-cyan);
        }
        
        .feed-filter {
            display: flex;
            gap: var(--space-xs);
            padding: var(--space-sm);
            border-bottom: 1px solid var(--border-outer);
        }
        
        .filter-btn {
            padding: 4px 8px;
            border-radius: var(--radius-sm);
            font-size: 10px;
            font-weight: 500;
            color: var(--text-muted);
            background: transparent;
            border: none;
            cursor: pointer;
            transition: all 0.2s;
        }
        
        .filter-btn:hover {
            color: var(--text-secondary);
            background: var(--bg-app);
        }
        
        .filter-btn.active {
            background: var(--echelon-cyan-bg);
            color: var(--echelon-cyan);
        }
        
        /* Strategy Clusters */
        .cluster-card {
            padding: var(--space-md);
            border-radius: var(--radius-sm);
            margin-bottom: var(--space-md);
        }
        
        .cluster-card:last-child {
            margin-bottom: 0;
        }
        
        .cluster-card.shark {
            background: rgba(59, 130, 246, 0.1);
            border: 1px solid rgba(59, 130, 246, 0.2);
        }
        
        .cluster-card.diplomat {
            background: rgba(168, 85, 247, 0.1);
            border: 1px solid rgba(168, 85, 247, 0.2);
        }
        
        .cluster-card.saboteur {
            background: rgba(239, 68, 68, 0.1);
            border: 1px solid rgba(239, 68, 68, 0.2);
        }
        
        .cluster-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: var(--space-sm);
        }
        
        .cluster-title {
            display: flex;
            align-items: center;
            gap: var(--space-sm);
            font-size: 12px;
            font-weight: 600;
            color: var(--text-primary);
        }
        
        .cluster-count {
            font-size: 10px;
            padding: 2px 6px;
            border-radius: 3px;
            background: var(--bg-app);
            color: var(--text-muted);
        }
        
        .cluster-stats {
            display: flex;
            gap: var(--space-lg);
            font-size: 10px;
        }
        
        .cluster-stat {
            display: flex;
            flex-direction: column;
        }
        
        .cluster-stat-label {
            color: var(--text-muted);
        }
        
        .cluster-stat-value {
            font-family: var(--font-mono);
            font-weight: 600;
            color: var(--text-primary);
        }
        
        /* Conflict Matrix */
        .conflict-list {
            max-height: 280px;
            overflow-y: auto;
        }
        
        .conflict-item {
            padding: var(--space-md);
            border-radius: var(--radius-sm);
            margin-bottom: var(--space-sm);
            background: var(--bg-app);
            border: 1px solid var(--border-outer);
        }
        
        .conflict-item:last-child {
            margin-bottom: 0;
        }
        
        .conflict-severity {
            font-size: 9px;
            font-weight: 600;
            margin-bottom: 6px;
            letter-spacing: 0.05em;
        }
        
        .conflict-item.high-impact {
            background: rgba(239, 68, 68, 0.15);
            border: 1px solid rgba(239, 68, 68, 0.3);
        }
        
        .conflict-item.high-impact .conflict-severity {
            color: var(--status-danger);
        }
        
        .conflict-item.medium-impact {
            background: rgba(250, 204, 21, 0.1);
            border: 1px solid rgba(250, 204, 21, 0.2);
        }
        
        .conflict-item.medium-impact .conflict-severity {
            color: var(--status-warning);
        }
        
        .conflict-item.low-impact {
            background: rgba(74, 222, 128, 0.1);
            border: 1px solid rgba(74, 222, 128, 0.2);
        }
        
        .conflict-item.low-impact .conflict-severity {
            color: var(--status-success);
        }
        
        .conflict-agents {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: var(--space-sm);
        }
        
        .conflict-pair {
            display: flex;
            align-items: center;
            gap: var(--space-sm);
            font-size: 12px;
            font-weight: 600;
        }
        
        .conflict-vs {
            color: var(--text-muted);
            font-weight: 400;
        }
        
        .conflict-theatre {
            font-size: 10px;
            color: var(--text-muted);
        }
        
        .conflict-details {
            font-size: 10px;
            color: var(--text-secondary);
            display: flex;
            flex-direction: column;
            gap: 2px;
        }
        
        .conflict-impact {
            font-family: var(--font-mono);
        }
        
        .conflict-impact.negative {
            color: var(--status-danger);
        }
        
        .conflict-impact.positive {
            color: var(--status-success);
        }
        
        /* Full Width Cards */
        .full-width {
            grid-column: span 3;
        }
        
        @media (max-width: 1200px) {
            .dashboard-grid {
                grid-template-columns: 1fr;
            }
            .full-width {
                grid-column: span 1;
            }
        }
        
        /* Dashboard Stats Row */
        .stats-row {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: var(--space-md);
            margin-bottom: var(--space-lg);
        }
        
        .stat-card {
            background: var(--bg-card);
            border: 1px solid var(--border-outer);
            border-radius: var(--radius-md);
            padding: var(--space-md);
        }
        
        .stat-card-icon {
            width: 32px;
            height: 32px;
            border-radius: var(--radius-sm);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 16px;
            margin-bottom: var(--space-sm);
        }
        
        .stat-card-icon.total {
            background: var(--status-info-bg);
            color: var(--status-info);
        }
        
        .stat-card-icon.deployed {
            background: var(--status-success-bg);
            color: var(--status-success);
        }
        
        .stat-card-icon.movements {
            background: var(--status-warning-bg);
            color: var(--status-warning);
        }
        
        .stat-card-icon.conflicts {
            background: var(--status-danger-bg);
            color: var(--status-danger);
        }
        
        .stat-card-value {
            font-family: var(--font-mono);
            font-size: 24px;
            font-weight: 700;
            color: var(--text-primary);
            margin-bottom: 2px;
        }
        
        .stat-card-label {
            font-size: 11px;
            color: var(--text-muted);
        }
        
        .stat-card-change {
            font-size: 10px;
            margin-top: 4px;
        }
        
        .stat-card-change.up {
            color: var(--status-success);
        }
        
        .stat-card-change.down {
            color: var(--status-danger);
        }
    </style>
    <svg style="position: absolute; width: 0; height: 0; overflow: hidden;">
        <defs>
            <linearGradient id="perfGradient" x1="0%" y1="0%" x2="0%" y2="100%">
                <stop offset="0%" stop-color="var(--status-success)" stop-opacity="0.4"/>
                <stop offset="100%" stop-color="var(--status-success)" stop-opacity="0"/>
            </linearGradient>
        </defs>
    </svg>
<style id="__shell_hide__">
.top-nav{display:none!important;}
.sidebar{display:none!important;}
.app-sidebar{display:none!important;}
.main-content{margin-left:0!important;}
.connection-status,.system-clock,.clock,#clock,.live-indicator,.network-badge{display:none!important;}
html,body{height:100%;} body{overflow:auto;}

/* __table_fix__ */
.leaderboard-table{width:100%!important;border-collapse:collapse!important;table-layout:fixed!important;}
.leaderboard-table thead th{padding:10px 16px!important;text-align:left!important;font-size:10px!important;letter-spacing:.08em!important;text-transform:uppercase!important;color:var(--text-muted)!important;font-weight:700!important;border-bottom:1px solid var(--border-outer)!important;background:var(--bg-card)!important;position:sticky!important;top:0!important;z-index:2!important;}
.leaderboard-table tbody td{padding:10px 16px!important;border-bottom:1px solid var(--border-inner)!important;vertical-align:middle!important;font-size:11px!important;color:var(--text-secondary)!important;}
.leaderboard-table th.numeric,.leaderboard-table td.numeric{text-align:right!important;}
.leaderboard-table th:first-child,.leaderboard-table td:first-child{width:30px!important;padding-left:16px!important;}

</style>
</head>
<body>
    <div class="app-layout">
        <!-- Left Sidebar -->
        <aside class="sidebar">
            <div class="sidebar-header">
                <div class="sidebar-logo">
                    <div class="sidebar-logo-icon">◎</div>
                    ECHELON
                </div>
            </div>
            <nav class="sidebar-nav">
                <div class="nav-section">
                    <div class="nav-section-title">Operations</div>
                    <div class="nav-item">
                        <i class="ri-dashboard-3-line"></i>
                        Dashboard
                    </div>
                    <div class="nav-item">
                        <i class="ri-tools-line"></i>
                        Field Kit
                    </div>
                    <div class="nav-item">
                        <i class="ri-radar-line"></i>
                        Sigint
                    </div>
                    <div class="nav-item">
                        <i class="ri-terminal-box-line"></i>
                        Blackbox
                    </div>
                    <div class="nav-item">
                        <i class="ri-rocket-2-line"></i>
                        Launchpad
                    </div>
                </div>
                <div class="nav-section">
                    <div class="nav-section-title">Intelligence</div>
                    <div class="nav-item active">
                        <i class="ri-robot-line"></i>
                        Agent Roster
                    </div>
                    <div class="nav-item">
                        <i class="ri-alert-line"></i>
                        Breach Console
                    </div>
                    <div class="nav-item">
                        <i class="ri-download-2-line"></i>
                        Export Console
                    </div>
                </div>
                <div class="nav-section">
                    <div class="nav-section-title">System</div>
                    <div class="nav-item">
                        <i class="ri-settings-3-line"></i>
                        Settings
                    </div>
                </div>
            </nav>
        </aside>

        <!-- Main Content -->
        <main class="main-content">
            <!-- Header -->
            <header class="header">
                <div class="header-left">
                    <div class="page-tabs">
                        <div class="page-tab active" onclick="switchView('roster')" id="tab-roster">
                            <i class="ri-robot-line"></i>
                            Agent Roster
                        </div>
                        <div class="page-tab" onclick="switchView('intelligence')" id="tab-intelligence">
                            <i class="ri-global-line"></i>
                            Global Intelligence
                        </div>
                    </div>
                </div>
                <div class="header-right">
                    <button class="header-btn">
                        <i class="ri-search-line"></i>
                        Search
                    </button>
                    <button class="header-btn primary">
                        <i class="ri-add-line"></i>
                        Deploy Agent
                    </button>
                    <div class="connection-status">
                        <span class="live-dot"></span>
                        Connected
                    </div>
                    <span class="clock">20:07:53 UTC</span>
                </div>
            </header>

            <!-- Content Area -->
            <div class="content-area">
                
                <!-- ==================== AGENT ROSTER VIEW ==================== -->
                <div class="view-container active" id="view-roster">
                    <div class="content-layout">
                        <!-- Main Panel - Agent Grid -->
                        <div class="main-panel">
                            <div class="agents-grid">
                                <!-- MEGALODON - WHALE -->
                                <div class="agent-card">
                                    <div class="agent-card-header">
                                        <div class="agent-info">
                                            <span class="agent-emoji">🐋</span>
                                            <div>
                                                <div class="agent-name-row">
                                                    <span class="agent-name">MEGALODON</span>
                                                </div>
                                                <span class="agent-archetype">WHALE</span>
                                            </div>
                                        </div>
                                        <span class="agent-pnl positive">+$124,580</span>
                                    </div>
                                    
                                    <div class="genealogy">
                                        <span class="gen-badge">GEN 1</span>
                                        <span class="genealogy-sep">•</span>
                                        <span class="genealogy-text">
                                            LINEAGE: <span class="genesis-badge">GENESIS AGENT</span>
                                        </span>
                                    </div>
                                    
                                    <div class="agent-stats">
                                        <span class="agent-stat">
                                            <i class="ri-flashlight-line"></i>
                                            2,847 actions
                                        </span>
                                        <span class="agent-stat">
                                            <i class="ri-trending-up-line"></i>
                                            78% win rate
                                        </span>
                                    </div>
                                    
                                    <div class="sanity-section">
                                        <div class="sanity-header">
                                            <span class="sanity-label">
                                                <i class="ri-brain-line"></i> SANITY
                                            </span>
                                            <span class="sanity-status stable">STABLE</span>
                                        </div>
                                        <div class="sanity-bar-container">
                                            <div class="sanity-bar stable" style="width: 85%;"></div>
                                        </div>
                                        <div class="sanity-values">
                                            <span class="sanity-current stable">85/100</span>
                                        </div>
                                    </div>
                                    
                                    <div class="agent-actions">
                                        <button class="action-btn copy">
                                            <i class="ri-file-copy-line"></i>
                                            COPY
                                        </button>
                                        <button class="action-btn hire">
                                            <i class="ri-briefcase-line"></i>
                                        </button>
                                    </div>
                                </div>

                                <!-- AEGIS - DIPLOMAT -->
                                <div class="agent-card">
                                    <div class="agent-card-header">
                                        <div class="agent-info">
                                            <span class="agent-emoji">🤝</span>
                                            <div>
                                                <div class="agent-name-row">
                                                    <span class="agent-name">AEGIS</span>
                                                </div>
                                                <span class="agent-archetype">DIPLOMAT</span>
                                            </div>
                                        </div>
                                        <span class="agent-pnl positive">+$89,340</span>
                                    </div>
                                    
                                    <div class="genealogy">
                                        <span class="gen-badge">GEN 2</span>
                                        <span class="genealogy-sep">•</span>
                                        <span class="genealogy-text">
                                            LINEAGE: <span class="genealogy-parents">MEGALODON × PHANTOM</span>
                                        </span>
                                    </div>
                                    
                                    <div class="agent-stats">
                                        <span class="agent-stat">
                                            <i class="ri-flashlight-line"></i>
                                            1,924 actions
                                        </span>
                                        <span class="agent-stat">
                                            <i class="ri-trending-up-line"></i>
                                            72% win rate
                                        </span>
                                    </div>
                                    
                                    <div class="sanity-section">
                                        <div class="sanity-header">
                                            <span class="sanity-label">
                                                <i class="ri-brain-line"></i> SANITY
                                            </span>
                                            <span class="sanity-status stable">STABLE</span>
                                        </div>
                                        <div class="sanity-bar-container">
                                            <div class="sanity-bar stable" style="width: 78%;"></div>
                                        </div>
                                        <div class="sanity-values">
                                            <span class="sanity-current stable">78/100</span>
                                        </div>
                                    </div>
                                    
                                    <div class="agent-actions">
                                        <button class="action-btn copy">
                                            <i class="ri-file-copy-line"></i>
                                            COPY
                                        </button>
                                        <button class="action-btn hire">
                                            <i class="ri-briefcase-line"></i>
                                        </button>
                                    </div>
                                </div>

                                <!-- SABOTEUR - SABOTEUR -->
                                <div class="agent-card">
                                    <div class="agent-card-header">
                                        <div class="agent-info">
                                            <span class="agent-emoji">💣</span>
                                            <div>
                                                <div class="agent-name-row">
                                                    <span class="agent-name">SABOTEUR</span>
                                                </div>
                                                <span class="agent-archetype">SABOTEUR</span>
                                            </div>
                                        </div>
                                        <span class="agent-pnl positive">+$67,890</span>
                                    </div>
                                    
                                    <div class="genealogy">
                                        <span class="gen-badge">GEN 1</span>
                                        <span class="genealogy-sep">•</span>
                                        <span class="genealogy-text">
                                            LINEAGE: <span class="genesis-badge">GENESIS AGENT</span>
                                        </span>
                                    </div>
                                    
                                    <div class="agent-stats">
                                        <span class="agent-stat">
                                            <i class="ri-flashlight-line"></i>
                                            1,456 actions
                                        </span>
                                        <span class="agent-stat">
                                            <i class="ri-trending-up-line"></i>
                                            68% win rate
                                        </span>
                                    </div>
                                    
                                    <div class="sanity-section">
                                        <div class="sanity-header">
                                            <span class="sanity-label">
                                                <i class="ri-brain-line"></i> SANITY
                                            </span>
                                            <span class="sanity-status stressed">STRESSED</span>
                                        </div>
                                        <div class="sanity-bar-container">
                                            <div class="sanity-bar stressed" style="width: 52%;"></div>
                                        </div>
                                        <div class="sanity-values">
                                            <span class="sanity-current stressed">52/100</span>
                                        </div>
                                    </div>
                                    
                                    <div class="critical-banner stressed">
                                        ⚠️ SABOTEUR is under stress. Consider rest or support missions.
                                    </div>
                                    
                                    <div class="agent-actions">
                                        <button class="action-btn copy">
                                            <i class="ri-file-copy-line"></i>
                                            COPY
                                        </button>
                                        <button class="action-btn hire">
                                            <i class="ri-briefcase-line"></i>
                                        </button>
                                    </div>
                                </div>

                                <!-- VIPER - SHARK -->
                                <div class="agent-card critical">
                                    <div class="agent-card-header">
                                        <div class="agent-info">
                                            <span class="agent-emoji">🦈</span>
                                            <div>
                                                <div class="agent-name-row">
                                                    <span class="agent-name">VIPER</span>
                                                </div>
                                                <span class="agent-archetype">SHARK</span>
                                            </div>
                                        </div>
                                        <span class="agent-pnl negative">-$12,450</span>
                                    </div>
                                    
                                    <div class="genealogy">
                                        <span class="gen-badge">GEN 3</span>
                                        <span class="genealogy-sep">•</span>
                                        <span class="genealogy-text">
                                            LINEAGE: <span class="genealogy-parents">CARDINAL × SPECTER</span>
                                        </span>
                                    </div>
                                    
                                    <div class="agent-stats">
                                        <span class="agent-stat">
                                            <i class="ri-flashlight-line"></i>
                                            892 actions
                                        </span>
                                        <span class="agent-stat">
                                            <i class="ri-trending-up-line"></i>
                                            45% win rate
                                        </span>
                                    </div>
                                    
                                    <div class="sanity-section">
                                        <div class="sanity-header">
                                            <span class="sanity-label">
                                                <i class="ri-brain-line"></i> SANITY
                                            </span>
                                            <span class="sanity-status critical">CRITICAL</span>
                                        </div>
                                        <div class="sanity-bar-container">
                                            <div class="sanity-bar critical" style="width: 18%;"></div>
                                        </div>
                                        <div class="sanity-values">
                                            <span class="sanity-current critical">18/100</span>
                                        </div>
                                    </div>
                                    
                                    <div class="sanity-warning">
                                        <i class="ri-error-warning-fill"></i>
                                        BREAKDOWN RISK
                                    </div>
                                    
                                    <div class="critical-banner critical">
                                        ⚠️ VIPER is near psychological breakdown. High-risk missions may cause permanent damage.
                                    </div>
                                    
                                    <div class="agent-actions">
                                        <button class="action-btn task">
                                            <i class="ri-search-line"></i>
                                            TASK
                                        </button>
                                        <button class="action-btn copy">
                                            <i class="ri-file-copy-line"></i>
                                            COPY
                                        </button>
                                        <button class="action-btn hire">
                                            <i class="ri-briefcase-line"></i>
                                        </button>
                                    </div>
                                </div>

                                <!-- ORACLE - DIPLOMAT -->
                                <div class="agent-card">
                                    <div class="agent-card-header">
                                        <div class="agent-info">
                                            <span class="agent-emoji">🤝</span>
                                            <div>
                                                <div class="agent-name-row">
                                                    <span class="agent-name">ORACLE</span>
                                                </div>
                                                <span class="agent-archetype">DIPLOMAT</span>
                                            </div>
                                        </div>
                                        <span class="agent-pnl positive">+$54,230</span>
                                    </div>
                                    
                                    <div class="genealogy">
                                        <span class="gen-badge">GEN 2</span>
                                        <span class="genealogy-sep">•</span>
                                        <span class="genealogy-text">
                                            LINEAGE: <span class="genealogy-parents">ENVOY × CARDINAL</span>
                                        </span>
                                    </div>
                                    
                                    <div class="agent-stats">
                                        <span class="agent-stat">
                                            <i class="ri-flashlight-line"></i>
                                            1,234 actions
                                        </span>
                                        <span class="agent-stat">
                                            <i class="ri-trending-up-line"></i>
                                            71% win rate
                                        </span>
                                    </div>
                                    
                                    <div class="sanity-section">
                                        <div class="sanity-header">
                                            <span class="sanity-label">
                                                <i class="ri-brain-line"></i> SANITY
                                            </span>
                                            <span class="sanity-status stable">STABLE</span>
                                        </div>
                                        <div class="sanity-bar-container">
                                            <div class="sanity-bar stable" style="width: 92%;"></div>
                                        </div>
                                        <div class="sanity-values">
                                            <span class="sanity-current stable">92/100</span>
                                        </div>
                                    </div>
                                    
                                    <div class="agent-actions">
                                        <button class="action-btn copy">
                                            <i class="ri-file-copy-line"></i>
                                            COPY
                                        </button>
                                        <button class="action-btn hire">
                                            <i class="ri-briefcase-line"></i>
                                        </button>
                                    </div>
                                </div>

                                <!-- SPECTER - SPY -->
                                <div class="agent-card">
                                    <div class="agent-card-header">
                                        <div class="agent-info">
                                            <span class="agent-emoji">🕵️</span>
                                            <div>
                                                <div class="agent-name-row">
                                                    <span class="agent-name">SPECTER</span>
                                                </div>
                                                <span class="agent-archetype">SPY</span>
                                            </div>
                                        </div>
                                        <span class="agent-pnl positive">+$41,670</span>
                                    </div>
                                    
                                    <div class="genealogy">
                                        <span class="gen-badge">GEN 2</span>
                                        <span class="genealogy-sep">•</span>
                                        <span class="genealogy-text">
                                            LINEAGE: <span class="genealogy-parents">MEGALODON × PHANTOM</span>
                                        </span>
                                    </div>
                                    
                                    <div class="agent-stats">
                                        <span class="agent-stat">
                                            <i class="ri-flashlight-line"></i>
                                            678 actions
                                        </span>
                                        <span class="agent-stat">
                                            <i class="ri-trending-up-line"></i>
                                            82% win rate
                                        </span>
                                    </div>
                                    
                                    <div class="sanity-section">
                                        <div class="sanity-header">
                                            <span class="sanity-label">
                                                <i class="ri-brain-line"></i> SANITY
                                            </span>
                                            <span class="sanity-status stressed">STRESSED</span>
                                        </div>
                                        <div class="sanity-bar-container">
                                            <div class="sanity-bar stressed" style="width: 45%;"></div>
                                        </div>
                                        <div class="sanity-values">
                                            <span class="sanity-current stressed">45/100</span>
                                        </div>
                                    </div>
                                    
                                    <div class="agent-actions">
                                        <button class="action-btn task">
                                            <i class="ri-search-line"></i>
                                            TASK
                                        </button>
                                        <button class="action-btn copy">
                                            <i class="ri-file-copy-line"></i>
                                            COPY
                                        </button>
                                        <button class="action-btn hire">
                                            <i class="ri-briefcase-line"></i>
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Right Sidebar -->
                        <aside class="right-sidebar">
                            <!-- Archetype Distribution -->
                            <div class="widget">
                                <div class="widget-header">
                                    <span class="widget-title">Archetype Distribution</span>
                                </div>
                                <div class="widget-body">
                                    <div class="archetype-item">
                                        <span class="archetype-emoji">🐋</span>
                                        <span class="archetype-name">WHALE</span>
                                        <span class="archetype-count">3</span>
                                    </div>
                                    <div class="archetype-item">
                                        <span class="archetype-emoji">🤝</span>
                                        <span class="archetype-name">DIPLOMAT</span>
                                        <span class="archetype-count">3</span>
                                    </div>
                                    <div class="archetype-item">
                                        <span class="archetype-emoji">💣</span>
                                        <span class="archetype-name">SABOTEUR</span>
                                        <span class="archetype-count">2</span>
                                    </div>
                                    <div class="archetype-item">
                                        <span class="archetype-emoji">🦈</span>
                                        <span class="archetype-name">SHARK</span>
                                        <span class="archetype-count">2</span>
                                    </div>
                                    <div class="archetype-item">
                                        <span class="archetype-emoji">🕵️</span>
                                        <span class="archetype-name">SPY</span>
                                        <span class="archetype-count">2</span>
                                    </div>
                                </div>
                            </div>

                            <!-- Performance Summary -->
                            <div class="widget">
                                <div class="widget-header">
                                    <span class="widget-title">Performance Summary</span>
                                </div>
                                <div class="widget-body">
                                    <div class="perf-stat">
                                        <span class="perf-label">Total P/L</span>
                                        <span class="perf-value positive">+$482,340</span>
                                    </div>
                                    <div class="perf-stat">
                                        <span class="perf-label">Win Rate</span>
                                        <span class="perf-value">68%</span>
                                    </div>
                                    <div class="perf-stat">
                                        <span class="perf-label">Total Actions</span>
                                        <span class="perf-value">12,847</span>
                                    </div>
                                    <div class="perf-stat">
                                        <span class="perf-label">Avg Sanity</span>
                                        <span class="perf-value">72/100</span>
                                    </div>
                                    <div class="perf-stat">
                                        <span class="perf-label">Genesis Agents</span>
                                        <span class="perf-value">4</span>
                                    </div>
                                </div>
                            </div>

                            <!-- Sanity Distribution -->
                            <div class="widget">
                                <div class="widget-header">
                                    <span class="widget-title">Sanity Distribution</span>
                                </div>
                                <div class="widget-body">
                                    <div class="perf-stat">
                                        <span class="perf-label">STABLE (70-100)</span>
                                        <span class="perf-value">7 agents</span>
                                    </div>
                                    <div class="perf-stat">
                                        <span class="perf-label">STRESSED (40-69)</span>
                                        <span class="perf-value text-amber">3 agents</span>
                                    </div>
                                    <div class="perf-stat">
                                        <span class="perf-label">CRITICAL (20-39)</span>
                                        <span class="perf-value text-red">1 agent</span>
                                    </div>
                                    <div class="perf-stat">
                                        <span class="perf-label">BREAKDOWN (<20)</span>
                                        <span class="perf-value text-red">1 agent</span>
                                    </div>
                                </div>
                            </div>
                        </aside>
                    </div>
                </div>
                
                <!-- ==================== GLOBAL INTELLIGENCE VIEW ==================== -->
                <div class="view-container" id="view-intelligence">
                    
                    <!-- Stats Row -->
                    <div class="stats-row">
                        <div class="stat-card">
                            <div class="stat-card-icon total">
                                <i class="ri-robot-line"></i>
                            </div>
                            <div class="stat-card-value">12</div>
                            <div class="stat-card-label">Total Agents</div>
                            <div class="stat-card-change up">+2 this week</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-card-icon deployed">
                                <i class="ri-checkbox-circle-line"></i>
                            </div>
                            <div class="stat-card-value">8</div>
                            <div class="stat-card-label">Deployed</div>
                            <div class="stat-card-change">67% utilization</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-card-icon movements">
                                <i class="ri-exchange-line"></i>
                            </div>
                            <div class="stat-card-value">47</div>
                            <div class="stat-card-label">Movements (24h)</div>
                            <div class="stat-card-change up">+12 from yesterday</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-card-icon conflicts">
                                <i class="ri-sword-line"></i>
                            </div>
                            <div class="stat-card-value">3</div>
                            <div class="stat-card-label">Active Conflicts</div>
                            <div class="stat-card-change down">-1 from yesterday</div>
                        </div>
                    </div>
                    
                    <!-- Dashboard Grid -->
                    <div class="dashboard-grid">
                        
                        <!-- Agent Deployment Heat Map -->
                        <div class="dashboard-card">
                            <div class="dashboard-card-header">
                                <span class="dashboard-card-title">
                                    <i class="ri-map-2-line"></i>
                                    Deployment Heat Map
                                </span>
                                <span class="activity-indicator">
                                    <span class="activity-dot"></span>
                                    LIVE
                                </span>
                            </div>
                            <div class="dashboard-card-body">
                                <div class="theatre-grid">
                                    <div class="theatre-cell high">
                                        <div class="theatre-name">ORB_SALVAGE_F7</div>
                                        <div class="theatre-meta">
                                            <span class="theatre-agents">12 agents</span>
                                            <span class="theatre-activity">🔥 High</span>
                                        </div>
                                        <div class="theatre-metrics">
                                            <span class="metric-item"><span class="metric-label">Stab</span> <span class="metric-value">87%</span></span>
                                            <span class="metric-item"><span class="metric-label">Vol</span> <span class="metric-value">$142K</span></span>
                                            <span class="metric-item"><span class="metric-label">Gap</span> <span class="metric-value">12%</span></span>
                                        </div>
                                    </div>
                                    <div class="theatre-cell medium">
                                        <div class="theatre-name">VEN_OIL_TANKER</div>
                                        <div class="theatre-meta">
                                            <span class="theatre-agents">8 agents</span>
                                            <span class="theatre-activity">🟡 Medium</span>
                                        </div>
                                        <div class="theatre-metrics">
                                            <span class="metric-item"><span class="metric-label">Stab</span> <span class="metric-value">92%</span></span>
                                            <span class="metric-item"><span class="metric-label">Vol</span> <span class="metric-value">$89K</span></span>
                                            <span class="metric-item"><span class="metric-label">Gap</span> <span class="metric-value">8%</span></span>
                                        </div>
                                    </div>
                                    <div class="theatre-cell high">
                                        <div class="theatre-name">FED_RATE_DECISION</div>
                                        <div class="theatre-meta">
                                            <span class="theatre-agents">15 agents</span>
                                            <span class="theatre-activity">🔥 High</span>
                                        </div>
                                        <div class="theatre-metrics">
                                            <span class="metric-item"><span class="metric-label">Stab</span> <span class="metric-value">78%</span></span>
                                            <span class="metric-item"><span class="metric-label">Vol</span> <span class="metric-value">$215K</span></span>
                                            <span class="metric-item"><span class="metric-label">Gap</span> <span class="metric-value">18%</span></span>
                                        </div>
                                    </div>
                                    <div class="theatre-cell low">
                                        <div class="theatre-name">TAIWAN_STRAIT</div>
                                        <div class="theatre-meta">
                                            <span class="theatre-agents">5 agents</span>
                                            <span class="theatre-activity">🟢 Low</span>
                                        </div>
                                        <div class="theatre-metrics">
                                            <span class="metric-item"><span class="metric-label">Stab</span> <span class="metric-value">95%</span></span>
                                            <span class="metric-item"><span class="metric-label">Vol</span> <span class="metric-value">$45K</span></span>
                                            <span class="metric-item"><span class="metric-label">Gap</span> <span class="metric-value">5%</span></span>
                                        </div>
                                    </div>
                                    <div class="theatre-cell medium">
                                        <div class="theatre-name">NVDA_EARNINGS</div>
                                        <div class="theatre-meta">
                                            <span class="theatre-agents">9 agents</span>
                                            <span class="theatre-activity">🟡 Medium</span>
                                        </div>
                                        <div class="theatre-metrics">
                                            <span class="metric-item"><span class="metric-label">Stab</span> <span class="metric-value">84%</span></span>
                                            <span class="metric-item"><span class="metric-label">Vol</span> <span class="metric-value">$128K</span></span>
                                            <span class="metric-item"><span class="metric-label">Gap</span> <span class="metric-value">14%</span></span>
                                        </div>
                                    </div>
                                    <div class="theatre-cell low">
                                        <div class="theatre-name">BTC_HALVING</div>
                                        <div class="theatre-meta">
                                            <span class="theatre-agents">4 agents</span>
                                            <span class="theatre-activity">🟢 Low</span>
                                        </div>
                                        <div class="theatre-metrics">
                                            <span class="metric-item"><span class="metric-label">Stab</span> <span class="metric-value">97%</span></span>
                                            <span class="metric-item"><span class="metric-label">Vol</span> <span class="metric-value">$32K</span></span>
                                            <span class="metric-item"><span class="metric-label">Gap</span> <span class="metric-value">3%</span></span>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Agent Movement Feed -->
                        <div class="dashboard-card">
                            <div class="dashboard-card-header">
                                <span class="dashboard-card-title">
                                    <i class="ri-history-line"></i>
                                    Movement Feed
                                </span>
                                <span class="activity-indicator">
                                    <span class="activity-dot"></span>
                                    LIVE
                                </span>
                            </div>
                            <div class="feed-filter">
                                <button class="filter-btn active" data-filter="all">All</button>
                                <button class="filter-btn" data-filter="deploy">Deploy</button>
                                <button class="filter-btn" data-filter="withdraw">Withdraw</button>
                                <button class="filter-btn" data-filter="strategy">Strategy</button>
                            </div>
                            <div class="dashboard-card-body" style="padding: 0;">
                                <div class="movement-feed">
                                    <div class="movement-item">
                                        <span class="movement-time">14:32:45</span>
                                        <div class="movement-icon deploy">→</div>
                                        <div class="movement-content">
                                            <span class="movement-agent">LEVIATHAN</span>
                                            <span class="movement-action"> deployed to</span>
                                            <span class="movement-theatre">ORB_SALVAGE_F7</span>
                                        </div>
                                        <span class="movement-velocity positive">+3</span>
                                    </div>
                                    <div class="movement-item">
                                        <span class="movement-time">14:32:42</span>
<div class="movement-icon withdraw">←</div>
                                        <div class="movement-content">
                                            <span class="movement-agent">VIPER</span>
                                            <span class="movement-action"> withdrew from</span>
                                            <span class="movement-theatre">VEN_OIL_TANKER</span>
                                        </div>
                                        <span class="movement-velocity negative">-2</span>
                                    </div>
                                    <div class="movement-item">
                                        <span class="movement-time">14:32:38</span>
                                        <div class="movement-icon deploy">→</div>
                                        <div class="movement-content">
                                            <span class="movement-agent">CHAOS</span>
                                            <span class="movement-action"> deployed to</span>
                                            <span class="movement-theatre">FED_RATE_DECISION</span>
                                        </div>
                                        <span class="movement-velocity positive">+4</span>
                                    </div>
                                    <div class="movement-item">
                                        <span class="movement-time">14:32:35</span>
                                        <div class="movement-icon deploy">→</div>
                                        <div class="movement-content">
                                            <span class="movement-agent">AMBASSADOR</span>
                                            <span class="movement-action"> deployed to</span>
                                            <span class="movement-theatre">TAIWAN_STRAIT</span>
                                        </div>
                                        <span class="movement-velocity positive">+2</span>
                                    </div>
                                    <div class="movement-item">
                                        <span class="movement-time">14:32:30</span>
                                        <div class="movement-icon withdraw">←</div>
                                        <div class="movement-content">
                                            <span class="movement-agent">CARDINAL</span>
                                            <span class="movement-action"> withdrew from</span>
                                            <span class="movement-theatre">ORB_SALVAGE_F7</span>
                                        </div>
                                        <span class="movement-velocity negative">-1</span>
                                    </div>
                                    <div class="movement-item">
                                        <span class="movement-time">14:32:25</span>
                                        <div class="movement-icon strategy">⚡</div>
                                        <div class="movement-content">
                                            <span class="movement-agent">TITAN</span>
                                            <span class="movement-action"> shifted to</span>
                                            <span class="movement-theatre">conservative strategy</span>
                                        </div>
                                        <span class="movement-velocity neutral">~0</span>
                                    </div>
                                    <div class="movement-item">
                                        <span class="movement-time">14:32:20</span>
                                        <div class="movement-icon deploy">→</div>
                                        <div class="movement-content">
                                            <span class="movement-agent">SHADOW</span>
                                            <span class="movement-action"> deployed to</span>
                                            <span class="movement-theatre">NVDA_EARNINGS</span>
                                        </div>
                                        <span class="movement-velocity positive">+1</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Agent Strategy Clusters -->
                        <div class="dashboard-card">
                            <div class="dashboard-card-header">
                                <span class="dashboard-card-title">
                                    <i class="ri-group-line"></i>
                                    Strategy Clusters
                                </span>
                            </div>
                            <div class="dashboard-card-body">
                                <div class="cluster-card shark">
                                    <div class="cluster-header">
                                        <span class="cluster-title">
                                            <span>🦈</span>
                                            SHARK Cluster
                                        </span>
                                        <span class="cluster-count">12 agents</span>
                                    </div>
                                    <div class="cluster-stats">
                                        <div class="cluster-stat">
                                            <span class="cluster-stat-label">Focus</span>
                                            <span class="cluster-stat-value">High-volatility</span>
                                        </div>
                                        <div class="cluster-stat">
                                            <span class="cluster-stat-label">Avg Position</span>
                                            <span class="cluster-stat-value">$8,450</span>
                                        </div>
                                        <div class="cluster-stat">
                                            <span class="cluster-stat-label">Win Rate</span>
                                            <span class="cluster-stat-value">68%</span>
                                        </div>
                                    </div>
                                </div>
                                
                                <div class="cluster-card diplomat">
                                    <div class="cluster-header">
                                        <span class="cluster-title">
                                            <span>🤝</span>
                                            DIPLOMAT Cluster
                                        </span>
                                        <span class="cluster-count">8 agents</span>
                                    </div>
                                    <div class="cluster-stats">
                                        <div class="cluster-stat">
                                            <span class="cluster-stat-label">Focus</span>
                                            <span class="cluster-stat-value">Stability</span>
                                        </div>
                                        <div class="cluster-stat">
                                            <span class="cluster-stat-label">Avg Position</span>
                                            <span class="cluster-stat-value">$4,200</span>
                                        </div>
                                        <div class="cluster-stat">
                                            <span class="cluster-stat-label">Win Rate</span>
                                            <span class="cluster-stat-value">72%</span>
                                        </div>
                                    </div>
                                </div>
                                
                                <div class="cluster-card saboteur">
                                    <div class="cluster-header">
                                        <span class="cluster-title">
                                            <span>💣</span>
                                            SABOTEUR Cluster
                                        </span>
                                        <span class="cluster-count">6 agents</span>
                                    </div>
                                    <div class="cluster-stats">
                                        <div class="cluster-stat">
                                            <span class="cluster-stat-label">Focus</span>
                                            <span class="cluster-stat-value">Adversarial</span>
                                        </div>
                                        <div class="cluster-stat">
                                            <span class="cluster-stat-label">Avg Position</span>
                                            <span class="cluster-stat-value">$3,800</span>
                                        </div>
                                        <div class="cluster-stat">
                                            <span class="cluster-stat-label">Win Rate</span>
                                            <span class="cluster-stat-value">42%</span>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Agent Conflict Matrix -->
                        <div class="dashboard-card full-width">
                            <div class="dashboard-card-header">
                                <span class="dashboard-card-title">
                                    <i class="ri-sword-line"></i>
                                    Agent Conflicts & Interactions
                                </span>
                            </div>
                            <div class="dashboard-card-body">
                                <div class="conflict-list">
                                    <div class="conflict-item high-impact">
                                        <div class="conflict-severity">⚠️ HIGH IMPACT</div>
                                        <div class="conflict-agents">
                                            <span class="conflict-pair">
                                                <span>🦈</span>
                                                VIPER
                                                <span class="conflict-vs">vs</span>
                                                <span>💣</span>
                                                CHAOS
                                            </span>
                                            <span class="conflict-theatre">ORB_SALVAGE_F7</span>
                                        </div>
                                        <div class="conflict-details">
                                            <span>Opposing positions: $12,450 vs $8,200</span>
                                            <span class="conflict-impact negative">Stability impact: -15%</span>
                                        </div>
                                    </div>
                                    
                                    <div class="conflict-item medium-impact">
                                        <div class="conflict-severity">🟡 MEDIUM</div>
                                        <div class="conflict-agents">
                                            <span class="conflict-pair">
                                                <span>🐋</span>
                                                LEVIATHAN
                                                <span class="conflict-vs">vs</span>
                                                <span>🦈</span>
                                                TITAN
                                            </span>
                                            <span class="conflict-theatre">FED_RATE_DECISION</span>
                                        </div>
                                        <div class="conflict-details">
                                            <span>Opposing positions: $24,500 vs $18,200</span>
                                            <span class="conflict-impact positive">Stability impact: +8%</span>
                                        </div>
                                    </div>
                                    
                                    <div class="conflict-item low-impact">
                                        <div class="conflict-severity">🟢 LOW</div>
                                        <div class="conflict-agents">
                                            <span class="conflict-pair">
                                                <span>🤝</span>
                                                AEGIS
                                                <span class="conflict-vs">vs</span>
                                                <span>💣</span>
                                                SABOTEUR
                                            </span>
                                            <span class="conflict-theatre">VEN_OIL_TANKER</span>
                                        </div>
                                        <div class="conflict-details">
                                            <span>Opposing positions: $6,800 vs $5,200</span>
                                            <span class="conflict-impact negative">Stability impact: -5%</span>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <script>
        // Update clock
        function updateClock() {
            const now = new Date();
            const hours = String(now.getUTCHours()).padStart(2, '0');
            const minutes = String(now.getUTCMinutes()).padStart(2, '0');
            const seconds = String(now.getUTCSeconds()).padStart(2, '0');
            document.querySelector('.clock').textContent = \`\${hours}:\${minutes}:\${seconds} UTC\`;
        }
        setInterval(updateClock, 1000);
        updateClock();

        // Navigation
        document.querySelectorAll('.nav-item').forEach(item => {
            item.addEventListener('click', function() {
                document.querySelectorAll('.nav-item').forEach(i => i.classList.remove('active'));
                this.classList.add('active');
            });
        });

        // View switching
        function switchView(view) {
            // Update tabs
            document.querySelectorAll('.page-tab').forEach(tab => tab.classList.remove('active'));
            document.getElementById(\`tab-\${view}\`).classList.add('active');
            
            // Update views
            document.querySelectorAll('.view-container').forEach(v => v.classList.remove('active'));
            document.getElementById(\`view-\${view}\`).classList.add('active');
        }

        // Action buttons
        document.querySelectorAll('.action-btn').forEach(btn => {
            btn.addEventListener('click', function(e) {
                e.stopPropagation();
                const action = this.textContent.trim();
                const agentCard = this.closest('.agent-card');
                const agentName = agentCard.querySelector('.agent-name').textContent;
                console.log(\`\${action} action on \${agentName}\`);
                
                // Visual feedback
                this.style.transform = 'scale(0.95)';
                setTimeout(() => {
                    this.style.transform = '';
                }, 150);
            });
        });

        // Agent card click
        document.querySelectorAll('.agent-card').forEach(card => {
            card.addEventListener('click', function() {
                const agentName = this.querySelector('.agent-name').textContent;
                console.log(\`Opening \${agentName} detail view\`);
            });
        });

        // Feed filter buttons
        document.querySelectorAll('.filter-btn').forEach(btn => {
            btn.addEventListener('click', function() {
                document.querySelectorAll('.filter-btn').forEach(b => b.classList.remove('active'));
                this.classList.add('active');
                
                const filter = this.dataset.filter;
                document.querySelectorAll('.movement-item').forEach(item => {
                    const icon = item.querySelector('.movement-icon');
                    if (filter === 'all') {
                        item.style.display = 'flex';
                    } else if (filter === 'deploy' && icon.classList.contains('deploy')) {
                        item.style.display = 'flex';
                    } else if (filter === 'withdraw' && icon.classList.contains('withdraw')) {
                        item.style.display = 'flex';
                    } else if (filter === 'strategy' && icon.classList.contains('strategy')) {
                        item.style.display = 'flex';
                    } else {
                        item.style.display = 'none';
                    }
                });
            });
        });

        // Simulate live movement feed updates
        function addMovement() {
            const movements = [
                { agent: 'LEVIATHAN', action: 'deployed to', theatre: 'ORB_SALVAGE_F7', icon: 'deploy' },
                { agent: 'VIPER', action: 'withdrew from', theatre: 'VEN_OIL_TANKER', icon: 'withdraw' },
                { agent: 'TITAN', action: 'shifted to', theatre: 'conservative strategy', icon: 'strategy' },
                { agent: 'SHADOW', action: 'deployed to', theatre: 'NVDA_EARNINGS', icon: 'deploy' },
                { agent: 'CHAOS', action: 'deployed to', theatre: 'FED_RATE_DECISION', icon: 'deploy' },
                { agent: 'AMBASSADOR', action: 'withdrew from', theatre: 'TAIWAN_STRAIT', icon: 'withdraw' }
            ];
            
            const velocities = ['+1', '+2', '+3', '+4', '-1', '-2', '-3', '~0'];
            const randomMovement = movements[Math.floor(Math.random() * movements.length)];
            const randomVelocity = velocities[Math.floor(Math.random() * velocities.length)];
            const now = new Date();
            const timeStr = \`\${String(now.getUTCHours()).padStart(2, '0')}:\${String(now.getUTCMinutes()).padStart(2, '0')}:\${String(now.getUTCSeconds()).padStart(2, '0')}\`;
            
            const feed = document.querySelector('.movement-feed');
            const newItem = document.createElement('div');
            newItem.className = 'movement-item';
            newItem.innerHTML = \`
                <span class="movement-time">\${timeStr}</span>
                <div class="movement-icon \${randomMovement.icon}">\${randomMovement.icon === 'deploy' ? '→' : randomMovement.icon === 'withdraw' ? '←' : '⚡'}</div>
                <div class="movement-content">
                    <span class="movement-agent">\${randomMovement.agent}</span>
                    <span class="movement-action"> \${randomMovement.action}</span>
                    <span class="movement-theatre">\${randomMovement.theatre}</span>
                </div>
                <span class="movement-velocity \${randomVelocity.includes('+') ? 'positive' : randomVelocity.includes('-') ? 'negative' : 'neutral'}">\${randomVelocity}</span>
            \`;
            
            feed.insertBefore(newItem, feed.firstChild);
            
            // Keep feed at max 20 items
            while (feed.children.length > 20) {
                feed.removeChild(feed.lastChild);
            }
        }
        
        // Add a new movement every 5-15 seconds
        setInterval(() => {
            if (document.getElementById('view-intelligence').classList.contains('active')) {
                if (Math.random() > 0.5) {
                    addMovement();
                }
            }
        }, 5000);
    <\/script>

<script>
(function(){
  function safeClick(sel){
    const el=document.querySelector(sel);
    if(el){ el.click(); return true; }
    return false;
  }
  function clickByText(tag, text){
    const els=[...document.querySelectorAll(tag)];
    const el=els.find(e=> (e.textContent||'').trim().toLowerCase().includes(text.toLowerCase()));
    if(el){ el.click(); return true; }
    return false;
  }
  window.addEventListener('message', function(ev){
    const msg = ev.data || {};
    if(!msg || msg.__echelon_shell__ !== true) return;
    const action = msg.action;
    if(!action) return;
    try{
      switch(action){
        case 'openAlert':
          safeClick('#alertBadgeBtn') || safeClick('.alert-badge-btn') || clickByText('button','alerts');
          break;
        case 'openCompare':
          safeClick('.btn-compare') || safeClick('[onclick*="toggleCompare"]') || safeClick('.compare-open') || safeClick('.compare-btn');
          break;
        case 'openSettings':
          clickByText('button','settings') || safeClick('[data-open="settings"]');
          break;
        case 'newPosition':
          clickByText('button','new position') || safeClick('.header-btn');
          break;
        case 'refresh':
          if(typeof window.refreshDashboard === 'function'){ window.refreshDashboard(); }
          clickByText('button','refresh');
          break;
        case 'marketView':
          clickByText('button','market view') || clickByText('a','market view');
          break;
        case 'roboticsView':
          clickByText('button','robotics view') || clickByText('a','robotics view');
          break;
        case 'agentRoster':
          clickByText('button','agent roster') || clickByText('a','agent roster');
          break;
        case 'globalIntel':
          clickByText('button','global intelligence') || clickByText('a','global intelligence');
          break;
        case 'deployAgent':
          clickByText('button','deploy agent') || clickByText('button','+ deploy');
          break;
        case 'breachConsole':
          clickByText('button','breach console') || clickByText('a','breach console');
          break;
        case 'exportConsole':
          clickByText('button','export console') || clickByText('a','export console');
          break;
        default:
          break;
      }
    }catch(e){ /* ignore */ }
  });
})();
<\/script>

</body>
</html>
`,
    };

    const TOP_ACTIONS = {
      marketplace: {
        name: "Marketplace",
        buttons: [
          { label:"Live", icon:"🟢", action:"noop", kind:"primary" },
          { label:"Alert", icon:"🔔", action:"openAlert" },
          { label:"Compare", icon:"⚖️", action:"openCompare" },
          { label:"New Timeline", icon:"➕", action:"newTimeline", kind:"primary" },
        ]
      },
      blackbox: {
        name: "Analytics",
        buttons: [
          { label:"Alert", icon:"🔔", action:"openAlert" },
          { label:"Compare", icon:"⚖️", action:"openCompare" },
          { label:"Settings", icon:"⚙️", action:"openShellSettings" },
        ]
      },
      portfolio: {
        name: "Portfolio",
        buttons: [
          { label:"New Position", icon:"➕", action:"newPosition", kind:"primary" },
        ]
      },
      rlmf: {
        name: "RLMF",
        buttons: [
          { label:"Market View", icon:"📈", action:"marketView" },
          { label:"Robotics View", icon:"🤖", action:"roboticsView" },
          { label:"Mode 0: Deterministic | Conf: 0.98", icon:"", action:"noop", kind:"pill" },
        ]
      },
      vrf: {
        name: "VRF",
        buttons: [
          { label:"Live", icon:"🟢", action:"noop", kind:"primary" },
          { label:"Refresh", icon:"⟳", action:"refresh", kind:"primary" },
        ]
      },
      agents: {
        name: "Agents",
        buttons: [
          { label:"Agent Roster", icon:"🧬", action:"agentRoster" },
          { label:"Global Intelligence", icon:"🌐", action:"globalIntel" },
          { label:"Search", icon:"🔎", action:"agentSearch" },
          { label:"+ Deploy Agent", icon:"➕", action:"deployAgent", kind:"primary" },
        ]
      },
    };

    const frames = {
      marketplace: document.getElementById('frame-marketplace'),
      blackbox: document.getElementById('frame-blackbox'),
      portfolio: document.getElementById('frame-portfolio'),
      rlmf: document.getElementById('frame-rlmf'),
      vrf: document.getElementById('frame-vrf'),
      agents: document.getElementById('frame-agents'),
    };

    function mountPagesOnce(){
      // Assign srcdoc once to keep internal JS state per frame
      for(const [k, fr] of Object.entries(frames)){
        if(!fr.dataset.mounted){
          fr.srcdoc = PAGES[k];
          fr.dataset.mounted = "1";
        }
      }
    }

    function postToActive(action){
      const fr = frames[state.page];
      if(!fr || !fr.contentWindow) return;
      fr.contentWindow.postMessage({ __echelon_shell__: true, action }, '*');
    }

    // Shell overlay helpers (used for items that don't exist in embedded pages yet)
    const overlay = document.getElementById('overlay');
    const modalTitle = document.getElementById('modalTitle');
    const modalBody = document.getElementById('modalBody');
    const modalClose = document.getElementById('modalClose');

    function openModal(title, html){
      modalTitle.textContent = title;
      modalBody.innerHTML = html;
      overlay.classList.add('show');
    }
    function closeModal(){ overlay.classList.remove('show'); }
    modalClose.addEventListener('click', closeModal);
    overlay.addEventListener('click', (e)=>{ if(e.target === overlay) closeModal(); });

    function openShellSettings(){
      // Answering your "Settings (what is this for?)" question with a sensible v0.
      openModal('Blackbox — Settings', `
        <div style="color: var(--text-secondary);">
          <div style="margin-bottom: 10px;">
            <b style="color: var(--text-primary);">Purpose:</b> configure signal intake + how you are notified + safety bounds for agent actions.
          </div>

          <div class="kvs">
            <div class="kvk">Alerts</div>
            <div class="kvv">Thresholds for logic-gap, entropy, paradox triggers, sabotage disclosures, and fork countdowns.</div>

            <div class="kvk">Feeds</div>
            <div class="kvv">Enable/disable OSINT channels; set trust weights; view degraded-mode fallbacks.</div>

            <div class="kvk">Execution</div>
            <div class="kvv">Commit–reveal rules, randomised delay windows, and per-timeline exposure limits.</div>

            <div class="kvk">Display</div>
            <div class="kvv">Density, columns, risk meters, and replay fidelity.</div>

            <div class="kvk">Privacy</div>
            <div class="kvv">Incident replay data handling (Tier 1–3), retention, export redaction policies.</div>
          </div>

          <div class="row">
            <input class="input" placeholder="Search settings (stub) — e.g. 'logic gap threshold'">
            <button class="tbtn primary" onclick="document.getElementById('modalClose').click()">Done</button>
          </div>
        </div>
      `);
    }

    function newTimeline() {
      openModal('New Timeline', `
        <div style="margin-bottom: 12px;">
          This is a shell-level placeholder for a future <b style="color: var(--text-primary);">Timeline Launchpad rail</b> (not a separate pump.fun landing).
        </div>
        <div class="kvs">
          <div class="kvk">Title</div>
          <div class="kvv"><input class="input" placeholder="e.g. 'Orbital Salvage: Debris field extraction'"></div>

          <div class="kvk">Origin</div>
          <div class="kvv">
            <select class="input">
              <option>OSINT anomaly</option>
              <option>Spy proposal</option>
              <option>User-created</option>
              <option>Partner seed</option>
            </select>
          </div>

          <div class="kvk">Theatre</div>
          <div class="kvv">
            <select class="input">
              <option>Universal</option>
              <option>Neon Courier</option>
              <option>Disaster Response</option>
              <option>Orbital Salvage</option>
              <option>Ocean's Eleven: Blacksite</option>
              <option>VIP Extraction</option>
              <option>Cleanroom Microsurgery</option>
            </select>
          </div>

          <div class="kvk">Notes</div>
          <div class="kvv"><input class="input" placeholder="Evidence, constraints, settlement oracle…"></div>
        </div>

        <div class="row">
          <button class="tbtn" onclick="document.getElementById('modalClose').click()">Cancel</button>
          <button class="tbtn primary" onclick="alert('Stub: Timeline created (UI only).'); document.getElementById('modalClose').click()">Create</button>
        </div>
      `);
    }

    function openShellAlertCentre() {
      openModal('Alerts', `
        <div style="margin-bottom: 10px;">
          Shell-level alert centre (useful where a page does not yet implement alerts).
        </div>
        <div style="display:flex; gap:10px; flex-wrap:wrap;">
          <span class="pill">Logic Gap ↑</span>
          <span class="pill">Entropy Critical</span>
          <span class="pill">Paradox Active</span>
          <span class="pill">Disclosure Window</span>
          <span class="pill">Fork Soon</span>
        </div>
        <div style="margin-top: 14px; color: var(--text-muted); font-family: var(--font-mono); font-size: 11px;">
          Note: Marketplace has an embedded alert panel; Blackbox currently uses this shell stub unless you wire it in.
        </div>
      `);
    }

    function openShellCompare() {
      openModal('Compare', `
        <div style="margin-bottom: 10px;">
          Shell-level compare stub. Intended: pin up to 4 timelines and diff stability, logic gap velocity, entropy slope, and paradox state.
        </div>
        <div class="kvs">
          <div class="kvk">Slot A</div><div class="kvv"><input class="input" placeholder="Paste timeline ID / name"></div>
          <div class="kvk">Slot B</div><div class="kvv"><input class="input" placeholder="Paste timeline ID / name"></div>
          <div class="kvk">Slot C</div><div class="kvv"><input class="input" placeholder="Paste timeline ID / name"></div>
          <div class="kvk">Slot D</div><div class="kvv"><input class="input" placeholder="Paste timeline ID / name"></div>
        </div>
        <div class="row">
          <button class="tbtn primary" onclick="alert('Stub: compare opened (UI only).')">Compare</button>
        </div>
      `);
    }

    function renderTopButtons(page) {
      const cfg = TOP_ACTIONS[page] || { name: page, buttons: [] };
      document.getElementById('pageName').textContent = cfg.name || page;
      const root = document.getElementById('topButtons');
      root.innerHTML = '';
      cfg.buttons.forEach((b) => {
        if(b.kind === 'pill') {
          const span = document.createElement('span');
          span.className = 'pill';
          span.textContent = b.label;
          root.appendChild(span);
          return;
        }
        const btn = document.createElement('button');
        btn.className = 'tbtn' + (b.kind === 'primary' ? ' primary' : '');
        btn.innerHTML = (b.icon ? `<span>${b.icon}</span>` : '') + `<span>${b.label}</span>`;
        btn.addEventListener('click', () => handleAction(b.action));
        root.appendChild(btn);
      });
    }

    function handleAction(action) {
      if(!action || action === 'noop') return;

      // Prefer embedded functionality where present; fall back to shell stubs otherwise.
      if(action === 'openShellSettings') return openShellSettings();
      if(action === 'newTimeline') return newTimeline();

      if(action === 'openAlert') {
        // Marketplace implements alerts internally; other pages fall back to shell.
        if(state.page === 'marketplace') return postToActive('openAlert');
        return openShellAlertCentre();
      }
      if(action === 'openCompare') {
        // Marketplace implements compare internally; other pages fall back to shell.
        if(state.page === 'marketplace') return postToActive('openCompare');
        return openShellCompare();
      }
      if(action === 'agentSearch') {
        // Best-effort: try to focus a search box inside the Agents page; else show a shell prompt.
        postToActive('agentSearch');
        openModal('Agents — Search', `<input class="input" placeholder="Search agents (stub) — name, archetype, theatre…">`);
        return;
      }

      // Default: message into embedded page
      postToActive(action);
    }

    function setActivePage(page) {
      if(!frames[page]) return;

      // Update frames
      for(const [k, fr] of Object.entries(frames)) {
        fr.classList.toggle('active', k === page);
      }

      // Update side nav active state
      document.querySelectorAll('.nav-item[data-page]').forEach(el => {
        el.classList.toggle('active', el.dataset.page === page);
      });

      // Agents subnav visibility
      document.getElementById('agentsSubnav').classList.toggle('show', page === 'agents');

      // Top buttons
      state.page = page;
      renderTopButtons(page);
    }

    const state = { page: 'marketplace' };

    // Side nav handlers
    document.querySelectorAll('.nav-item[data-page]').forEach((el) => {
      el.addEventListener('click', () => setActivePage(el.dataset.page));
    });

    // Agents subnav actions
    document.querySelectorAll('.sub-item[data-action]').forEach((el) => {
      el.addEventListener('click', () => handleAction(el.dataset.action));
    });

    // Boot
    mountPagesOnce();
    renderTopButtons('marketplace');
  </script>
</body>
</html>
